[{"filePath":"E:\\foodiempt-main\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\AIRecommendations.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\AddressSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\CategoryTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\FavouriteButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\LocationHeader.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[890,893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[890,893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1964,1967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1964,1967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { useHaptics } from '@/hooks/useHaptics';\r\nimport { MapPin, ChevronDown, Map as MapIcon, Loader2 } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from '@/components/ui/popover';\r\nimport { Input } from '@/components/ui/input';\r\nimport { toast } from 'sonner';\r\n\r\ninterface LocationHeaderProps {\r\n  address: string;\r\n  onAddressChange: (address: string) => void;\r\n}\r\n\r\nexport function LocationHeader({ address, onAddressChange }: LocationHeaderProps) {\r\n  const [open, setOpen] = useState(false);\r\n  const [inputValue, setInputValue] = useState(address);\r\n  const haptics = useHaptics();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [isSearchLoading, setIsSearchLoading] = useState(false);\r\n  const [searchResults, setSearchResults] = useState<any[]>([]); // To store suggestions if needed later, or just debug\r\n\r\n  const handleSearch = async () => {\r\n    const query = searchQuery.trim();\r\n    if (!query || query.length < 6) {\r\n      toast.error('Please enter a valid 6-digit Pincode');\r\n      return;\r\n    }\r\n\r\n    setIsSearchLoading(true);\r\n    setSearchResults([]);\r\n    try {\r\n      const fetchUrl = `https://api.postalpincode.in/pincode/${query}`;\r\n\r\n      const response = await fetch(fetchUrl);\r\n      const data = await response.json();\r\n\r\n      // API returns an array: [{ Message, Status, PostOffice: [...] }]\r\n      if (data && data.length > 0 && data[0].Status === 'Success' && data[0].PostOffice && data[0].PostOffice.length > 0) {\r\n        setSearchResults(data[0].PostOffice);\r\n      } else {\r\n        toast.error('No location found. Please enter a valid Pincode.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Search error:', error);\r\n      toast.error('Failed to search location');\r\n    } finally {\r\n      setIsSearchLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSelectLocation = (office: any) => {\r\n    const parts = [\r\n      office.Name,\r\n      office.District,\r\n      office.State,\r\n      office.Pincode\r\n    ];\r\n\r\n    const formattedAddress = parts.filter(Boolean).join(', ');\r\n\r\n    setInputValue(formattedAddress);\r\n    onAddressChange(formattedAddress);\r\n    setSearchResults([]); // Clear results after selection\r\n    setSearchQuery(''); // Optionally clear query\r\n    setOpen(false); // Close popover on selection\r\n\r\n    toast.success(`Location selected: ${formattedAddress}`);\r\n  };\r\n\r\n  const handleSave = () => {\r\n    if (inputValue.trim()) {\r\n      onAddressChange(inputValue.trim());\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Popover open={open} onOpenChange={setOpen}>\r\n        <PopoverTrigger asChild>\r\n          <Button\r\n            variant=\"ghost\"\r\n            className=\"flex items-center gap-1 px-2 h-auto py-1 hover:bg-secondary/80 max-w-[200px] md:max-w-none\"\r\n          >\r\n            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\r\n              <MapPin className=\"w-4 h-4 text-primary\" />\r\n            </div>\r\n            <div className=\"text-left hidden xs:block\">\r\n              <p className=\"text-[10px] text-muted-foreground leading-none\">Delivery to</p>\r\n              <p className=\"text-xs font-bold text-foreground leading-tight flex items-center gap-0.5 max-w-[120px] md:max-w-[200px] truncate\">\r\n                {address || 'Set Location'}\r\n                <ChevronDown className=\"w-3 h-3 flex-shrink-0\" />\r\n              </p>\r\n            </div>\r\n            {/* Mobile simplified view */}\r\n            <div className=\"text-left xs:hidden\">\r\n              <p className=\"text-xs font-bold text-foreground leading-tight flex items-center gap-0.5 truncate max-w-[100px]\">\r\n                {address ? address.split(',')[0] : 'Location'}\r\n                <ChevronDown className=\"w-3 h-3 flex-shrink-0\" />\r\n              </p>\r\n            </div>\r\n          </Button>\r\n        </PopoverTrigger>\r\n        <PopoverContent className=\"w-[calc(100vw-2rem)] md:w-80 p-0 overflow-hidden\" align=\"start\">\r\n          <div className=\"p-4 bg-muted/30\">\r\n            <h4 className=\"font-semibold text-sm mb-3\">Delivery Location</h4>\r\n\r\n            <div className=\"flex gap-2 mb-3\">\r\n              <Input\r\n                placeholder=\"Enter your delivery address\"\r\n                value={inputValue}\r\n                onChange={(e) => setInputValue(e.target.value)}\r\n                className=\"flex-1 bg-background\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"mt-3 pt-3 border-t border-dashed\">\r\n              <p className=\"text-xs text-muted-foreground mb-2\">Or search by Pincode</p>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  placeholder=\"Enter Pincode\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => {\r\n                    const val = e.target.value.replace(/\\D/g, '').slice(0, 6);\r\n                    setSearchQuery(val);\r\n                  }}\r\n                  className=\"flex-1 bg-background h-9 text-sm\"\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === 'Enter') {\r\n                      handleSearch();\r\n                    }\r\n                  }}\r\n                />\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  className=\"h-9 px-3\"\r\n                  onClick={handleSearch}\r\n                  disabled={isSearchLoading || searchQuery.length < 6}\r\n                >\r\n                  {isSearchLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : 'Search'}\r\n                </Button>\r\n              </div>\r\n\r\n              {/* Data list for search results */}\r\n              {searchResults.length > 0 && (\r\n                <div className=\"mt-2 text-left max-h-[200px] overflow-y-auto border rounded-md divide-y shadow-sm\">\r\n                  {searchResults.map((office, idx) => (\r\n                    <button\r\n                      key={`${office.Name}-${idx}`}\r\n                      className=\"w-full text-left px-3 py-2 text-xs hover:bg-secondary transition-colors flex flex-col gap-0.5\"\r\n                      onClick={() => handleSelectLocation(office)}\r\n                    >\r\n                      <span className=\"font-medium text-foreground\">{office.Name}</span>\r\n                      <span className=\"text-muted-foreground\">{office.District}, {office.State} - {office.Pincode}</span>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {address && (\r\n            <div className=\"p-4 border-t border-border bg-card\">\r\n              <div className=\"flex items-start gap-3 p-3 rounded-lg border border-border bg-background shadow-sm\">\r\n                <div className=\"w-8 h-8 rounded-full bg-green-500/10 flex items-center justify-center shrink-0 mt-0.5\">\r\n                  <MapPin className=\"w-4 h-4 text-green-600\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs font-semibold text-foreground\">Current Location</p>\r\n                  <p className=\"text-xs text-muted-foreground mt-0.5 leading-relaxed line-clamp-2\">{address}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"p-4 pt-2\">\r\n            <Button onClick={handleSave} className=\"w-full\" size=\"sm\">\r\n              Confirm Location\r\n            </Button>\r\n          </div>\r\n        </PopoverContent>\r\n      </Popover>\r\n\r\n    </>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\MainLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\MenuImageUpload.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\NavLink.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\RestaurantReviews.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ReviewForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ScheduleDelivery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\StatusBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\AdminOrderCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\AdminSupport.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2564,2567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2564,2567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/components/ui/table\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Loader2, Search, MessageSquare, Filter } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { TicketDetailDialog } from \"./TicketDetailDialog\";\r\n\r\ninterface Ticket {\r\n    id: string;\r\n    subject: string;\r\n    status: \"open\" | \"in_progress\" | \"resolved\" | \"closed\";\r\n    priority: \"low\" | \"medium\" | \"high\" | \"urgent\";\r\n    created_at: string;\r\n    user: {\r\n        full_name: string;\r\n        email: string;\r\n    };\r\n}\r\n\r\nexport const AdminSupport = () => {\r\n    const [tickets, setTickets] = useState<Ticket[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n    const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n    const [priorityFilter, setPriorityFilter] = useState<string>(\"all\");\r\n\r\n    // Dialog state\r\n    const [selectedTicket, setSelectedTicket] = useState<Ticket | null>(null);\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchTickets();\r\n\r\n        // Subscribe to new tickets\r\n        const channel = supabase\r\n            .channel('admin-tickets')\r\n            .on(\r\n                'postgres_changes',\r\n                { event: '*', schema: 'public', table: 'support_tickets' },\r\n                () => fetchTickets()\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, []);\r\n\r\n    const fetchTickets = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from(\"support_tickets\")\r\n                .select(`\r\n                    *,\r\n                    user:profiles!support_tickets_user_id_fkey(full_name, email)\r\n                `)\r\n                .order(\"created_at\", { ascending: false });\r\n\r\n            if (error) throw error;\r\n\r\n            // Map the joined data correctly\r\n            const formattedData = (data || []).map((t: any) => ({\r\n                ...t,\r\n                user: t.user || { full_name: 'Unknown', email: '-' }\r\n            }));\r\n\r\n            setTickets(formattedData);\r\n        } catch (error) {\r\n            console.error(\"Error fetching tickets:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const getStatusBadge = (status: string) => {\r\n        const styles: Record<string, string> = {\r\n            open: \"bg-green-100 text-green-800 hover:bg-green-100\",\r\n            in_progress: \"bg-blue-100 text-blue-800 hover:bg-blue-100\",\r\n            resolved: \"bg-purple-100 text-purple-800 hover:bg-purple-100\",\r\n            closed: \"bg-gray-100 text-gray-800 hover:bg-gray-100\",\r\n        };\r\n        return <Badge className={styles[status] || \"\"} variant=\"outline\">{status.replace(\"_\", \" \").toUpperCase()}</Badge>;\r\n    };\r\n\r\n    const getPriorityBadge = (priority: string) => {\r\n        const styles: Record<string, string> = {\r\n            urgent: \"text-red-600 font-bold\",\r\n            high: \"text-orange-600 font-medium\",\r\n            medium: \"text-blue-600\",\r\n            low: \"text-gray-600\",\r\n        };\r\n        return <span className={`text-xs uppercase ${styles[priority]}`}>{priority}</span>;\r\n    };\r\n\r\n    const filteredTickets = tickets.filter(ticket => {\r\n        const matchesSearch =\r\n            ticket.subject.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            ticket.id.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            ticket.user.full_name?.toLowerCase().includes(searchTerm.toLowerCase());\r\n\r\n        const matchesStatus = statusFilter === 'all' || ticket.status === statusFilter;\r\n        const matchesPriority = priorityFilter === 'all' || ticket.priority === priorityFilter;\r\n\r\n        return matchesSearch && matchesStatus && matchesPriority;\r\n    });\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center\">\r\n                <div className=\"relative w-full sm:w-96\">\r\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                    <Input\r\n                        placeholder=\"Search tickets...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"pl-8\"\r\n                    />\r\n                </div>\r\n                <div className=\"flex gap-2 w-full sm:w-auto\">\r\n                    <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                        <SelectTrigger className=\"w-[140px]\">\r\n                            <SelectValue placeholder=\"Status\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">All Status</SelectItem>\r\n                            <SelectItem value=\"open\">Open</SelectItem>\r\n                            <SelectItem value=\"in_progress\">In Progress</SelectItem>\r\n                            <SelectItem value=\"resolved\">Resolved</SelectItem>\r\n                            <SelectItem value=\"closed\">Closed</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                    <Select value={priorityFilter} onValueChange={setPriorityFilter}>\r\n                        <SelectTrigger className=\"w-[140px]\">\r\n                            <SelectValue placeholder=\"Priority\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">All Priorities</SelectItem>\r\n                            <SelectItem value=\"urgent\">Urgent</SelectItem>\r\n                            <SelectItem value=\"high\">High</SelectItem>\r\n                            <SelectItem value=\"medium\">Medium</SelectItem>\r\n                            <SelectItem value=\"low\">Low</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <MessageSquare className=\"h-5 w-5\" />\r\n                        Support Tickets\r\n                        <Badge variant=\"secondary\" className=\"ml-2\">{filteredTickets.length}</Badge>\r\n                    </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <Table>\r\n                        <TableHeader>\r\n                            <TableRow>\r\n                                <TableHead>Subject</TableHead>\r\n                                <TableHead>User</TableHead>\r\n                                <TableHead>Status</TableHead>\r\n                                <TableHead>Priority</TableHead>\r\n                                <TableHead>Created</TableHead>\r\n                                <TableHead className=\"text-right\">Action</TableHead>\r\n                            </TableRow>\r\n                        </TableHeader>\r\n                        <TableBody>\r\n                            {loading ? (\r\n                                <TableRow>\r\n                                    <TableCell colSpan={6} className=\"text-center py-8\">\r\n                                        <Loader2 className=\"h-8 w-8 animate-spin mx-auto text-primary\" />\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ) : filteredTickets.length === 0 ? (\r\n                                <TableRow>\r\n                                    <TableCell colSpan={6} className=\"text-center py-8 text-muted-foreground\">\r\n                                        No tickets found matching your filters.\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ) : (\r\n                                filteredTickets.map((ticket) => (\r\n                                    <TableRow key={ticket.id}>\r\n                                        <TableCell className=\"font-medium max-w-[200px] truncate\">\r\n                                            {ticket.subject}\r\n                                            <div className=\"text-xs text-muted-foreground md:hidden\">#{ticket.id.slice(0, 8)}</div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span>{ticket.user.full_name}</span>\r\n                                                <span className=\"text-xs text-muted-foreground\">{ticket.user.email}</span>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>{getStatusBadge(ticket.status)}</TableCell>\r\n                                        <TableCell>{getPriorityBadge(ticket.priority)}</TableCell>\r\n                                        <TableCell className=\"text-muted-foreground text-sm\">\r\n                                            {format(new Date(ticket.created_at), 'MMM d, HH:mm')}\r\n                                        </TableCell>\r\n                                        <TableCell className=\"text-right\">\r\n                                            <Button\r\n                                                variant=\"outline\"\r\n                                                size=\"sm\"\r\n                                                onClick={() => {\r\n                                                    setSelectedTicket(ticket);\r\n                                                    setIsDialogOpen(true);\r\n                                                }}\r\n                                            >\r\n                                                View\r\n                                            </Button>\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ))\r\n                            )}\r\n                        </TableBody>\r\n                    </Table>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <TicketDetailDialog\r\n                open={isDialogOpen}\r\n                onOpenChange={setIsDialogOpen}\r\n                ticket={selectedTicket}\r\n                onUpdate={fetchTickets}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\CouponsManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\DeliveryPincodesManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2041,2044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2041,2044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { DeliveryPincode } from '@/types/database';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Trash2, MapPin, Plus, Loader2, ChevronsUpDown, Check } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n    Command,\r\n    CommandEmpty,\r\n    CommandGroup,\r\n    CommandInput,\r\n    CommandItem,\r\n    CommandList,\r\n} from '@/components/ui/command';\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from '@/components/ui/popover';\r\n\r\nexport function DeliveryPincodesManager() {\r\n    const [pincodes, setPincodes] = useState<DeliveryPincode[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [newPincode, setNewPincode] = useState('');\r\n    const [newDescription, setNewDescription] = useState('');\r\n    const [search, setSearch] = useState('');\r\n    const [adding, setAdding] = useState(false);\r\n    const [fetchingDetails, setFetchingDetails] = useState(false);\r\n    const [availableDescriptions, setAvailableDescriptions] = useState<string[]>([]);\r\n    const [openDescription, setOpenDescription] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const fetchPincodeDetails = async () => {\r\n            if (newPincode.length === 6) {\r\n                setFetchingDetails(true);\r\n                try {\r\n                    const response = await fetch(`https://api.postalpincode.in/pincode/${newPincode}`);\r\n                    const data = await response.json();\r\n\r\n                    if (data && data[0] && data[0].Status === 'Success') {\r\n                        const postOffices = data[0].PostOffice;\r\n                        if (postOffices && postOffices.length > 0) {\r\n                            const areas = postOffices.map((po: any) => `${po.Name}, ${po.District}`);\r\n                            setAvailableDescriptions(areas);\r\n                            setNewDescription(areas[0]);\r\n                            toast.success(`Found ${areas.length} related areas from postal data`);\r\n                        }\r\n                    } else {\r\n                        toast.error('Invalid Pincode or details not found');\r\n                        setNewDescription('');\r\n                        setAvailableDescriptions([]);\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error fetching pincode details:', error);\r\n                } finally {\r\n                    setFetchingDetails(false);\r\n                }\r\n            }\r\n        };\r\n\r\n        const timeoutId = setTimeout(() => {\r\n            if (newPincode.length === 6) {\r\n                fetchPincodeDetails();\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearTimeout(timeoutId);\r\n    }, [newPincode]);\r\n\r\n    const fetchPincodes = useCallback(async () => {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('delivery_pincodes')\r\n                .select('*')\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (error) throw error;\r\n            setPincodes(data || []);\r\n        } catch (error) {\r\n            toast.error('Failed to load pincodes');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        fetchPincodes();\r\n    }, [fetchPincodes]);\r\n\r\n    const addPincode = async () => {\r\n        if (!newPincode.trim() || newPincode.length < 6) {\r\n            toast.error('Please enter a valid 6-digit pincode');\r\n            return;\r\n        }\r\n\r\n        if (!newDescription.trim()) {\r\n            toast.error('Description is required');\r\n            return;\r\n        }\r\n\r\n        setAdding(true);\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('delivery_pincodes')\r\n                .insert({\r\n                    pincode: newPincode,\r\n                    description: newDescription || null,\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) {\r\n                toast.error('Failed to add pincode');\r\n                throw error;\r\n            }\r\n\r\n            setPincodes([data, ...pincodes]);\r\n            setNewPincode('');\r\n            setNewDescription('');\r\n            toast.success('Delivery area added successfully');\r\n        } catch (error) {\r\n            toast.error('Failed to add pincode');\r\n        } finally {\r\n            setAdding(false);\r\n        }\r\n    };\r\n\r\n    const toggleStatus = async (id: string, currentStatus: boolean) => {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('delivery_pincodes')\r\n                .update({ is_active: !currentStatus })\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            setPincodes(pincodes.map(p =>\r\n                p.id === id ? { ...p, is_active: !currentStatus } : p\r\n            ));\r\n            toast.success(`Pincode ${!currentStatus ? 'activated' : 'deactivated'}`);\r\n        } catch (error) {\r\n            toast.error('Failed to update status');\r\n        }\r\n    };\r\n\r\n    const deletePincode = async (id: string) => {\r\n        if (!confirm('Are you sure you want to delete this pincode?')) return;\r\n\r\n        try {\r\n            const { error } = await supabase\r\n                .from('delivery_pincodes')\r\n                .delete()\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            setPincodes(pincodes.filter(p => p.id !== id));\r\n            toast.success('Pincode deleted');\r\n        } catch (error) {\r\n            toast.error('Failed to delete pincode');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Card className=\"border-0 shadow-lg\">\r\n            <CardHeader className=\"pb-3\">\r\n                <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                    <MapPin className=\"w-5 h-5 text-primary\" />\r\n                    Delivery Areas ({pincodes.length})\r\n                </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n                <div className=\"space-y-6\">\r\n                    {/* Add New Pincode */}\r\n                    <div className=\"flex gap-3 items-end bg-secondary/20 p-4 rounded-xl border border-border/50\">\r\n                        <div className=\"space-y-2 flex-1\">\r\n                            <label className=\"text-xs font-medium text-muted-foreground\">Pincode</label>\r\n                            <Input\r\n                                placeholder=\"Ex: 500001\"\r\n                                value={newPincode}\r\n                                onChange={(e) => setNewPincode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\r\n                                maxLength={6}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2 flex-[2]\">\r\n                            <label className=\"text-xs font-medium text-muted-foreground flex items-center gap-2\">\r\n                                Description <span className=\"text-destructive\">*</span>\r\n                                {fetchingDetails && <Loader2 className=\"w-3 h-3 animate-spin\" />}\r\n                            </label>\r\n\r\n                            <Popover\r\n                                open={openDescription}\r\n                                onOpenChange={(open) => {\r\n                                    setOpenDescription(open);\r\n                                    if (open) setSearch('');\r\n                                }}\r\n                            >\r\n                                <PopoverTrigger asChild>\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        role=\"combobox\"\r\n                                        aria-expanded={openDescription}\r\n                                        className=\"w-full justify-between font-normal text-left px-3\"\r\n                                    >\r\n                                        <span className=\"truncate\">\r\n                                            {newDescription || \"Select or type description...\"}\r\n                                        </span>\r\n                                        <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\r\n                                    <Command>\r\n                                        <CommandInput\r\n                                            placeholder=\"Search or type custom...\"\r\n                                            value={search}\r\n                                            onValueChange={setSearch}\r\n                                        />\r\n                                        <CommandList>\r\n                                            <CommandEmpty>\r\n                                                <Button\r\n                                                    variant=\"ghost\"\r\n                                                    className=\"w-full justify-start text-xs h-8\"\r\n                                                    onClick={() => {\r\n                                                        setNewDescription(search);\r\n                                                        setOpenDescription(false);\r\n                                                    }}\r\n                                                >\r\n                                                    Use \"{search}\"\r\n                                                </Button>\r\n                                            </CommandEmpty>\r\n                                            <CommandGroup heading=\"Available Areas\">\r\n                                                {availableDescriptions.map((desc) => (\r\n                                                    <CommandItem\r\n                                                        key={desc}\r\n                                                        value={desc}\r\n                                                        onSelect={(currentValue) => {\r\n                                                            setNewDescription(currentValue);\r\n                                                            setOpenDescription(false);\r\n                                                        }}\r\n                                                    >\r\n                                                        <Check\r\n                                                            className={cn(\r\n                                                                \"mr-2 h-4 w-4\",\r\n                                                                newDescription === desc ? \"opacity-100\" : \"opacity-0\"\r\n                                                            )}\r\n                                                        />\r\n                                                        {desc}\r\n                                                    </CommandItem>\r\n                                                ))}\r\n                                            </CommandGroup>\r\n                                        </CommandList>\r\n                                    </Command>\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                        </div>\r\n                        <Button onClick={addPincode} disabled={adding || !newPincode || !newDescription}>\r\n                            {adding ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Plus className=\"w-4 h-4 mr-1\" />}\r\n                            Add\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {/* List */}\r\n                    <div className=\"space-y-3\">\r\n                        {loading ? (\r\n                            <div className=\"text-center py-10 text-muted-foreground\">Loading areas...</div>\r\n                        ) : pincodes.length === 0 ? (\r\n                            <div className=\"text-center py-10 text-muted-foreground\">No delivery areas defined yet.</div>\r\n                        ) : (\r\n                            <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                                {pincodes.map((item) => (\r\n                                    <div\r\n                                        key={item.id}\r\n                                        className=\"flex items-center justify-between p-3 rounded-xl border border-border bg-card hover:bg-secondary/30 transition-all\"\r\n                                    >\r\n                                        <div>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <span className=\"font-mono text-lg font-bold text-primary\">\r\n                                                    {item.pincode}\r\n                                                </span>\r\n                                                <Switch\r\n                                                    checked={item.is_active}\r\n                                                    onCheckedChange={() => toggleStatus(item.id, item.is_active)}\r\n                                                />\r\n                                            </div>\r\n                                            {item.description && (\r\n                                                <p className=\"text-sm text-muted-foreground mt-1\">{item.description}</p>\r\n                                            )}\r\n                                        </div>\r\n                                        <Button\r\n                                            variant=\"ghost\"\r\n                                            size=\"icon\"\r\n                                            className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\r\n                                            onClick={() => deletePincode(item.id)}\r\n                                        >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\FinancialAnalytics.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'processed' is never reassigned. Use 'const' instead.","line":87,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":87,"endColumn":26,"fix":{"range":[3037,3055],"text":"const processed = 0;"}},{"ruleId":"prefer-const","severity":2,"message":"'pending' is never reassigned. Use 'const' instead.","line":88,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":88,"endColumn":24,"fix":{"range":[3069,3085],"text":"const pending = 0;"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow\r\n} from '@/components/ui/table';\r\nimport { formatCurrency } from '@/utils/format';\r\nimport { Loader2, IndianRupee, TrendingUp, TrendingDown, Wallet } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\nexport const FinancialAnalytics = () => {\r\n    const [loading, setLoading] = useState(true);\r\n    const [stats, setStats] = useState({\r\n        totalRevenue: 0,\r\n        netEarnings: 0,\r\n        platformFees: 0,\r\n        commissions: 0,\r\n        pendingPayouts: 0,\r\n        processedPayouts: 0,\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchFinancials();\r\n    }, []);\r\n\r\n    const fetchFinancials = async () => {\r\n        try {\r\n            setLoading(true);\r\n\r\n            // 1. Fetch Restaurants (for commission rates)\r\n            const { data: restaurants } = await supabase\r\n                .from('restaurants')\r\n                .select('id, commission_rate');\r\n\r\n            const shopMap = new Map(restaurants?.map(r => [r.id, r.commission_rate]) || []);\r\n\r\n            // 2. Fetch Delivered Orders\r\n            const { data: orders } = await supabase\r\n                .from('orders')\r\n                .select('id, total_amount, delivery_fee, restaurant_id, delivery_partner_id')\r\n                .eq('status', 'delivered');\r\n\r\n            // 3. Fetch Settlements\r\n            const { data: settlements } = await supabase\r\n                .from('settlements')\r\n                .select('amount, status');\r\n\r\n            if (!orders) return;\r\n\r\n            const FIXED_PLATFORM_FEE = 8;\r\n            const DEFAULT_DELIVERY_FEE = 25;\r\n\r\n            let totalRev = 0;\r\n            let totalPlatFees = 0;\r\n            let totalCommissions = 0;\r\n            let totalShopPayable = 0;\r\n            let totalPartnerPayable = 0;\r\n\r\n            orders.forEach(order => {\r\n                const total = Number(order.total_amount) || 0;\r\n                const dFee = Number(order.delivery_fee) || DEFAULT_DELIVERY_FEE;\r\n                const rate = Number(shopMap.get(order.restaurant_id) || 15);\r\n\r\n                const subtotal = total - dFee - FIXED_PLATFORM_FEE;\r\n                const commission = (subtotal * rate) / 100;\r\n                const shopEarning = Math.max(0, subtotal - commission);\r\n\r\n                // Aggregates\r\n                totalRev += total;\r\n                totalPlatFees += FIXED_PLATFORM_FEE;\r\n                totalCommissions += commission;\r\n\r\n                totalShopPayable += shopEarning;\r\n                // Partner earning is delivery fee - simplified\r\n                if (order.delivery_partner_id) {\r\n                    totalPartnerPayable += dFee; // Assuming all delivery fee goes to partner\r\n                }\r\n            });\r\n\r\n            // Calculate Settlements\r\n            let processed = 0;\r\n            let pending = 0; // This usually tracks *requests*, but here we calculate *liabilities*\r\n\r\n            // Actually, \"Pending Payouts\" is simpler: Total Payable - Total Settled\r\n            const totalLiabilities = totalShopPayable + totalPartnerPayable;\r\n            const totalSettled = settlements?.reduce((sum, s) => sum + Number(s.amount), 0) || 0;\r\n\r\n            setStats({\r\n                totalRevenue: totalRev,\r\n                netEarnings: totalPlatFees + totalCommissions,\r\n                platformFees: totalPlatFees,\r\n                commissions: totalCommissions,\r\n                pendingPayouts: Math.max(0, totalLiabilities - totalSettled),\r\n                processedPayouts: totalSettled\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('Error fetching financials:', error);\r\n            toast.error(\"Failed to load financial data\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className=\"flex justify-center p-8\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                <Card className=\"bg-gradient-to-br from-green-50 to-green-100 border-green-200\">\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-green-700\">Net Earnings</CardTitle>\r\n                        <Wallet className=\"h-4 w-4 text-green-700\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-green-700\">{formatCurrency(stats.netEarnings)}</div>\r\n                        <p className=\"text-xs text-green-600/80\">Platform Fee + Commissions</p>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Pending Payouts</CardTitle>\r\n                        <TrendingDown className=\"h-4 w-4 text-orange-500\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-orange-500\">{formatCurrency(stats.pendingPayouts)}</div>\r\n                        <p className=\"text-xs text-muted-foreground\">Liabilities to Shops/Partners</p>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Processed Payouts</CardTitle>\r\n                        <TrendingUp className=\"h-4 w-4 text-blue-500\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-blue-500\">{formatCurrency(stats.processedPayouts)}</div>\r\n                        <p className=\"text-xs text-muted-foreground\">Total Settled Amount</p>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Gross Revenue</CardTitle>\r\n                        <IndianRupee className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{formatCurrency(stats.totalRevenue)}</div>\r\n                        <p className=\"text-xs text-muted-foreground\">Total Transaction Volume</p>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-2 gap-6\">\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle>Income Breakdown</CardTitle>\r\n                        <CardDescription>Where your money comes from</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <Table>\r\n                            <TableBody>\r\n                                <TableRow>\r\n                                    <TableCell className=\"font-medium\">Platform Fees</TableCell>\r\n                                    <TableCell className=\"text-right text-green-600\">+{formatCurrency(stats.platformFees)}</TableCell>\r\n                                </TableRow>\r\n                                <TableRow>\r\n                                    <TableCell className=\"font-medium\">Commissions</TableCell>\r\n                                    <TableCell className=\"text-right text-green-600\">+{formatCurrency(stats.commissions)}</TableCell>\r\n                                </TableRow>\r\n                                <TableRow className=\"bg-muted/50 font-bold\">\r\n                                    <TableCell>Total Net Inflow</TableCell>\r\n                                    <TableCell className=\"text-right\">{formatCurrency(stats.netEarnings)}</TableCell>\r\n                                </TableRow>\r\n                            </TableBody>\r\n                        </Table>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle>Balance Sheet</CardTitle>\r\n                        <CardDescription>Current Financial Position</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow>\r\n                                    <TableHead>Category</TableHead>\r\n                                    <TableHead className=\"text-right\">Amount</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                <TableRow>\r\n                                    <TableCell>Total Liabilities (Payable)</TableCell>\r\n                                    <TableCell className=\"text-right\">{formatCurrency(stats.pendingPayouts + stats.processedPayouts)}</TableCell>\r\n                                </TableRow>\r\n                                <TableRow>\r\n                                    <TableCell className=\"text-muted-foreground pl-6\">- Paid (Settled)</TableCell>\r\n                                    <TableCell className=\"text-right text-red-500\">-{formatCurrency(stats.processedPayouts)}</TableCell>\r\n                                </TableRow>\r\n                                <TableRow className=\"font-medium\">\r\n                                    <TableCell>Current Pending Payouts</TableCell>\r\n                                    <TableCell className=\"text-right text-orange-500\">{formatCurrency(stats.pendingPayouts)}</TableCell>\r\n                                </TableRow>\r\n                            </TableBody>\r\n                        </Table>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\PromotionsManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\ReportsAnalytics.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1141,1144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1141,1144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReportData'. Either include it or remove the dependency array.","line":46,"column":8,"nodeType":"ArrayExpression","endLine":46,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [dateRangeType, date, fetchReportData]","fix":{"range":[1639,1660],"text":"[dateRangeType, date, fetchReportData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7210,7213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7210,7213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7298,7301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7298,7301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7987,7990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7987,7990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8378,8381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8378,8381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Calendar } from '@/components/ui/calendar';\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from '@/components/ui/popover';\r\nimport { format, startOfDay, endOfDay, startOfWeek, endOfWeek, startOfMonth, endOfMonth } from 'date-fns';\r\nimport { Calendar as CalendarIcon, Download, FileText, Loader2 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport { formatCurrency } from '@/utils/format';\r\n\r\ntype DateRangeType = 'today' | 'week' | 'month' | 'custom';\r\n\r\nexport const ReportsAnalytics = () => {\r\n    const [loading, setLoading] = useState(false);\r\n    const [dateRangeType, setDateRangeType] = useState<DateRangeType>('today');\r\n    const [date, setDate] = useState<Date | undefined>(new Date());\r\n\r\n    // Report Data\r\n    const [reportData, setReportData] = useState<{\r\n        orders: any[];\r\n        summary: {\r\n            totalRevenue: number;\r\n            netEarnings: number;\r\n            platformFees: number;\r\n            commissions: number;\r\n            totalOrders: number;\r\n            deliveredOrders: number;\r\n        };\r\n        settlements: {\r\n            totalSettled: number;\r\n            totalPending: number; // Estimated liability\r\n            processedCount: number;\r\n        };\r\n    } | null>(null);\r\n\r\n    useEffect(() => {\r\n        fetchReportData();\r\n    }, [dateRangeType, date]);\r\n\r\n    const getDateRange = () => {\r\n        const now = new Date();\r\n        let start = startOfDay(now);\r\n        let end = endOfDay(now);\r\n\r\n        if (dateRangeType === 'today') {\r\n            // defaults\r\n        } else if (dateRangeType === 'week') {\r\n            start = startOfWeek(now, { weekStartsOn: 1 }); // Monday\r\n            end = endOfWeek(now, { weekStartsOn: 1 });\r\n        } else if (dateRangeType === 'month') {\r\n            start = startOfMonth(now);\r\n            end = endOfMonth(now);\r\n        } else if (dateRangeType === 'custom' && date) {\r\n            start = startOfDay(date);\r\n            end = endOfDay(date);\r\n        }\r\n\r\n        return { start, end };\r\n    };\r\n\r\n    const fetchReportData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const { start, end } = getDateRange();\r\n\r\n            // 1. Fetch Orders\r\n            const { data: orders, error: ordersError } = await supabase\r\n                .from('orders')\r\n                .select('*, restaurants(name, commission_rate), order_items(quantity, menu_items(name))')\r\n                .gte('created_at', start.toISOString())\r\n                .lte('created_at', end.toISOString())\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (ordersError) throw ordersError;\r\n\r\n            // 2. Fetch Settlements (Processed in this period)\r\n            const { data: settlements, error: settlementsError } = await supabase\r\n                .from('settlements')\r\n                .select('amount, status, created_at')\r\n                .gte('created_at', start.toISOString())\r\n                .lte('created_at', end.toISOString());\r\n\r\n            if (settlementsError) throw settlementsError;\r\n\r\n            // 3. Calculate Financials\r\n            const FIXED_PLATFORM_FEE = 8;\r\n            const DEFAULT_DELIVERY_FEE = 25;\r\n\r\n            let totalRev = 0;\r\n            let totalPlatFees = 0;\r\n            let totalCommissions = 0;\r\n            let deliveredCount = 0;\r\n            let totalLiabilities = 0; // Payable to partners/shops from these orders\r\n\r\n            orders.forEach(order => {\r\n                const total = Number(order.total_amount) || 0;\r\n\r\n                if (order.status === 'delivered') {\r\n                    totalRev += total; // Only count revenue for delivered orders\r\n                    deliveredCount++;\r\n\r\n                    const dFee = Number(order.delivery_fee) || DEFAULT_DELIVERY_FEE;\r\n                    const commissionRate = order.restaurants?.commission_rate || 15;\r\n\r\n                    const subtotal = total - dFee - FIXED_PLATFORM_FEE;\r\n                    const commission = (subtotal * commissionRate) / 100;\r\n\r\n                    totalPlatFees += FIXED_PLATFORM_FEE;\r\n                    totalCommissions += commission;\r\n\r\n                    // Liability calc\r\n                    const shopEarning = Math.max(0, subtotal - commission);\r\n                    totalLiabilities += shopEarning + dFee; // Assuming delivery fee goes to partner\r\n                }\r\n            });\r\n\r\n            // 4. Calculate Settlements\r\n            const totalSettled = settlements?.reduce((sum, s) => sum + Number(s.amount), 0) || 0;\r\n\r\n            // Note: \"Pending\" is hard to define for a time range (it's a snapshot state). \r\n            // Here we show \"Liabilities Generated\" vs \"Settlements Processed\" in this period.\r\n\r\n            setReportData({\r\n                orders,\r\n                summary: {\r\n                    totalRevenue: totalRev,\r\n                    netEarnings: totalPlatFees + totalCommissions,\r\n                    platformFees: totalPlatFees,\r\n                    commissions: totalCommissions,\r\n                    totalOrders: orders.length,\r\n                    deliveredOrders: deliveredCount\r\n                },\r\n                settlements: {\r\n                    totalSettled,\r\n                    totalPending: totalLiabilities, // Labelled as \"Payable Generated\"\r\n                    processedCount: settlements?.length || 0\r\n                }\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('Error fetching report:', error);\r\n            toast.error(\"Failed to load report data\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const downloadPDF = () => {\r\n        if (!reportData) return;\r\n\r\n        const doc = new jsPDF();\r\n        const { start, end } = getDateRange();\r\n        const dateStr = `${format(start, 'MMM d, yyyy')} - ${format(end, 'MMM d, yyyy')}`;\r\n\r\n        // Title\r\n        doc.setFontSize(20);\r\n        doc.text('Admin Comprehensive Report', 14, 22);\r\n        doc.setFontSize(11);\r\n        doc.text(`Period: ${dateStr}`, 14, 30);\r\n        doc.text(`Generated: ${format(new Date(), 'PPpp')}`, 14, 36);\r\n\r\n        // 1. Financial Summary\r\n        doc.text('Financial Summary', 14, 45);\r\n        autoTable(doc, {\r\n            startY: 50,\r\n            head: [['Metric', 'Value']],\r\n            body: [\r\n                ['Total Revenue (GMV)', formatCurrency(reportData.summary.totalRevenue)],\r\n                ['Net Earnings (Profit)', formatCurrency(reportData.summary.netEarnings)],\r\n                ['  - Platform Fees', formatCurrency(reportData.summary.platformFees)],\r\n                ['  - Commissions', formatCurrency(reportData.summary.commissions)],\r\n            ],\r\n            theme: 'grid',\r\n            headStyles: { fillColor: [22, 163, 74] },\r\n        });\r\n\r\n        // 2. Settlements Summary\r\n        doc.text('Settlements & Liabilities', 14, (doc as any).lastAutoTable.finalY + 14);\r\n        autoTable(doc, {\r\n            startY: (doc as any).lastAutoTable.finalY + 20,\r\n            head: [['Metric', 'Value']],\r\n            body: [\r\n                ['Payable Generated (Liabilities)', formatCurrency(reportData.settlements.totalPending)],\r\n                ['Settlements Processed (Paid)', formatCurrency(reportData.settlements.totalSettled)],\r\n                ['Net Flow (Payable - Paid)', formatCurrency(reportData.settlements.totalPending - reportData.settlements.totalSettled)],\r\n            ],\r\n            theme: 'grid',\r\n            headStyles: { fillColor: [59, 130, 246] }, // blue-500\r\n        });\r\n\r\n        // 3. Orders Table\r\n        doc.text(`Order Details (${reportData.summary.totalOrders} Total)`, 14, (doc as any).lastAutoTable.finalY + 14);\r\n\r\n        const tableRows = reportData.orders.map(order => [\r\n            order.id.slice(0, 8),\r\n            format(new Date(order.created_at), 'MMM d, HH:mm'),\r\n            order.restaurants?.name || 'Unknown',\r\n            order.status,\r\n            formatCurrency(order.total_amount)\r\n        ]);\r\n\r\n        autoTable(doc, {\r\n            startY: (doc as any).lastAutoTable.finalY + 20,\r\n            head: [['ID', 'Date', 'Shop', 'Status', 'Amount']],\r\n            body: tableRows,\r\n            theme: 'striped',\r\n            styles: { fontSize: 8 },\r\n            headStyles: { fillColor: [40, 40, 40] },\r\n        });\r\n\r\n        doc.save(`admin_report_${format(start, 'yyyy-MM-dd')}.pdf`);\r\n        toast.success(\"Report downloaded successfully\");\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <Card>\r\n                <CardHeader>\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <FileText className=\"h-5 w-5\" />\r\n                            Export Reports\r\n                        </CardTitle>\r\n                        <Button onClick={downloadPDF} disabled={loading || !reportData?.orders.length}>\r\n                            <Download className=\"mr-2 h-4 w-4\" />\r\n                            Download PDF\r\n                        </Button>\r\n                    </div>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"flex flex-wrap gap-4 mb-6\">\r\n                        <div className=\"flex gap-2\">\r\n                            <Button\r\n                                variant={dateRangeType === 'today' ? 'default' : 'outline'}\r\n                                onClick={() => setDateRangeType('today')}\r\n                            >\r\n                                Today\r\n                            </Button>\r\n                            <Button\r\n                                variant={dateRangeType === 'week' ? 'default' : 'outline'}\r\n                                onClick={() => setDateRangeType('week')}\r\n                            >\r\n                                This Week\r\n                            </Button>\r\n                            <Button\r\n                                variant={dateRangeType === 'month' ? 'default' : 'outline'}\r\n                                onClick={() => setDateRangeType('month')}\r\n                            >\r\n                                This Month\r\n                            </Button>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-sm text-muted-foreground\">Custom Date:</span>\r\n                            <Popover>\r\n                                <PopoverTrigger asChild>\r\n                                    <Button\r\n                                        variant={\"outline\"}\r\n                                        className={`w-[240px] justify-start text-left font-normal ${!date && \"text-muted-foreground\"}`}\r\n                                        onClick={() => setDateRangeType('custom')}\r\n                                    >\r\n                                        <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                                        {date ? format(date, \"PPP\") : <span>Pick a date</span>}\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                                    <Calendar\r\n                                        mode=\"single\"\r\n                                        selected={date}\r\n                                        onSelect={(d) => {\r\n                                            setDate(d);\r\n                                            setDateRangeType('custom');\r\n                                        }}\r\n                                        initialFocus\r\n                                    />\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {loading ? (\r\n                        <div className=\"flex justify-center py-8\">\r\n                            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                        </div>\r\n                    ) : reportData ? (\r\n                        <div className=\"space-y-6\">\r\n                            {/* Stats Grid */}\r\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                                <div className=\"p-4 bg-secondary/10 rounded-lg border\">\r\n                                    <p className=\"text-sm text-muted-foreground\">Revenue</p>\r\n                                    <p className=\"text-2xl font-bold\">{formatCurrency(reportData.summary.totalRevenue)}</p>\r\n                                </div>\r\n                                <div className=\"p-4 bg-green-50 rounded-lg border border-green-100\">\r\n                                    <p className=\"text-sm text-green-600\">Net Earnings</p>\r\n                                    <p className=\"text-2xl font-bold text-green-700\">{formatCurrency(reportData.summary.netEarnings)}</p>\r\n                                </div>\r\n                                <div className=\"p-4 bg-blue-50 rounded-lg border border-blue-100\">\r\n                                    <p className=\"text-sm text-blue-600\">Settled (Paid)</p>\r\n                                    <p className=\"text-2xl font-bold text-blue-700\">{formatCurrency(reportData.settlements.totalSettled)}</p>\r\n                                </div>\r\n                                <div className=\"p-4 bg-secondary/10 rounded-lg border\">\r\n                                    <p className=\"text-sm text-muted-foreground\">Delivered Orders</p>\r\n                                    <p className=\"text-2xl font-bold\">{reportData.summary.deliveredOrders}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Detailed Breakdown for Preview */}\r\n                            <div className=\"grid md:grid-cols-2 gap-4\">\r\n                                <div className=\"rounded-md border p-4\">\r\n                                    <h3 className=\"font-semibold mb-4 text-sm\">Financial Breakdown</h3>\r\n                                    <div className=\"space-y-2 text-sm\">\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span>Platform Fees</span>\r\n                                            <span className=\"font-medium text-green-600\">+{formatCurrency(reportData.summary.platformFees)}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span>Commissions</span>\r\n                                            <span className=\"font-medium text-green-600\">+{formatCurrency(reportData.summary.commissions)}</span>\r\n                                        </div>\r\n                                        <div className=\"border-t pt-2 mt-2 flex justify-between font-bold\">\r\n                                            <span>Net Earnings</span>\r\n                                            <span>{formatCurrency(reportData.summary.netEarnings)}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"rounded-md border p-4\">\r\n                                    <h3 className=\"font-semibold mb-4 text-sm\">Settlements (This Period)</h3>\r\n                                    <div className=\"space-y-2 text-sm\">\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span className=\"text-muted-foreground\">Payable Generated</span>\r\n                                            <span>{formatCurrency(reportData.settlements.totalPending)}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between\">\r\n                                            <span className=\"text-muted-foreground\">Actually Settled</span>\r\n                                            <span className=\"text-blue-600 font-medium\">-{formatCurrency(reportData.settlements.totalSettled)}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"rounded-md border\">\r\n                                <div className=\"bg-muted/50 p-3 text-xs font-medium text-muted-foreground uppercase tracking-wider\">\r\n                                    Recent Orders Preview\r\n                                </div>\r\n                                <table className=\"w-full text-sm\">\r\n                                    <tbody className=\"divide-y\">\r\n                                        {reportData.orders.slice(0, 5).map(order => (\r\n                                            <tr key={order.id} className=\"hover:bg-muted/5\">\r\n                                                <td className=\"p-3 font-mono text-xs\">#{order.id.slice(0, 8)}</td>\r\n                                                <td className=\"p-3 text-xs text-muted-foreground\">{format(new Date(order.created_at), 'MMM d, HH:mm')}</td>\r\n                                                <td className=\"p-3 max-w-[150px] truncate\">{order.restaurants?.name}</td>\r\n                                                <td className=\"p-3\">\r\n                                                    <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium capitalize\r\n                                                        ${order.status === 'delivered' ? 'bg-green-100 text-green-700' : 'bg-secondary text-secondary-foreground'}`}>\r\n                                                        {order.status}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td className=\"p-3 text-right font-medium\">{formatCurrency(order.total_amount)}</td>\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                                {reportData.orders.length > 5 && (\r\n                                    <div className=\"p-3 text-center text-xs text-muted-foreground border-t\">\r\n                                        Download PDF to view full list of {reportData.orders.length} orders\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ) : null}\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\ScheduleSettings.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":45,"column":8,"nodeType":"ArrayExpression","endLine":45,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings]","fix":{"range":[1362,1364],"text":"[fetchSettings]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3036,3039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3036,3039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3355,3358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3355,3358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3987,3990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3987,3990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4137,4140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4137,4140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { toast } from 'sonner';\r\nimport { Clock, Calendar, Save } from 'lucide-react';\r\n\r\ninterface ScheduleConfig {\r\n    enabled: boolean;\r\n    startTime: string;\r\n    endTime: string;\r\n    maxDays: number;\r\n}\r\n\r\nconst DEFAULT_CONFIG: ScheduleConfig = {\r\n    enabled: true,\r\n    startTime: '09:00',\r\n    endTime: '22:00',\r\n    maxDays: 2\r\n};\r\n\r\ninterface OperatingHoursConfig {\r\n    isOpen: boolean;\r\n    startTime: string;\r\n    endTime: string;\r\n}\r\n\r\nconst DEFAULT_OPERATING_HOURS: OperatingHoursConfig = {\r\n    isOpen: true,\r\n    startTime: '08:00',\r\n    endTime: '23:00'\r\n};\r\n\r\nexport function ScheduleSettings() {\r\n    const [config, setConfig] = useState<ScheduleConfig>(DEFAULT_CONFIG);\r\n    const [operatingHours, setOperatingHours] = useState<OperatingHoursConfig>(DEFAULT_OPERATING_HOURS);\r\n    const [loading, setLoading] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchSettings();\r\n    }, []);\r\n\r\n    const fetchSettings = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const { data: scheduleData, error: scheduleError } = await supabase\r\n                .from('app_settings')\r\n                .select('value')\r\n                .eq('key', 'schedule_config')\r\n                .maybeSingle();\r\n\r\n            if (scheduleData?.value) {\r\n                const parsed = typeof scheduleData.value === 'string' ? JSON.parse(scheduleData.value) : scheduleData.value;\r\n                setConfig({ ...DEFAULT_CONFIG, ...parsed });\r\n            } else {\r\n                await saveScheduleSettings(DEFAULT_CONFIG);\r\n            }\r\n\r\n            const { data: opData, error: opError } = await supabase\r\n                .from('app_settings')\r\n                .select('value')\r\n                .eq('key', 'operating_hours')\r\n                .maybeSingle();\r\n\r\n            if (opData?.value) {\r\n                const parsed = typeof opData.value === 'string' ? JSON.parse(opData.value) : opData.value;\r\n                setOperatingHours({ ...DEFAULT_OPERATING_HOURS, ...parsed });\r\n            } else {\r\n                await saveOperatingHours(DEFAULT_OPERATING_HOURS);\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error('Error fetching settings:', error);\r\n            toast.error('Failed to load settings');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const saveScheduleSettings = async (newConfig: ScheduleConfig) => {\r\n        const { error } = await supabase\r\n            .from('app_settings')\r\n            .upsert({\r\n                key: 'schedule_config',\r\n                value: newConfig as any\r\n            });\r\n        if (error) throw error;\r\n    };\r\n\r\n    const saveOperatingHours = async (newConfig: OperatingHoursConfig) => {\r\n        const { error } = await supabase\r\n            .from('app_settings')\r\n            .upsert({\r\n                key: 'operating_hours',\r\n                value: newConfig as any\r\n            });\r\n        if (error) throw error;\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        try {\r\n            await Promise.all([\r\n                saveScheduleSettings(config),\r\n                saveOperatingHours(operatingHours)\r\n            ]);\r\n            toast.success('All settings saved successfully');\r\n        } catch (error) {\r\n            console.error('Error saving settings:', error);\r\n            toast.error('Failed to save settings');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleChange = (field: keyof ScheduleConfig, value: any) => {\r\n        setConfig(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    const handleOpChange = (field: keyof OperatingHoursConfig, value: any) => {\r\n        setOperatingHours(prev => ({ ...prev, [field]: value }));\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className=\"p-4\">Loading settings...</div>;\r\n    }\r\n\r\n    return (\r\n        <Card className=\"border-0 shadow-sm\">\r\n            <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                    <Clock className=\"w-5 h-5 text-primary\" />\r\n                    Platform Time Settings\r\n                </CardTitle>\r\n                <CardDescription>\r\n                    Configure operating hours and scheduled order constraints.\r\n                </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-8\">\r\n                {/* Operating Hours Section */}\r\n                <div className=\"space-y-4 border-b pb-6\">\r\n                    <h3 className=\"text-lg font-semibold flex items-center gap-2\">\r\n                        Platform Operating Hours\r\n                    </h3>\r\n                    <div className=\"flex items-center justify-between p-4 bg-secondary/20 rounded-lg\">\r\n                        <div className=\"space-y-0.5\">\r\n                            <Label className=\"text-base font-medium\">Store Open Status</Label>\r\n                            <p className=\"text-sm text-muted-foreground\">\r\n                                Manually open or close the platform for immediate orders.\r\n                            </p>\r\n                        </div>\r\n                        <Switch\r\n                            checked={operatingHours.isOpen}\r\n                            onCheckedChange={(checked) => handleOpChange('isOpen', checked)}\r\n                        />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Opening Time</Label>\r\n                            <div className=\"relative\">\r\n                                <Clock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    type=\"time\"\r\n                                    value={operatingHours.startTime}\r\n                                    onChange={(e) => handleOpChange('startTime', e.target.value)}\r\n                                    className=\"pl-9\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Closing Time</Label>\r\n                            <div className=\"relative\">\r\n                                <Clock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    type=\"time\"\r\n                                    value={operatingHours.endTime}\r\n                                    onChange={(e) => handleOpChange('endTime', e.target.value)}\r\n                                    className=\"pl-9\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Scheduled Orders Section */}\r\n                <div className=\"space-y-4\">\r\n                    <h3 className=\"text-lg font-semibold flex items-center gap-2\">\r\n                        Future Scheduling Constraints\r\n                    </h3>\r\n                    <div className=\"flex items-center justify-between p-4 bg-secondary/20 rounded-lg\">\r\n                        <div className=\"space-y-0.5\">\r\n                            <Label className=\"text-base font-medium\">Enable Scheduled Orders</Label>\r\n                            <p className=\"text-sm text-muted-foreground\">\r\n                                Allow customers to place orders for a future time/date\r\n                            </p>\r\n                        </div>\r\n                        <Switch\r\n                            checked={config.enabled}\r\n                            onCheckedChange={(checked) => handleChange('enabled', checked)}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Scheduling Start Time</Label>\r\n                            <div className=\"relative\">\r\n                                <Clock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    type=\"time\"\r\n                                    value={config.startTime}\r\n                                    onChange={(e) => handleChange('startTime', e.target.value)}\r\n                                    className=\"pl-9\"\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground\">Earliest slot available for booking</p>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Scheduling End Time</Label>\r\n                            <div className=\"relative\">\r\n                                <Clock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    type=\"time\"\r\n                                    value={config.endTime}\r\n                                    onChange={(e) => handleChange('endTime', e.target.value)}\r\n                                    className=\"pl-9\"\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground\">Latest slot available for booking</p>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Max Days in Advance</Label>\r\n                            <div className=\"relative\">\r\n                                <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    type=\"number\"\r\n                                    min={1}\r\n                                    max={30}\r\n                                    value={config.maxDays}\r\n                                    onChange={(e) => handleChange('maxDays', parseInt(e.target.value))}\r\n                                    className=\"pl-9\"\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground\">How far ahead can customers book?</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"pt-4 flex justify-end\">\r\n                    <Button onClick={handleSave} disabled={saving}>\r\n                        {saving ? (\r\n                            <>Saving...</>\r\n                        ) : (\r\n                            <>\r\n                                <Save className=\"w-4 h-4 mr-2\" />\r\n                                Save All Changes\r\n                            </>\r\n                        )}\r\n                    </Button>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\SettlementsManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4249,4252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4249,4252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":120,"column":8,"nodeType":"ArrayExpression","endLine":120,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[4658,4660],"text":"[fetchData]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from '@/components/ui/table';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n    DialogFooter,\r\n} from '@/components/ui/dialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { formatCurrency } from '@/utils/format';\r\nimport { Loader2, DollarSign } from 'lucide-react';\r\n\r\ninterface PartnerSettlementSummary {\r\n    partner_id: string;\r\n    partner_name: string;\r\n    phone: string;\r\n    total_earnings: number;\r\n    total_settled: number;\r\n    pending_balance: number;\r\n}\r\n\r\nexport const SettlementsManager = () => {\r\n    const [loading, setLoading] = useState(true);\r\n    const [summaries, setSummaries] = useState<PartnerSettlementSummary[]>([]);\r\n    const [selectedPartner, setSelectedPartner] = useState<PartnerSettlementSummary | null>(null);\r\n    const [settleAmount, setSettleAmount] = useState('');\r\n    const [referenceNo, setReferenceNo] = useState('');\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const { toast } = useToast();\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // 1. Fetch all partners\r\n            const { data: partners, error: partnersError } = await supabase\r\n                .from('delivery_partners')\r\n                .select('*')\r\n                .order('created_at');\r\n\r\n            if (partnersError) throw partnersError;\r\n            if (!partners) throw new Error('No partners found');\r\n\r\n            // 1b. Fetch profiles for these partners\r\n            const userIds = partners.map(p => p.user_id);\r\n            const { data: profiles, error: profilesError } = await supabase\r\n                .from('profiles')\r\n                .select('id, full_name, phone')\r\n                .in('id', userIds);\r\n\r\n            if (profilesError) throw profilesError;\r\n\r\n            // 2. Fetch all orders (delivered) to calculate total earnings\r\n            const { data: orders, error: ordersError } = await supabase\r\n                .from('orders')\r\n                .select('delivery_partner_id, delivery_fee, created_at')\r\n                .eq('status', 'delivered');\r\n\r\n            if (ordersError) throw ordersError;\r\n\r\n            // 3. Fetch all settlements\r\n            const { data: settlements, error: settlementsError } = await supabase\r\n                .from('settlements')\r\n                .select('delivery_partner_id, amount');\r\n\r\n            if (settlementsError) throw settlementsError;\r\n\r\n            // 4. Calculate summaries\r\n            const summaryList = partners.map(partner => {\r\n                const profile = profiles?.find(p => p.id === partner.user_id);\r\n                const partnerOrders = orders?.filter(o => o.delivery_partner_id === partner.id) || [];\r\n                const partnerSettlements = settlements?.filter(s => s.delivery_partner_id === partner.id) || [];\r\n\r\n                const rawEarnings = partnerOrders.reduce((sum, o) => sum + (o.delivery_fee || 30), 0);\r\n                const rawSettled = partnerSettlements.reduce((sum, s) => sum + Number(s.amount), 0);\r\n\r\n                // Round to 2 decimal places to avoid floating point errors\r\n                const totalEarnings = Number(Math.max(0, rawEarnings).toFixed(2));\r\n                const totalSettled = Number(rawSettled.toFixed(2));\r\n                const pendingBalance = Number((totalEarnings - totalSettled).toFixed(2));\r\n\r\n                return {\r\n                    partner_id: partner.id,\r\n                    partner_name: profile?.full_name || 'Unknown',\r\n                    phone: profile?.phone || partner.phone || '-',\r\n                    total_earnings: totalEarnings,\r\n                    total_settled: totalSettled,\r\n                    pending_balance: pendingBalance\r\n                };\r\n            });\r\n\r\n            setSummaries(summaryList);\r\n\r\n        } catch (error: any) {\r\n            console.error('Error fetching settlement data:', error);\r\n            toast({\r\n                title: \"Error loading data\",\r\n                description: error.message || \"Failed to load settlement data\",\r\n                variant: \"destructive\"\r\n            });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const handleSettle = async () => {\r\n        if (!selectedPartner || !settleAmount) return;\r\n\r\n        try {\r\n            const { error } = await supabase\r\n                .from('settlements')\r\n                .insert({\r\n                    delivery_partner_id: selectedPartner.partner_id,\r\n                    amount: Number(settleAmount),\r\n                    status: 'processed', // Auto-process for now as Admin is doing it manually\r\n                    reference_no: referenceNo,\r\n                    processed_at: new Date().toISOString()\r\n                });\r\n\r\n            if (error) throw error;\r\n\r\n            toast({\r\n                title: \"Success\",\r\n                description: \"Settlement recorded successfully\",\r\n            });\r\n\r\n            setIsDialogOpen(false);\r\n            setSettleAmount('');\r\n            setReferenceNo('');\r\n            setSelectedPartner(null);\r\n            fetchData(); // Refresh data\r\n\r\n        } catch (error) {\r\n            console.error('Settlement error:', error);\r\n            toast({\r\n                title: \"Error\",\r\n                description: \"Failed to process settlement\",\r\n                variant: \"destructive\"\r\n            });\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className=\"flex justify-center p-8\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>Partner Settlements</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <Table>\r\n                        <TableHeader>\r\n                            <TableRow>\r\n                                <TableHead>Partner</TableHead>\r\n                                <TableHead>Total Earnings</TableHead>\r\n                                <TableHead>Total Settled</TableHead>\r\n                                <TableHead>Pending Balance</TableHead>\r\n                                <TableHead className=\"text-right\">Action</TableHead>\r\n                            </TableRow>\r\n                        </TableHeader>\r\n                        <TableBody>\r\n                            {summaries.map((partner) => (\r\n                                <TableRow key={partner.partner_id}>\r\n                                    <TableCell>\r\n                                        <div>\r\n                                            <div className=\"font-medium\">{partner.partner_name}</div>\r\n                                            <div className=\"text-xs text-muted-foreground\">{partner.phone}</div>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>{formatCurrency(partner.total_earnings)}</TableCell>\r\n                                    <TableCell>{formatCurrency(partner.total_settled)}</TableCell>\r\n                                    <TableCell className={partner.pending_balance > 0 ? \"text-green-600 font-medium\" : \"\"}>\r\n                                        {formatCurrency(partner.pending_balance)}\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right\">\r\n                                        <Button\r\n                                            size=\"sm\"\r\n                                            onClick={() => {\r\n                                                setSelectedPartner(partner);\r\n                                                setSettleAmount(partner.pending_balance.toString());\r\n                                                setIsDialogOpen(true);\r\n                                            }}\r\n                                            disabled={partner.pending_balance < 1}\r\n                                        >\r\n                                            <DollarSign className=\"w-4 h-4 mr-1\" />\r\n                                            Settle\r\n                                        </Button>\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))}\r\n                        </TableBody>\r\n                    </Table>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Process Settlement</DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Partner</label>\r\n                            <Input value={selectedPartner?.partner_name} disabled />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Amount ()</label>\r\n                            <Input\r\n                                type=\"number\"\r\n                                value={settleAmount}\r\n                                onChange={(e) => setSettleAmount(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Reference No. (Optional)</label>\r\n                            <Input\r\n                                value={referenceNo}\r\n                                onChange={(e) => setReferenceNo(e.target.value)}\r\n                                placeholder=\"UPI Ref / Bank Txn ID\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>Cancel</Button>\r\n                        <Button onClick={handleSettle}>Confirm Settlement</Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\ShopSettlementsManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5481,5484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5481,5484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":180,"column":8,"nodeType":"ArrayExpression","endLine":180,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[7026,7028],"text":"[fetchData]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from '@/components/ui/table';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from '@/components/ui/dialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { formatCurrency } from '@/utils/format';\r\nimport { Loader2, DollarSign, Store } from 'lucide-react';\r\n\r\ninterface ShopSettlementSummary {\r\n    restaurant_id: string;\r\n    restaurant_name: string;\r\n    phone: string;\r\n    total_earnings: number; // Net earnings\r\n    total_settled: number;\r\n    pending_balance: number;\r\n    // Breakdown\r\n    gross_total: number;\r\n    total_delivery_fees: number;\r\n    total_platform_fees: number;\r\n    total_commissions: number;\r\n}\r\n\r\nexport const ShopSettlementsManager = () => {\r\n    const [loading, setLoading] = useState(true);\r\n    const [summaries, setSummaries] = useState<ShopSettlementSummary[]>([]);\r\n    const [selectedShop, setSelectedShop] = useState<ShopSettlementSummary | null>(null);\r\n    const [settleAmount, setSettleAmount] = useState('');\r\n    const [referenceNo, setReferenceNo] = useState('');\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const { toast } = useToast();\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            // 1. Fetch all restaurants\r\n            const { data: restaurants, error: restaurantsError } = await supabase\r\n                .from('restaurants')\r\n                .select('id, name, owner_id, phone, commission_rate')\r\n                .order('created_at');\r\n\r\n            if (restaurantsError) throw restaurantsError;\r\n            if (!restaurants) throw new Error('No restaurants found');\r\n\r\n            // 2. Fetch all delivered orders\r\n            const { data: orders, error: ordersError } = await supabase\r\n                .from('orders')\r\n                .select('restaurant_id, total_amount, delivery_fee')\r\n                .eq('status', 'delivered');\r\n\r\n            if (ordersError) throw ordersError;\r\n\r\n            // 3. Fetch all settlements for restaurants\r\n            const { data: settlements, error: settlementsError } = await supabase\r\n                .from('settlements')\r\n                .select('restaurant_id, amount')\r\n                .not('restaurant_id', 'is', null);\r\n\r\n            if (settlementsError) throw settlementsError;\r\n\r\n            // 4. Calculate summaries\r\n            const summaryList = restaurants.map(restaurant => {\r\n                const shopOrders = orders?.filter(o => o.restaurant_id === restaurant.id) || [];\r\n                const shopSettlements = settlements?.filter(s => s.restaurant_id === restaurant.id) || [];\r\n\r\n                // Logic: \r\n                // Item Total = Order Total - Delivery Fee\r\n                // Platform Fee = Item Total * (Commission Rate / 100)\r\n                // Restaurant Earnings = Item Total - Platform Fee\r\n\r\n                const commissionRate = Number(restaurant.commission_rate) || 15; // Default 15%\r\n                const FIXED_PLATFORM_FEE = 8; // Matches App hardcoded fee\r\n                const DEFAULT_DELIVERY_FEE = 25; // Matches App default\r\n\r\n                const breakdown = shopOrders.reduce((acc, o) => {\r\n                    const orderTotal = Number(o.total_amount) || 0;\r\n                    const dFee = Number(o.delivery_fee) || DEFAULT_DELIVERY_FEE;\r\n\r\n                    // Logic from RestaurantDashboard.tsx:\r\n                    // subtotal = Total - Delivery - FixedPlatformFee\r\n                    // commission = subtotal * rate\r\n                    // earnings = subtotal - commission\r\n\r\n                    const subtotal = orderTotal - dFee - FIXED_PLATFORM_FEE;\r\n                    const commission = (subtotal * commissionRate) / 100;\r\n                    const earning = Math.max(0, subtotal - commission);\r\n\r\n                    return {\r\n                        gross: acc.gross + orderTotal,\r\n                        delivery: acc.delivery + dFee,\r\n                        platform: acc.platform + FIXED_PLATFORM_FEE,\r\n                        commission: acc.commission + commission,\r\n                        net: acc.net + earning\r\n                    };\r\n                }, { gross: 0, delivery: 0, platform: 0, commission: 0, net: 0 });\r\n\r\n                const rawSettled = shopSettlements.reduce((sum, s) => sum + Number(s.amount), 0);\r\n\r\n                return {\r\n                    restaurant_id: restaurant.id,\r\n                    restaurant_name: restaurant.name,\r\n                    phone: restaurant.phone || '-',\r\n                    total_earnings: Number(breakdown.net.toFixed(2)),\r\n                    total_settled: Number(rawSettled.toFixed(2)),\r\n                    pending_balance: Number((breakdown.net - rawSettled).toFixed(2)),\r\n\r\n                    gross_total: breakdown.gross,\r\n                    total_delivery_fees: breakdown.delivery,\r\n                    total_platform_fees: breakdown.platform,\r\n                    total_commissions: breakdown.commission\r\n                };\r\n            });\r\n\r\n            setSummaries(summaryList);\r\n\r\n        } catch (error: any) {\r\n            console.error('Error fetching shop settlement data:', error);\r\n            toast({\r\n                title: \"Error loading data\",\r\n                description: error.message || \"Failed to load settlement data\",\r\n                variant: \"destructive\"\r\n            });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n\r\n        // Subscribe to real-time changes\r\n        const channel = supabase\r\n            .channel('shop-settlements-updates')\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'orders'\r\n                },\r\n                (payload) => {\r\n                    // Only refresh if order status changed to/from 'delivered' or new delivered order\r\n                    // But for simplicity/robustness, we'll refresh on relevant changes\r\n                    if (payload.new && 'status' in payload.new) {\r\n                        fetchData();\r\n                    }\r\n                }\r\n            )\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'settlements'\r\n                },\r\n                () => {\r\n                    fetchData();\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, []);\r\n\r\n    const handleSettle = async () => {\r\n        if (!selectedShop || !settleAmount) return;\r\n\r\n        try {\r\n            const { error } = await supabase\r\n                .from('settlements')\r\n                .insert({\r\n                    restaurant_id: selectedShop.restaurant_id,\r\n                    delivery_partner_id: null, // Explicitly null\r\n                    amount: Number(settleAmount),\r\n                    status: 'processed',\r\n                    reference_no: referenceNo,\r\n                    processed_at: new Date().toISOString()\r\n                });\r\n\r\n            if (error) throw error;\r\n\r\n            toast({\r\n                title: \"Success\",\r\n                description: \"Settlement recorded successfully\",\r\n            });\r\n\r\n            setIsDialogOpen(false);\r\n            setSettleAmount('');\r\n            setReferenceNo('');\r\n            setSelectedShop(null);\r\n            fetchData(); // Refresh data\r\n\r\n        } catch (error) {\r\n            console.error('Settlement error:', error);\r\n            toast({\r\n                title: \"Error\",\r\n                description: \"Failed to process settlement\",\r\n                variant: \"destructive\"\r\n            });\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className=\"flex justify-center p-8\"><Loader2 className=\"h-8 w-8 animate-spin\" /></div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <Store className=\"h-5 w-5\" />\r\n                        Shop Settlements\r\n                    </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <Table>\r\n                        <TableHeader>\r\n                            <TableRow>\r\n                                <TableHead>Shop</TableHead>\r\n                                <TableHead>Total Earnings</TableHead>\r\n                                <TableHead>Total Settled</TableHead>\r\n                                <TableHead>Pending Balance</TableHead>\r\n                                <TableHead className=\"text-right\">Action</TableHead>\r\n                            </TableRow>\r\n                        </TableHeader>\r\n                        <TableBody>\r\n                            {summaries.map((shop) => (\r\n                                <TableRow key={shop.restaurant_id}>\r\n                                    <TableCell>\r\n                                        <div>\r\n                                            <div className=\"font-medium\">{shop.restaurant_name}</div>\r\n                                            <div className=\"text-xs text-muted-foreground\">{shop.phone}</div>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        <div className=\"group relative\">\r\n                                            <span className=\"cursor-help underline decoration-dotted decoration-muted-foreground/50\">\r\n                                                {formatCurrency(shop.total_earnings)}\r\n                                            </span>\r\n                                            {/* Hover Card */}\r\n                                            <div className=\"absolute left-0 top-full z-50 hidden min-w-[240px] rounded-lg border bg-popover p-4 shadow-md group-hover:block\">\r\n                                                <div className=\"space-y-2\">\r\n                                                    <h4 className=\"font-medium text-xs text-muted-foreground uppercase tracking-wider mb-2\">Earnings Breakdown</h4>\r\n                                                    <div className=\"flex justify-between text-sm\">\r\n                                                        <span>Gross Total:</span>\r\n                                                        <span className=\"font-mono\">{formatCurrency(shop.gross_total)}</span>\r\n                                                    </div>\r\n                                                    <div className=\"flex justify-between text-xs text-red-500\">\r\n                                                        <span>Delivery Fees:</span>\r\n                                                        <span className=\"font-mono\">-{formatCurrency(shop.total_delivery_fees)}</span>\r\n                                                    </div>\r\n                                                    <div className=\"flex justify-between text-xs text-red-500\">\r\n                                                        <span>Platform Fees:</span>\r\n                                                        <span className=\"font-mono\">-{formatCurrency(shop.total_platform_fees)}</span>\r\n                                                    </div>\r\n                                                    <div className=\"flex justify-between text-xs text-red-500\">\r\n                                                        <span>Commissions:</span>\r\n                                                        <span className=\"font-mono\">-{formatCurrency(shop.total_commissions)}</span>\r\n                                                    </div>\r\n                                                    <div className=\"my-2 border-t pt-2 flex justify-between font-bold text-sm\">\r\n                                                        <span>Net Earnings:</span>\r\n                                                        <span className=\"font-mono\">{formatCurrency(shop.total_earnings)}</span>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>{formatCurrency(shop.total_settled)}</TableCell>\r\n                                    <TableCell className={shop.pending_balance > 0 ? \"text-green-600 font-medium\" : \"\"}>\r\n                                        {formatCurrency(shop.pending_balance)}\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right\">\r\n                                        <Button\r\n                                            size=\"sm\"\r\n                                            onClick={() => {\r\n                                                setSelectedShop(shop);\r\n                                                setSettleAmount(shop.pending_balance.toString());\r\n                                                setIsDialogOpen(true);\r\n                                            }}\r\n                                            disabled={shop.pending_balance < 1}\r\n                                        >\r\n                                            <DollarSign className=\"w-4 h-4 mr-1\" />\r\n                                            Settle\r\n                                        </Button>\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))}\r\n                            {summaries.length === 0 && (\r\n                                <TableRow>\r\n                                    <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\r\n                                        No shops found\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            )}\r\n                        </TableBody>\r\n                    </Table>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Process Shop Settlement</DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Shop</label>\r\n                            <Input value={selectedShop?.restaurant_name} disabled />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Amount ()</label>\r\n                            <Input\r\n                                type=\"number\"\r\n                                value={settleAmount}\r\n                                onChange={(e) => setSettleAmount(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Reference No. (Optional)</label>\r\n                            <Input\r\n                                value={referenceNo}\r\n                                onChange={(e) => setReferenceNo(e.target.value)}\r\n                                placeholder=\"UPI Ref / Bank Txn ID\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>Cancel</Button>\r\n                        <Button onClick={handleSettle}>Confirm Settlement</Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\admin\\TicketDetailDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[800,803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[800,803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1091,1094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1091,1094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMessages'. Either include it or remove the dependency array.","line":66,"column":8,"nodeType":"ArrayExpression","endLine":66,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMessages, open, ticket]","fix":{"range":[2271,2285],"text":"[fetchMessages, open, ticket]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/hooks/useAuth\"; // Assuming useAuth exists\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { toast } from \"sonner\";\r\nimport { Send, Loader2, User, UserCog } from \"lucide-react\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\n\r\ninterface TicketDetailDialogProps {\r\n    ticket: any;\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    onUpdate: () => void;\r\n}\r\n\r\nexport const TicketDetailDialog = ({ ticket, open, onOpenChange, onUpdate }: TicketDetailDialogProps) => {\r\n    const { session } = useAuth();\r\n    const [messages, setMessages] = useState<any[]>([]);\r\n    const [reply, setReply] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n    const [sending, setSending] = useState(false);\r\n    const [status, setStatus] = useState(ticket?.status || \"open\");\r\n\r\n    useEffect(() => {\r\n        if (open && ticket) {\r\n            setStatus(ticket.status);\r\n            fetchMessages();\r\n            // Subscribe to new messages for this ticket\r\n            const channel = supabase\r\n                .channel(`ticket-${ticket.id}`)\r\n                .on(\r\n                    'postgres_changes',\r\n                    {\r\n                        event: 'INSERT',\r\n                        schema: 'public',\r\n                        table: 'support_messages',\r\n                        filter: `ticket_id=eq.${ticket.id}`\r\n                    },\r\n                    (payload) => {\r\n                        console.log('New message received:', payload);\r\n                        fetchMessages(); // Refresh messages on new insert\r\n                    }\r\n                )\r\n                .subscribe();\r\n\r\n            return () => {\r\n                supabase.removeChannel(channel);\r\n            };\r\n        }\r\n    }, [open, ticket]);\r\n\r\n    const fetchMessages = async () => {\r\n        if (!ticket) return;\r\n        setLoading(true);\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from(\"support_messages\")\r\n                .select(`\r\n                    *,\r\n                    sender:profiles!support_messages_sender_id_fkey(full_name, role)\r\n                `)\r\n                .eq(\"ticket_id\", ticket.id)\r\n                .order(\"created_at\", { ascending: true });\r\n\r\n            if (error) throw error;\r\n            setMessages(data || []);\r\n        } catch (error) {\r\n            console.error(\"Error fetching messages:\", error);\r\n            toast.error(\"Failed to load messages\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const sendReply = async () => {\r\n        if (!reply.trim() || !session?.user) return;\r\n        setSending(true);\r\n        try {\r\n            const { error } = await supabase\r\n                .from(\"support_messages\")\r\n                .insert({\r\n                    ticket_id: ticket.id,\r\n                    sender_id: session.user.id,\r\n                    message: reply.trim()\r\n                });\r\n\r\n            if (error) throw error;\r\n\r\n            // Optional: Auto-update status to 'in_progress' if it was 'open'\r\n            if (status === 'open') {\r\n                await updateStatus('in_progress');\r\n            }\r\n\r\n            setReply(\"\");\r\n            fetchMessages();\r\n            toast.success(\"Reply sent\");\r\n        } catch (error) {\r\n            console.error(\"Error sending reply:\", error);\r\n            toast.error(\"Failed to send reply\");\r\n        } finally {\r\n            setSending(false);\r\n        }\r\n    };\r\n\r\n    const updateStatus = async (newStatus: string) => {\r\n        try {\r\n            const { error } = await supabase\r\n                .from(\"support_tickets\")\r\n                .update({ status: newStatus })\r\n                .eq(\"id\", ticket.id);\r\n\r\n            if (error) throw error;\r\n            setStatus(newStatus);\r\n            onUpdate(); // Refresh parent list\r\n            toast.success(`Ticket marked as ${newStatus.replace('_', ' ')}`);\r\n        } catch (error) {\r\n            console.error(\"Error updating status:\", error);\r\n            toast.error(\"Failed to update status\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"max-w-2xl h-[80vh] flex flex-col\">\r\n                <DialogHeader>\r\n                    <div className=\"flex justify-between items-start\">\r\n                        <div>\r\n                            <DialogTitle className=\"text-xl\">{ticket?.subject}</DialogTitle>\r\n                            <p className=\"text-sm text-muted-foreground mt-1\">\r\n                                Ticket #{ticket?.id.slice(0, 8)}  {ticket?.priority} Priority\r\n                            </p>\r\n                        </div>\r\n                        <Select value={status} onValueChange={updateStatus}>\r\n                            <SelectTrigger className=\"w-[140px]\">\r\n                                <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"open\">Open</SelectItem>\r\n                                <SelectItem value=\"in_progress\">In Progress</SelectItem>\r\n                                <SelectItem value=\"resolved\">Resolved</SelectItem>\r\n                                <SelectItem value=\"closed\">Closed</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n                </DialogHeader>\r\n\r\n                <div className=\"flex-1 overflow-hidden border rounded-md bg-muted/10 p-4\">\r\n                    <ScrollArea className=\"h-full pr-4\">\r\n                        <div className=\"space-y-4\">\r\n                            {loading ? (\r\n                                <div className=\"flex justify-center p-4\">\r\n                                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\r\n                                </div>\r\n                            ) : messages.length === 0 ? (\r\n                                <p className=\"text-center text-muted-foreground py-10\">No messages yet</p>\r\n                            ) : (\r\n                                messages.map((msg) => {\r\n                                    // Determine if the message is from the customer (ticket creator) or support\r\n                                    const isCustomer = msg.sender_id === ticket.user_id;\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={msg.id}\r\n                                            className={`flex gap-3 ${isCustomer ? \"\" : \"flex-row-reverse\"}`}\r\n                                        >\r\n                                            <div className={`p-2 rounded-full h-8 w-8 flex items-center justify-center shrink-0 \r\n                                                ${isCustomer ? \"bg-blue-100 text-blue-600\" : \"bg-primary text-primary-foreground\"}`}>\r\n                                                {isCustomer ? <User size={14} /> : <UserCog size={14} />}\r\n                                            </div>\r\n                                            <div className={`flex flex-col max-w-[80%] ${isCustomer ? \"items-start\" : \"items-end\"}`}>\r\n                                                <div className={`rounded-lg p-3 text-sm \r\n                                                    ${isCustomer\r\n                                                        ? \"bg-white border text-foreground\"\r\n                                                        : \"bg-primary text-primary-foreground\"\r\n                                                    }`}>\r\n                                                    {msg.message}\r\n                                                </div>\r\n                                                <span className=\"text-[10px] text-muted-foreground mt-1 px-1\">\r\n                                                    {msg.sender?.full_name || 'User'}  {formatDistanceToNow(new Date(msg.created_at), { addSuffix: true })}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    );\r\n                                })\r\n                            )}\r\n                        </div>\r\n                    </ScrollArea>\r\n                </div>\r\n\r\n                <DialogFooter className=\"mt-4\">\r\n                    <div className=\"w-full flex gap-2\">\r\n                        <Textarea\r\n                            value={reply}\r\n                            onChange={(e) => setReply(e.target.value)}\r\n                            placeholder=\"Type your reply...\"\r\n                            className=\"flex-1 min-h-[60px]\"\r\n                            onKeyDown={(e) => {\r\n                                if (e.key === 'Enter' && !e.shiftKey) {\r\n                                    e.preventDefault();\r\n                                    sendReply();\r\n                                }\r\n                            }}\r\n                        />\r\n                        <Button\r\n                            onClick={sendReply}\r\n                            disabled={sending || !reply.trim()}\r\n                            className=\"h-auto\"\r\n                        >\r\n                            {sending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Send className=\"h-4 w-4\" />}\r\n                        </Button>\r\n                    </div>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\auth\\PhoneLogin.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1707,1710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1707,1710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3202,3205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3202,3205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":93,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":93,"endColumn":30,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3526,3539],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4200,4203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4200,4203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { toast } from 'sonner';\r\nimport { Phone, ArrowRight, Loader2 } from 'lucide-react';\r\nimport {\r\n    InputOTP,\r\n    InputOTPGroup,\r\n    InputOTPSlot,\r\n} from '@/components/ui/input-otp';\r\nimport { auth } from '@/integrations/firebase/client';\r\nimport { RecaptchaVerifier, signInWithPhoneNumber, ConfirmationResult } from 'firebase/auth';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\ndeclare global {\r\n    interface Window {\r\n        recaptchaVerifier: RecaptchaVerifier;\r\n    }\r\n}\r\n\r\nexport const PhoneLogin = () => {\r\n    const [phoneNumber, setPhoneNumber] = useState('');\r\n    const [otp, setOtp] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [step, setStep] = useState<'phone' | 'otp'>('phone');\r\n    const [confirmationResult, setConfirmationResult] = useState<ConfirmationResult | null>(null);\r\n\r\n    useEffect(() => {\r\n        // Cleanup recaptcha on unmount\r\n        return () => {\r\n            if (window.recaptchaVerifier) {\r\n                window.recaptchaVerifier.clear();\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    const setupRecaptcha = () => {\r\n        if (!window.recaptchaVerifier) {\r\n            window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {\r\n                'size': 'invisible',\r\n                'callback': () => {\r\n                    // reCAPTCHA solved, allow signInWithPhoneNumber.\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    const exchangeFirebaseToken = async (firebaseUser: any) => {\r\n        try {\r\n            const idToken = await firebaseUser.getIdToken();\r\n            const { data, error } = await supabase.functions.invoke('verify-firebase-token', {\r\n                body: { firebaseToken: idToken }\r\n            });\r\n\r\n            if (error) throw error;\r\n            if (data.error) throw new Error(data.error);\r\n\r\n            // Set Supabase Session\r\n            const { error: sessionError } = await supabase.auth.setSession({\r\n                access_token: data.access_token,\r\n                refresh_token: data.access_token // Using same for now, or handle refresh logic\r\n            });\r\n\r\n            if (sessionError) throw sessionError;\r\n\r\n            toast.success('Synced with Supabase successfully!');\r\n        } catch (err) {\r\n            console.error('Bridge Error:', err);\r\n            toast.error('Login successful, but data sync failed.');\r\n        }\r\n    };\r\n\r\n    const handleSendOtp = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n\r\n        try {\r\n            setupRecaptcha();\r\n            const formattedPhone = phoneNumber.startsWith('+') ? phoneNumber : `+91${phoneNumber}`;\r\n            const appVerifier = window.recaptchaVerifier;\r\n\r\n            const confirmation = await signInWithPhoneNumber(auth, formattedPhone, appVerifier);\r\n            setConfirmationResult(confirmation);\r\n            setStep('otp');\r\n            toast.success('OTP sent successfully!');\r\n        } catch (error: any) {\r\n            console.error('Error sending OTP:', error);\r\n            toast.error(error.message || 'Failed to send OTP. Please try again.');\r\n            // Reset recaptcha on error so user can try again\r\n            if (window.recaptchaVerifier) {\r\n                window.recaptchaVerifier.clear();\r\n                // @ts-ignore\r\n                window.recaptchaVerifier = null;\r\n            }\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleVerifyOtp = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!confirmationResult || otp.length !== 6) return;\r\n\r\n        setLoading(true);\r\n        try {\r\n            const result = await confirmationResult.confirm(otp);\r\n            const user = result.user;\r\n            console.log('User signed in:', user);\r\n\r\n            // Auto-exchange token\r\n            await exchangeFirebaseToken(user);\r\n\r\n            toast.success('Successfully logged in!');\r\n        } catch (error: any) {\r\n            console.error('Error verifying OTP:', error);\r\n            toast.error('Invalid OTP. Please try again.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div id=\"recaptcha-container\"></div>\r\n\r\n            {step === 'phone' ? (\r\n                <form onSubmit={handleSendOtp} className=\"space-y-4 animate-fade-in\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"phone\">Phone Number</Label>\r\n                        <div className=\"relative\">\r\n                            <Phone className=\"absolute left-3 top-2.5 h-5 w-5 text-muted-foreground\" />\r\n                            <Input\r\n                                id=\"phone\"\r\n                                type=\"tel\"\r\n                                placeholder=\"9876543210\"\r\n                                className=\"pl-10\"\r\n                                value={phoneNumber}\r\n                                onChange={(e) => setPhoneNumber(e.target.value)}\r\n                                required\r\n                            />\r\n                        </div>\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                            We'll send you a 6-digit code to verify directly.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <Button type=\"submit\" className=\"w-full\" disabled={loading || phoneNumber.length < 10}>\r\n                        {loading ? (\r\n                            <>\r\n                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                Sending OTP...\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                Send OTP\r\n                                <ArrowRight className=\"ml-2 h-4 w-4\" />\r\n                            </>\r\n                        )}\r\n                    </Button>\r\n                </form>\r\n            ) : (\r\n                <form onSubmit={handleVerifyOtp} className=\"space-y-4 animate-fade-in\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Enter OTP</Label>\r\n                        <div className=\"flex justify-center py-2\">\r\n                            <InputOTP\r\n                                maxLength={6}\r\n                                value={otp}\r\n                                onChange={(value) => setOtp(value)}\r\n                            >\r\n                                <InputOTPGroup>\r\n                                    <InputOTPSlot index={0} />\r\n                                    <InputOTPSlot index={1} />\r\n                                    <InputOTPSlot index={2} />\r\n                                    <InputOTPSlot index={3} />\r\n                                    <InputOTPSlot index={4} />\r\n                                    <InputOTPSlot index={5} />\r\n                                </InputOTPGroup>\r\n                            </InputOTP>\r\n                        </div>\r\n                        <p className=\"text-center text-xs text-muted-foreground\">\r\n                            Enter the code sent to {phoneNumber}\r\n                        </p>\r\n                    </div>\r\n\r\n                    <Button type=\"submit\" className=\"w-full\" disabled={loading || otp.length !== 6}>\r\n                        {loading ? (\r\n                            <>\r\n                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                Verifying...\r\n                            </>\r\n                        ) : (\r\n                            'Verify & Login'\r\n                        )}\r\n                    </Button>\r\n\r\n                    <Button\r\n                        type=\"button\"\r\n                        variant=\"ghost\"\r\n                        className=\"w-full\"\r\n                        onClick={() => setStep('phone')}\r\n                        disabled={loading}\r\n                    >\r\n                        Change Phone Number\r\n                    </Button>\r\n                </form>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\layouts\\DashboardLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\restaurant\\RestaurantDeliveryAreas.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\restaurant\\RestaurantDeliveryPincodesManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2145,2148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2145,2148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { RestaurantDeliveryPincode } from '@/types/database';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Trash2, MapPin, Plus, Loader2, ChevronsUpDown, Check } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n    Command,\r\n    CommandEmpty,\r\n    CommandGroup,\r\n    CommandInput,\r\n    CommandItem,\r\n    CommandList,\r\n} from '@/components/ui/command';\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from '@/components/ui/popover';\r\n\r\ninterface Props {\r\n    restaurantId: string;\r\n}\r\n\r\nexport function RestaurantDeliveryPincodesManager({ restaurantId }: Props) {\r\n    const [pincodes, setPincodes] = useState<RestaurantDeliveryPincode[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [newPincode, setNewPincode] = useState('');\r\n    const [newDescription, setNewDescription] = useState('');\r\n    const [search, setSearch] = useState('');\r\n    const [adding, setAdding] = useState(false);\r\n    const [fetchingDetails, setFetchingDetails] = useState(false);\r\n    const [availableDescriptions, setAvailableDescriptions] = useState<string[]>([]);\r\n    const [openDescription, setOpenDescription] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const fetchPincodeDetails = async () => {\r\n            if (newPincode.length === 6) {\r\n                setFetchingDetails(true);\r\n                try {\r\n                    const response = await fetch(`https://api.postalpincode.in/pincode/${newPincode}`);\r\n                    const data = await response.json();\r\n\r\n                    if (data && data[0] && data[0].Status === 'Success') {\r\n                        const postOffices = data[0].PostOffice;\r\n                        if (postOffices && postOffices.length > 0) {\r\n                            const areas = postOffices.map((po: any) => `${po.Name}, ${po.District}`);\r\n                            setAvailableDescriptions(areas);\r\n                            setNewDescription(areas[0]);\r\n                            toast.success(`Found ${areas.length} related areas from postal data`);\r\n                        }\r\n                    } else {\r\n                        toast.error('Invalid Pincode or details not found');\r\n                        setNewDescription('');\r\n                        setAvailableDescriptions([]);\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error fetching pincode details:', error);\r\n                } finally {\r\n                    setFetchingDetails(false);\r\n                }\r\n            }\r\n        };\r\n\r\n        const timeoutId = setTimeout(() => {\r\n            if (newPincode.length === 6) {\r\n                fetchPincodeDetails();\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearTimeout(timeoutId);\r\n    }, [newPincode]);\r\n\r\n    const fetchPincodes = useCallback(async () => {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('restaurant_delivery_pincodes')\r\n                .select('*')\r\n                .eq('restaurant_id', restaurantId)\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (error) throw error;\r\n            setPincodes(data || []);\r\n        } catch (error) {\r\n            toast.error('Failed to load pincodes');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [restaurantId]);\r\n\r\n    useEffect(() => {\r\n        fetchPincodes();\r\n    }, [fetchPincodes]);\r\n\r\n    const addPincode = async () => {\r\n        if (!newPincode.trim() || newPincode.length < 6) {\r\n            toast.error('Please enter a valid 6-digit pincode');\r\n            return;\r\n        }\r\n\r\n        if (!newDescription.trim()) {\r\n            toast.error('Description is required');\r\n            return;\r\n        }\r\n\r\n        setAdding(true);\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('restaurant_delivery_pincodes')\r\n                .insert({\r\n                    restaurant_id: restaurantId,\r\n                    pincode: newPincode,\r\n                    description: newDescription || null,\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) {\r\n                if (error.code === '23505') { // Unique violation\r\n                    toast.error('This pincode is already added');\r\n                } else {\r\n                    toast.error('Failed to add pincode');\r\n                    throw error;\r\n                }\r\n            } else {\r\n                setPincodes([data, ...pincodes]);\r\n                setNewPincode('');\r\n                setNewDescription('');\r\n                toast.success('Delivery area added successfully');\r\n            }\r\n        } catch (error) {\r\n            // Already handled error toast above\r\n        } finally {\r\n            setAdding(false);\r\n        }\r\n    };\r\n\r\n    const toggleStatus = async (id: string, currentStatus: boolean) => {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('restaurant_delivery_pincodes')\r\n                .update({ is_active: !currentStatus })\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            setPincodes(pincodes.map(p =>\r\n                p.id === id ? { ...p, is_active: !currentStatus } : p\r\n            ));\r\n            toast.success(`Pincode ${!currentStatus ? 'activated' : 'deactivated'}`);\r\n        } catch (error) {\r\n            toast.error('Failed to update status');\r\n        }\r\n    };\r\n\r\n    const deletePincode = async (id: string) => {\r\n        if (!confirm('Are you sure you want to delete this delivery area?')) return;\r\n\r\n        try {\r\n            const { error } = await supabase\r\n                .from('restaurant_delivery_pincodes')\r\n                .delete()\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            setPincodes(pincodes.filter(p => p.id !== id));\r\n            toast.success('Delivery area deleted');\r\n        } catch (error) {\r\n            toast.error('Failed to delete delivery area');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Card className=\"border-0 shadow-sm\">\r\n            <CardHeader className=\"pb-3\">\r\n                <CardTitle className=\"flex items-center gap-2 text-base\">\r\n                    <MapPin className=\"w-4 h-4 text-primary\" />\r\n                    Delivery Areas ({pincodes.length})\r\n                </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n                <div className=\"space-y-6\">\r\n                    {/* Add New Pincode */}\r\n                    <div className=\"flex flex-col md:flex-row gap-3 items-end bg-secondary/20 p-4 rounded-xl border border-border/50\">\r\n                        <div className=\"space-y-2 w-full md:flex-1\">\r\n                            <label className=\"text-xs font-medium text-muted-foreground\">Pincode</label>\r\n                            <Input\r\n                                placeholder=\"Ex: 500001\"\r\n                                value={newPincode}\r\n                                onChange={(e) => setNewPincode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\r\n                                maxLength={6}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2 w-full md:flex-[2]\">\r\n                            <label className=\"text-xs font-medium text-muted-foreground flex items-center gap-2\">\r\n                                Description <span className=\"text-destructive\">*</span>\r\n                                {fetchingDetails && <Loader2 className=\"w-3 h-3 animate-spin\" />}\r\n                            </label>\r\n\r\n                            <Popover\r\n                                open={openDescription}\r\n                                onOpenChange={(open) => {\r\n                                    setOpenDescription(open);\r\n                                    if (open) setSearch('');\r\n                                }}\r\n                            >\r\n                                <PopoverTrigger asChild>\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        role=\"combobox\"\r\n                                        aria-expanded={openDescription}\r\n                                        className=\"w-full justify-between font-normal text-left px-3\"\r\n                                    >\r\n                                        <span className=\"truncate\">\r\n                                            {newDescription || \"Select or type description...\"}\r\n                                        </span>\r\n                                        <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\r\n                                    <Command>\r\n                                        <CommandInput\r\n                                            placeholder=\"Search or type custom...\"\r\n                                            value={search}\r\n                                            onValueChange={setSearch}\r\n                                        />\r\n                                        <CommandList>\r\n                                            <CommandEmpty>\r\n                                                <Button\r\n                                                    variant=\"ghost\"\r\n                                                    className=\"w-full justify-start text-xs h-8\"\r\n                                                    onClick={() => {\r\n                                                        setNewDescription(search);\r\n                                                        setOpenDescription(false);\r\n                                                    }}\r\n                                                >\r\n                                                    Use \"{search}\"\r\n                                                </Button>\r\n                                            </CommandEmpty>\r\n                                            <CommandGroup heading=\"Available Areas\">\r\n                                                {availableDescriptions.map((desc) => (\r\n                                                    <CommandItem\r\n                                                        key={desc}\r\n                                                        value={desc}\r\n                                                        onSelect={(currentValue) => {\r\n                                                            setNewDescription(currentValue);\r\n                                                            setOpenDescription(false);\r\n                                                        }}\r\n                                                    >\r\n                                                        <Check\r\n                                                            className={cn(\r\n                                                                \"mr-2 h-4 w-4\",\r\n                                                                newDescription === desc ? \"opacity-100\" : \"opacity-0\"\r\n                                                            )}\r\n                                                        />\r\n                                                        {desc}\r\n                                                    </CommandItem>\r\n                                                ))}\r\n                                            </CommandGroup>\r\n                                        </CommandList>\r\n                                    </Command>\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                        </div>\r\n                        <Button onClick={addPincode} disabled={adding || !newPincode || !newDescription}>\r\n                            {adding ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Plus className=\"w-4 h-4 mr-1\" />}\r\n                            Add\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {/* List */}\r\n                    <div className=\"space-y-3\">\r\n                        {loading ? (\r\n                            <div className=\"text-center py-10 text-muted-foreground\">Loading areas...</div>\r\n                        ) : pincodes.length === 0 ? (\r\n                            <div className=\"text-center py-10 text-muted-foreground\">No delivery areas defined yet.</div>\r\n                        ) : (\r\n                            <div className=\"grid sm:grid-cols-2 gap-3\">\r\n                                {pincodes.map((item) => (\r\n                                    <div\r\n                                        key={item.id}\r\n                                        className=\"flex items-center justify-between p-3 rounded-xl border border-border bg-card hover:bg-secondary/30 transition-all\"\r\n                                    >\r\n                                        <div className=\"min-w-0\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <span className=\"font-mono text-base font-bold text-primary\">\r\n                                                    {item.pincode}\r\n                                                </span>\r\n                                                <Switch\r\n                                                    checked={item.is_active}\r\n                                                    onCheckedChange={() => toggleStatus(item.id, item.is_active)}\r\n                                                    className=\"scale-75\"\r\n                                                />\r\n                                            </div>\r\n                                            {item.description && (\r\n                                                <p className=\"text-xs text-muted-foreground mt-0.5 truncate max-w-[200px]\" title={item.description}>\r\n                                                    {item.description}\r\n                                                </p>\r\n                                            )}\r\n                                        </div>\r\n                                        <Button\r\n                                            variant=\"ghost\"\r\n                                            size=\"icon\"\r\n                                            className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-8 w-8\"\r\n                                            onClick={() => deletePincode(item.id)}\r\n                                        >\r\n                                            <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":33,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":33,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":61,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":61,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\form.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":130,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":130,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\navigation-menu.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":112,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":112,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\sidebar.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":637,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":637,"endColumn":13,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":28,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":28,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\toggle.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":38,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":38,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\hooks\\useAppSettings.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[193,196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[193,196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[988,991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[988,991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\nexport interface AppSettings {\r\n    enable_phone_login: boolean;\r\n    [key: string]: any;\r\n}\r\n\r\nconst defaultSettings: AppSettings = {\r\n    enable_phone_login: true,\r\n};\r\n\r\nexport const useAppSettings = () => {\r\n    const [settings, setSettings] = useState<AppSettings>(defaultSettings);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        // Initial fetch\r\n        const fetchSettings = async () => {\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('app_settings')\r\n                    .select('*');\r\n\r\n                if (error) {\r\n                    console.error('Error fetching app settings:', error);\r\n                    return;\r\n                }\r\n\r\n                if (data) {\r\n                    const newSettings = { ...defaultSettings };\r\n                    data.forEach((item: any) => {\r\n                        newSettings[item.key] = item.value;\r\n                    });\r\n                    setSettings(newSettings);\r\n                }\r\n            } catch (err) {\r\n                console.error('Failed to fetch app settings:', err);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchSettings();\r\n\r\n        // Real-time subscription\r\n        const channel = supabase\r\n            .channel('app_settings_changes')\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'app_settings'\r\n                },\r\n                async (payload) => {\r\n                    console.log('App setting changed:', payload);\r\n                    // Refresh all settings on any change for simplicity, or update specific key\r\n                    fetchSettings();\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, []);\r\n\r\n    const isPhoneLoginEnabled = () => {\r\n        return settings.enable_phone_login === true; // Strict check or just truthy\r\n    };\r\n\r\n    return {\r\n        settings,\r\n        loading,\r\n        isPhoneLoginEnabled\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\hooks\\useAuth.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":99,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":99,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\hooks\\useGeolocation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\hooks\\useHaptics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\hooks\\useOrderNotifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\integrations\\firebase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\integrations\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\integrations\\supabase\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Auth.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Cart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Contact.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Offers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\OrderTracking.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Orders.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Privacy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Profile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Promotions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Refer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Refund.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\RestaurantDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Support.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTickets'. Either include it or remove the dependency array.","line":56,"column":8,"nodeType":"ArrayExpression","endLine":56,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTickets, session]","fix":{"range":[1655,1664],"text":"[fetchTickets, session]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2271,2274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2271,2274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"@/hooks/useAuth\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Plus, MessageSquare } from \"lucide-react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface Ticket {\r\n    id: string;\r\n    subject: string;\r\n    status: \"open\" | \"in_progress\" | \"resolved\" | \"closed\";\r\n    priority: \"low\" | \"medium\" | \"high\" | \"urgent\";\r\n    created_at: string;\r\n    assignee?: {\r\n        full_name: string;\r\n    };\r\n}\r\n\r\nconst Support = () => {\r\n    const { session } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [tickets, setTickets] = useState<Ticket[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [newTicket, setNewTicket] = useState<{\r\n        subject: string;\r\n        priority: \"low\" | \"medium\" | \"high\" | \"urgent\";\r\n        message: string;\r\n    }>({\r\n        subject: \"\",\r\n        priority: \"low\",\r\n        message: \"\",\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchTickets();\r\n    }, [session]);\r\n\r\n    const fetchTickets = async () => {\r\n        if (!session?.user?.id) return;\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from(\"support_tickets\")\r\n                .select(`\r\n                    *,\r\n                    assignee:profiles!support_tickets_assigned_to_fkey(full_name)\r\n                `)\r\n                .order(\"created_at\", { ascending: false });\r\n\r\n            if (error) throw error;\r\n\r\n            // Transform data to match Ticket interface (handle array response from joins)\r\n            const formattedTickets = (data || []).map((ticket: any) => ({\r\n                ...ticket,\r\n                assignee: Array.isArray(ticket.assignee) ? ticket.assignee[0] : ticket.assignee\r\n            }));\r\n\r\n            setTickets(formattedTickets);\r\n        } catch (error) {\r\n            console.error(\"Error fetching tickets:\", error);\r\n            toast.error(`Failed to load tickets: ${error.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const createTicket = async () => {\r\n        if (!session?.user?.id) return;\r\n        if (!newTicket.subject.trim() || !newTicket.message.trim()) {\r\n            toast.error(\"Please fill in all fields\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // 1. Create Ticket\r\n            const { data: ticket, error: ticketError } = await supabase\r\n                .from(\"support_tickets\")\r\n                .insert({\r\n                    user_id: session.user.id,\r\n                    subject: newTicket.subject,\r\n                    priority: newTicket.priority,\r\n                    status: \"open\",\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (ticketError) throw ticketError;\r\n\r\n            // 2. Create Initial Message\r\n            const { error: messageError } = await supabase\r\n                .from(\"support_messages\")\r\n                .insert({\r\n                    ticket_id: ticket.id,\r\n                    sender_id: session.user.id,\r\n                    message: newTicket.message,\r\n                });\r\n\r\n            if (messageError) throw messageError;\r\n\r\n            toast.success(\"Ticket created successfully\");\r\n            setIsOpen(false);\r\n            setNewTicket({ subject: \"\", priority: \"low\", message: \"\" });\r\n            fetchTickets();\r\n        } catch (error) {\r\n            console.error(\"Error creating ticket:\", error);\r\n            toast.error(\"Failed to create ticket\");\r\n        }\r\n    };\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case \"open\":\r\n                return \"bg-green-100 text-green-800\";\r\n            case \"in_progress\":\r\n                return \"bg-blue-100 text-blue-800\";\r\n            case \"resolved\":\r\n                return \"bg-purple-100 text-purple-800\";\r\n            case \"closed\":\r\n                return \"bg-gray-100 text-gray-800\";\r\n            default:\r\n                return \"bg-gray-100 text-gray-800\";\r\n        }\r\n    };\r\n\r\n    if (!session) return null;\r\n\r\n    return (\r\n        <div className=\"container mx-auto p-4 max-w-4xl space-y-6 pb-20\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h1 className=\"text-2xl font-bold\">Customer Support</h1>\r\n                <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n                    <DialogTrigger asChild>\r\n                        <Button>\r\n                            <Plus className=\"mr-2 h-4 w-4\" /> New Ticket\r\n                        </Button>\r\n                    </DialogTrigger>\r\n                    <DialogContent>\r\n                        <DialogHeader>\r\n                            <DialogTitle>Create New Support Ticket</DialogTitle>\r\n                        </DialogHeader>\r\n                        <div className=\"space-y-4 mt-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"subject\">Subject</Label>\r\n                                <Input\r\n                                    id=\"subject\"\r\n                                    value={newTicket.subject}\r\n                                    onChange={(e) =>\r\n                                        setNewTicket({ ...newTicket, subject: e.target.value })\r\n                                    }\r\n                                    placeholder=\"What do you need help with?\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"priority\">Priority</Label>\r\n                                <Select\r\n                                    value={newTicket.priority}\r\n                                    onValueChange={(val: \"low\" | \"medium\" | \"high\" | \"urgent\") =>\r\n                                        setNewTicket({ ...newTicket, priority: val })\r\n                                    }\r\n                                >\r\n                                    <SelectTrigger>\r\n                                        <SelectValue placeholder=\"Select priority\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        <SelectItem value=\"low\">Low</SelectItem>\r\n                                        <SelectItem value=\"medium\">Medium</SelectItem>\r\n                                        <SelectItem value=\"high\">High</SelectItem>\r\n                                        <SelectItem value=\"urgent\">Urgent</SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"message\">Message</Label>\r\n                                <Textarea\r\n                                    id=\"message\"\r\n                                    value={newTicket.message}\r\n                                    onChange={(e) =>\r\n                                        setNewTicket({ ...newTicket, message: e.target.value })\r\n                                    }\r\n                                    placeholder=\"Describe your issue...\"\r\n                                    rows={4}\r\n                                />\r\n                            </div>\r\n                            <Button onClick={createTicket} className=\"w-full\">\r\n                                Submit Ticket\r\n                            </Button>\r\n                        </div>\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n\r\n            <div className=\"grid gap-4\">\r\n                {loading ? (\r\n                    <div>Loading tickets...</div>\r\n                ) : tickets.length === 0 ? (\r\n                    <div className=\"text-center py-10 text-gray-500\">\r\n                        No support tickets found. Create one to get started.\r\n                    </div>\r\n                ) : (\r\n                    tickets.map((ticket) => (\r\n                        <Card\r\n                            key={ticket.id}\r\n                            className=\"cursor-pointer hover:shadow-md transition-shadow\"\r\n                            onClick={() => navigate(`/support/${ticket.id}`)}\r\n                        >\r\n                            <CardContent className=\"p-4\">\r\n                                <div className=\"flex justify-between items-start\">\r\n                                    <div>\r\n                                        <h3 className=\"font-semibold text-lg\">{ticket.subject}</h3>\r\n                                        <div className=\"text-sm text-gray-500 mt-1\">\r\n                                            Created on {new Date(ticket.created_at).toLocaleDateString()}\r\n                                        </div>\r\n                                        {ticket.assignee && (\r\n                                            <div className=\"text-xs text-blue-600 mt-2 font-medium\">\r\n                                                Assigned to: {ticket.assignee.full_name || 'Support Agent'}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex flex-col items-end gap-2\">\r\n                                        <span\r\n                                            className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(\r\n                                                ticket.status\r\n                                            )}`}\r\n                                        >\r\n                                            {ticket.status.replace(\"_\", \" \").toUpperCase()}\r\n                                        </span>\r\n                                        <span className=\"text-xs text-gray-400 capitalize\">\r\n                                            {ticket.priority} Priority\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </CardContent>\r\n                        </Card>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Support;\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\SupportChat.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchMessages', 'fetchTicketDetails', and 'subscribeToMessages'. Either include them or remove the dependency array.","line":46,"column":8,"nodeType":"ArrayExpression","endLine":46,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMessages, fetchTicketDetails, id, session, subscribeToMessages]","fix":{"range":[1512,1525],"text":"[fetchMessages, fetchTicketDetails, id, session, subscribeToMessages]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3975,3978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3975,3978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useRef } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"@/hooks/useAuth\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { ArrowLeft, Send } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\n\r\ninterface Message {\r\n    id: string;\r\n    sender_id: string;\r\n    message: string;\r\n    created_at: string;\r\n    sender_profile?: {\r\n        full_name: string;\r\n        avatar_url: string | null;\r\n    };\r\n}\r\n\r\ninterface Ticket {\r\n    id: string;\r\n    subject: string;\r\n    status: string;\r\n}\r\n\r\nconst SupportChat = () => {\r\n    const { id } = useParams<{ id: string }>();\r\n    const { session } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [newMessage, setNewMessage] = useState(\"\");\r\n    const [ticket, setTicket] = useState<Ticket | null>(null);\r\n    const scrollRef = useRef<HTMLDivElement>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (id && session?.user?.id) {\r\n            fetchTicketDetails();\r\n            fetchMessages();\r\n            subscribeToMessages();\r\n        }\r\n    }, [id, session]);\r\n\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [messages]);\r\n\r\n    const scrollToBottom = () => {\r\n        if (scrollRef.current) {\r\n            scrollRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n        }\r\n    };\r\n\r\n    const fetchTicketDetails = async () => {\r\n        const { data } = await supabase\r\n            .from(\"support_tickets\")\r\n            .select(\"*\")\r\n            .eq(\"id\", id)\r\n            .single();\r\n        setTicket(data);\r\n    };\r\n\r\n    const fetchMessages = async () => {\r\n        try {\r\n            // First fetch messages\r\n            const { data: messagesData, error } = await supabase\r\n                .from(\"support_messages\")\r\n                .select(\"*\")\r\n                .eq(\"ticket_id\", id)\r\n                .order(\"created_at\", { ascending: true });\r\n\r\n            if (error) throw error;\r\n\r\n            // Then fetch profiles for senders\r\n            const senderIds = [...new Set(messagesData.map(m => m.sender_id))];\r\n            const { data: profilesData } = await supabase\r\n                .from(\"profiles\")\r\n                .select(\"id, full_name, avatar_url\")\r\n                .in(\"id\", senderIds);\r\n\r\n            // Map profiles to messages\r\n            const populatedMessages = messagesData.map(msg => ({\r\n                ...msg,\r\n                sender_profile: profilesData?.find(p => p.id === msg.sender_id)\r\n            }));\r\n\r\n            setMessages(populatedMessages);\r\n        } catch (error) {\r\n            console.error(\"Error fetching messages:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const subscribeToMessages = () => {\r\n        const channel = supabase\r\n            .channel(`support_messages:${id}`)\r\n            .on(\r\n                \"postgres_changes\",\r\n                {\r\n                    event: \"INSERT\",\r\n                    schema: \"public\",\r\n                    table: \"support_messages\",\r\n                    filter: `ticket_id=eq.${id}`,\r\n                },\r\n                async (payload) => {\r\n                    // Fetch sender profile for the new message\r\n                    const { data: profile } = await supabase\r\n                        .from(\"profiles\")\r\n                        .select(\"id, full_name, avatar_url\")\r\n                        .eq(\"id\", payload.new.sender_id)\r\n                        .single();\r\n\r\n                    const newMsg = {\r\n                        ...(payload.new as any),\r\n                        sender_profile: profile\r\n                    } as Message;\r\n\r\n                    setMessages((prev) => [...prev, newMsg]);\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    };\r\n\r\n    const sendMessage = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newMessage.trim() || !session?.user?.id) return;\r\n\r\n        try {\r\n            const { error } = await supabase.from(\"support_messages\").insert({\r\n                ticket_id: id,\r\n                sender_id: session.user.id,\r\n                message: newMessage,\r\n            });\r\n\r\n            if (error) throw error;\r\n            setNewMessage(\"\");\r\n        } catch (error) {\r\n            console.error(\"Error sending message:\", error);\r\n            toast.error(\"Failed to send message\");\r\n        }\r\n    };\r\n\r\n    if (!session) return null;\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-[calc(100vh-4rem)] max-w-4xl mx-auto bg-gray-50\">\r\n            {/* Header */}\r\n            <div className=\"bg-white border-b p-4 flex items-center gap-4 sticky top-0 z-10\">\r\n                <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate(-1)}>\r\n                    <ArrowLeft className=\"h-5 w-5\" />\r\n                </Button>\r\n                <div>\r\n                    <h2 className=\"font-semibold\">{ticket?.subject || \"Loading...\"}</h2>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                        Ticket ID: {id?.slice(0, 8)}... | Status:{\" \"}\r\n                        <span className=\"capitalize\">{ticket?.status?.replace(\"_\", \" \")}</span>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Messages Area */}\r\n            <ScrollArea className=\"flex-1 p-4\">\r\n                <div className=\"space-y-4 pb-4\">\r\n                    {loading ? (\r\n                        <div className=\"text-center text-gray-400 mt-10\">Loading conversation...</div>\r\n                    ) : messages.length === 0 ? (\r\n                        <div className=\"text-center text-gray-400 mt-10\">No messages yet.</div>\r\n                    ) : (\r\n                        messages.map((msg) => {\r\n                            const isMe = msg.sender_id === session.user.id;\r\n                            return (\r\n                                <div\r\n                                    key={msg.id}\r\n                                    className={`flex gap-3 ${isMe ? \"flex-row-reverse\" : \"flex-row\"}`}\r\n                                >\r\n                                    <Avatar className=\"h-8 w-8\">\r\n                                        <AvatarImage src={msg.sender_profile?.avatar_url || \"\"} />\r\n                                        <AvatarFallback>{msg.sender_profile?.full_name?.charAt(0) || \"U\"}</AvatarFallback>\r\n                                    </Avatar>\r\n                                    <div\r\n                                        className={`max-w-[80%] rounded-lg p-3 ${isMe\r\n                                            ? \"bg-primary text-primary-foreground\"\r\n                                            : \"bg-white border text-gray-800\"\r\n                                            }`}\r\n                                    >\r\n                                        {!isMe && <div className=\"text-xs font-semibold mb-1 opacity-70\">{msg.sender_profile?.full_name}</div>}\r\n                                        <p className=\"text-sm whitespace-pre-wrap\">{msg.message}</p>\r\n                                        <div\r\n                                            className={`text-[10px] mt-1 text-right ${isMe ? \"text-primary-foreground/70\" : \"text-gray-400\"\r\n                                                }`}\r\n                                        >\r\n                                            {new Date(msg.created_at).toLocaleTimeString([], {\r\n                                                hour: \"2-digit\",\r\n                                                minute: \"2-digit\",\r\n                                            })}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })\r\n                    )}\r\n                    <div ref={scrollRef} />\r\n                </div>\r\n            </ScrollArea>\r\n\r\n            {/* Input Area */}\r\n            {ticket?.status !== \"closed\" && (\r\n                <div className=\"p-4 bg-white border-t mt-auto\">\r\n                    <form onSubmit={sendMessage} className=\"flex gap-2\">\r\n                        <Input\r\n                            value={newMessage}\r\n                            onChange={(e) => setNewMessage(e.target.value)}\r\n                            placeholder=\"Type your message...\"\r\n                            className=\"flex-1\"\r\n                        />\r\n                        <Button type=\"submit\" disabled={!newMessage.trim()}>\r\n                            <Send className=\"h-4 w-4\" />\r\n                        </Button>\r\n                    </form>\r\n                </div>\r\n            )}\r\n            {ticket?.status === \"closed\" && (\r\n                <div className=\"p-4 bg-gray-100 border-t text-center text-gray-500 text-sm\">\r\n                    This ticket is closed. You cannot send further messages.\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SupportChat;\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\Terms.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\admin\\AdminDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":430,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":430,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14457,14460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14457,14460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useAuth } from '@/hooks/useAuth';\r\nimport { Restaurant, Order, OrderStatus, DeliveryPartner, AppRole } from '@/types/database';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { StatusBadge } from '@/components/StatusBadge';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from '@/components/ui/alert-dialog';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport {\r\n  Shield,\r\n  Store,\r\n  Package,\r\n  DollarSign,\r\n  ArrowLeft,\r\n  Check,\r\n  X,\r\n  Percent,\r\n  Bike,\r\n  MapPin,\r\n  TrendingUp,\r\n  Clock,\r\n  Users,\r\n  UserPlus,\r\n  Sparkles,\r\n  Tag,\r\n  RefreshCw,\r\n  Search,\r\n  Phone,\r\n  IndianRupee,\r\n  Filter,\r\n  Settings,\r\n  ShoppingBag,\r\n  Wallet,\r\n  FileText,\r\n  MessageSquare,\r\n  Star\r\n} from 'lucide-react';\r\nimport { PromotionsManager } from '@/components/admin/PromotionsManager';\r\nimport { CouponsManager } from '@/components/admin/CouponsManager';\r\nimport { SettlementsManager } from '@/components/admin/SettlementsManager';\r\nimport { ShopSettlementsManager } from '@/components/admin/ShopSettlementsManager';\r\nimport { DeliveryPincodesManager } from '@/components/admin/DeliveryPincodesManager';\r\nimport { ScheduleSettings } from '@/components/admin/ScheduleSettings';\r\nimport { AdminOrderCard } from '@/components/admin/AdminOrderCard';\r\nimport { FinancialAnalytics } from '@/components/admin/FinancialAnalytics';\r\nimport { ReportsAnalytics } from '@/components/admin/ReportsAnalytics';\r\nimport { AdminSupport } from '@/components/admin/AdminSupport';\r\nimport {\r\n  Bell,\r\n  toast\r\n} from 'sonner';\r\nimport { format } from 'date-fns';\r\n\r\ninterface RestaurantWithStats extends Restaurant {\r\n  orders_count?: number;\r\n}\r\n\r\ninterface OrderWithDetails extends Order {\r\n  restaurants: { name: string; address: string; phone: string | null } | null;\r\n  customer_profile?: { full_name: string | null; phone: string | null } | null;\r\n  order_items: {\r\n    quantity: number;\r\n    menu_item_id: string;\r\n    menu_items: { name: string; price: number } | null;\r\n  }[];\r\n}\r\n\r\ninterface DeliveryPartnerWithProfile extends DeliveryPartner {\r\n  user_id: string;\r\n  verification_otp?: string | null;\r\n  phone_verified?: boolean;\r\n  profiles?: {\r\n    full_name: string | null;\r\n    email: string;\r\n    phone: string | null;\r\n  };\r\n  stats?: {\r\n    total_deliveries: number;\r\n    success_rate: number;\r\n    cancelled: number;\r\n    avg_rating: number | null;\r\n  };\r\n}\r\n\r\ninterface UserWithRoles {\r\n  id: string;\r\n  email: string;\r\n  full_name: string | null;\r\n  roles: AppRole[];\r\n}\r\n\r\nexport default function AdminDashboard() {\r\n  const { user, hasRole, loading: authLoading } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [restaurants, setRestaurants] = useState<RestaurantWithStats[]>([]);\r\n  const [orders, setOrders] = useState<OrderWithDetails[]>([]);\r\n  const [deliveryPartners, setDeliveryPartners] = useState<DeliveryPartnerWithProfile[]>([]);\r\n  const [users, setUsers] = useState<UserWithRoles[]>([]);\r\n  const [stats, setStats] = useState({\r\n    totalRestaurants: 0,\r\n    verifiedRestaurants: 0,\r\n    totalOrders: 0,\r\n    totalRevenue: 0,\r\n    activeOrders: 0,\r\n    totalPartners: 0,\r\n    totalUsers: 0,\r\n    deliveryFeeEarnings: 0,\r\n    platformFeeEarnings: 0,\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [commissionUpdates, setCommissionUpdates] = useState<Record<string, string>>({});\r\n  const [selectedRole, setSelectedRole] = useState<Record<string, AppRole>>({});\r\n  const [searchShops, setSearchShops] = useState('');\r\n  const [searchOrders, setSearchOrders] = useState('');\r\n  const [searchUsers, setSearchUsers] = useState('');\r\n  const [orderStatusFilter, setOrderStatusFilter] = useState<string>('all');\r\n  const [enablePhoneLogin, setEnablePhoneLogin] = useState(true);\r\n  const [deliveryFee, setDeliveryFee] = useState('30');\r\n  const [settlementPercent, setSettlementPercent] = useState('20');\r\n\r\n  const fetchData = useCallback(async () => {\r\n    const [restaurantsRes, ordersRes, partnersRes, profilesRes, settingsRes] = await Promise.all([\r\n      supabase.from('restaurants').select('*').order('created_at', { ascending: false }),\r\n      supabase\r\n        .from('orders')\r\n        .select('*, restaurants(name, address, phone), order_items(quantity, menu_item_id, menu_items(name, price))')\r\n        .order('created_at', { ascending: false })\r\n        .limit(100),\r\n      supabase.from('delivery_partners').select('*'),\r\n      supabase.from('profiles').select('id, email, full_name, phone').order('created_at', { ascending: false }).limit(200),\r\n      supabase.from('app_settings').select('*'),\r\n    ]);\r\n\r\n    if (restaurantsRes.data) {\r\n      setRestaurants(restaurantsRes.data);\r\n      setStats((prev) => ({\r\n        ...prev,\r\n        totalRestaurants: restaurantsRes.data.length,\r\n        verifiedRestaurants: restaurantsRes.data.filter((r) => r.is_verified).length,\r\n      }));\r\n    }\r\n\r\n    if (partnersRes.data) {\r\n      // Fetch profiles\r\n      const partnerUserIds = partnersRes.data.map(p => p.user_id);\r\n      const { data: partnerProfiles } = await supabase\r\n        .from('profiles')\r\n        .select('id, full_name, email, phone')\r\n        .in('id', partnerUserIds);\r\n\r\n      // Fetch stats (all orders/ratings)\r\n      const { data: allOrderStats } = await supabase\r\n        .from('orders')\r\n        .select('id, status, delivery_partner_id');\r\n      const { data: allRatings } = await supabase\r\n        .from('order_ratings')\r\n        .select('rating, delivery_partner_id');\r\n\r\n      const partnersWithData = partnersRes.data.map(partner => {\r\n        // Profile\r\n        const profile = partnerProfiles?.find(p => p.id === partner.user_id) || undefined;\r\n\r\n        // Stats\r\n        const pOrders = allOrderStats?.filter(o => o.delivery_partner_id === partner.id) || [];\r\n        const pDelivered = pOrders.filter(o => o.status === 'delivered');\r\n        const pCancelled = pOrders.filter(o => o.status === 'cancelled');\r\n        const pRatings = allRatings?.filter(r => r.delivery_partner_id === partner.id) || [];\r\n        const avgRating = pRatings.length > 0\r\n          ? pRatings.reduce((sum, r) => sum + r.rating, 0) / pRatings.length\r\n          : null;\r\n\r\n        return {\r\n          ...partner,\r\n          profiles: profile,\r\n          stats: {\r\n            total_deliveries: pDelivered.length,\r\n            success_rate: pOrders.length > 0 ? Math.round((pDelivered.length / pOrders.length) * 100) : 0,\r\n            cancelled: pCancelled.length,\r\n            avg_rating: avgRating\r\n          }\r\n        };\r\n      });\r\n\r\n      setDeliveryPartners(partnersWithData);\r\n      setStats((prev) => ({\r\n        ...prev,\r\n        totalPartners: partnersRes.data.length,\r\n      }));\r\n    }\r\n\r\n    if (ordersRes.data) {\r\n      // Manually join customer profiles to orders since DB join is not available via FK\r\n      const enrichedOrders = ordersRes.data.map(order => {\r\n        const customerProfile = profilesRes.data?.find(p => p.id === order.customer_id);\r\n        return {\r\n          ...order,\r\n          customer_profile: customerProfile ? { full_name: customerProfile.full_name, phone: customerProfile.phone } : null\r\n        };\r\n      });\r\n      setOrders(enrichedOrders);\r\n      const activeOrders = ordersRes.data.filter(o =>\r\n        !['delivered', 'cancelled'].includes(o.status)\r\n      ).length;\r\n      const totalRevenue = ordersRes.data\r\n        .filter(o => o.status === 'delivered')\r\n        .reduce((sum, order) => sum + Number(order.total_amount), 0);\r\n\r\n      // Calculate delivery fee and platform fee earnings (from delivered orders only)\r\n      const deliveredOrders = ordersRes.data.filter(o => o.status === 'delivered');\r\n      const deliveryFeeEarnings = deliveredOrders.reduce(\r\n        (sum, order) => sum + Number(order.delivery_fee || 25),\r\n        0\r\n      );\r\n      const platformFee = 8; // Fixed platform fee per order\r\n      const platformFeeEarnings = deliveredOrders.length * platformFee;\r\n\r\n      setStats((prev) => ({\r\n        ...prev,\r\n        totalOrders: ordersRes.data.length,\r\n        totalRevenue,\r\n        activeOrders,\r\n        deliveryFeeEarnings,\r\n        platformFeeEarnings,\r\n      }));\r\n    }\r\n\r\n    // Fetch users with their roles\r\n    if (profilesRes.data) {\r\n      const userIds = profilesRes.data.map(p => p.id);\r\n      const { data: rolesData } = await supabase\r\n        .from('user_roles')\r\n        .select('user_id, role')\r\n        .in('user_id', userIds);\r\n\r\n      const usersWithRoles: UserWithRoles[] = profilesRes.data.map(profile => ({\r\n        ...profile,\r\n        roles: rolesData?.filter(r => r.user_id === profile.id).map(r => r.role as AppRole) || []\r\n      }));\r\n\r\n      setUsers(usersWithRoles);\r\n      setStats((prev) => ({\r\n        ...prev,\r\n        totalUsers: profilesRes.data.length,\r\n      }));\r\n    }\r\n\r\n    if (settingsRes.data) {\r\n      settingsRes.data.forEach(setting => {\r\n        if (setting.key === 'enable_phone_login') {\r\n          setEnablePhoneLogin(setting.value as boolean);\r\n        } else if (setting.key === 'delivery_fee_per_order') {\r\n          setDeliveryFee(String(setting.value));\r\n        } else if (setting.key === 'pending_settlement_percentage') {\r\n          setSettlementPercent(String(setting.value));\r\n        }\r\n      });\r\n    }\r\n\r\n    setLoading(false);\r\n    setRefreshing(false);\r\n  }, []);\r\n\r\n  const subscribeToChanges = useCallback(() => {\r\n    const channel = supabase\r\n      .channel('admin-changes')\r\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'orders' }, fetchData)\r\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'restaurants' }, fetchData)\r\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'delivery_partners' }, fetchData)\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [fetchData]);\r\n\r\n  useEffect(() => {\r\n    if (!authLoading) {\r\n      if (!user || !hasRole('super_admin')) {\r\n        toast.error('Access denied');\r\n        navigate('/');\r\n        return;\r\n      }\r\n      fetchData();\r\n      subscribeToChanges();\r\n    }\r\n  }, [user, authLoading, hasRole, fetchData, subscribeToChanges, navigate]);\r\n\r\n  const handleRefresh = () => {\r\n    setRefreshing(true);\r\n    fetchData();\r\n  };\r\n\r\n  // Filtered data\r\n  const filteredRestaurants = restaurants.filter(r =>\r\n    r.name.toLowerCase().includes(searchShops.toLowerCase()) ||\r\n    (r.cuisine_type?.toLowerCase().includes(searchShops.toLowerCase()))\r\n  );\r\n\r\n  const filteredOrders = orders.filter(o => {\r\n    const matchesSearch = o.id.toLowerCase().includes(searchOrders.toLowerCase()) ||\r\n      (o.restaurants?.name?.toLowerCase().includes(searchOrders.toLowerCase()));\r\n    const matchesStatus = orderStatusFilter === 'all' || o.status === orderStatusFilter;\r\n    return matchesSearch && matchesStatus;\r\n  });\r\n\r\n  const filteredUsers = users.filter(u =>\r\n    (u.full_name?.toLowerCase().includes(searchUsers.toLowerCase())) ||\r\n    u.email.toLowerCase().includes(searchUsers.toLowerCase())\r\n  );\r\n\r\n\r\n\r\n  const toggleVerification = async (restaurantId: string, isVerified: boolean) => {\r\n    const { error } = await supabase\r\n      .from('restaurants')\r\n      .update({ is_verified: isVerified })\r\n      .eq('id', restaurantId);\r\n\r\n    if (error) {\r\n      toast.error('Failed to update verification status');\r\n    } else {\r\n      toast.success(isVerified ? 'Shop verified' : 'Verification removed');\r\n      fetchData();\r\n    }\r\n  };\r\n\r\n  const updateCommission = async (restaurantId: string) => {\r\n    const rate = parseFloat(commissionUpdates[restaurantId]);\r\n    if (isNaN(rate) || rate < 0 || rate > 100) {\r\n      toast.error('Invalid commission rate');\r\n      return;\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from('restaurants')\r\n      .update({ commission_rate: rate })\r\n      .eq('id', restaurantId);\r\n\r\n    if (error) {\r\n      toast.error('Failed to update commission rate');\r\n    } else {\r\n      toast.success('Commission rate updated');\r\n      setCommissionUpdates((prev) => ({ ...prev, [restaurantId]: '' }));\r\n      fetchData();\r\n    }\r\n  };\r\n\r\n  const cancelOrder = async (orderId: string) => {\r\n    const { error } = await supabase\r\n      .from('orders')\r\n      .update({ status: 'cancelled' })\r\n      .eq('id', orderId);\r\n\r\n    if (error) {\r\n      toast.error('Failed to cancel order');\r\n    } else {\r\n      toast.success('Order cancelled');\r\n      fetchData();\r\n    }\r\n  };\r\n\r\n  const addRoleToUser = async (userId: string) => {\r\n    const role = selectedRole[userId];\r\n    if (!role) {\r\n      toast.error('Please select a role');\r\n      return;\r\n    }\r\n\r\n    // Check if user already has this role\r\n    const userRoles = users.find(u => u.id === userId)?.roles || [];\r\n    if (userRoles.includes(role)) {\r\n      toast.error('User already has this role');\r\n      return;\r\n    }\r\n\r\n    // Use secure admin RPC function\r\n    const { data, error } = await supabase.rpc('admin_assign_role', {\r\n      _target_user_id: userId,\r\n      _role: role\r\n    });\r\n\r\n    if (error || !data) {\r\n      toast.error('Failed to add role');\r\n    } else {\r\n      toast.success(`Role ${role} added successfully`);\r\n      setSelectedRole(prev => ({ ...prev, [userId]: '' as AppRole }));\r\n      fetchData();\r\n    }\r\n  };\r\n\r\n  const removeRoleFromUser = async (userId: string, role: AppRole) => {\r\n    // Use secure admin RPC function\r\n    const { data, error } = await supabase.rpc('admin_remove_role', {\r\n      _target_user_id: userId,\r\n      _role: role\r\n    });\r\n\r\n    if (error || !data) {\r\n      toast.error('Failed to remove role');\r\n    } else {\r\n      toast.success(`Role ${role} removed`);\r\n      fetchData();\r\n    }\r\n  };\r\n\r\n  const updateSetting = async (key: string, value: any) => {\r\n    const { error } = await supabase\r\n      .from('app_settings')\r\n      .upsert({ key, value });\r\n\r\n    if (error) {\r\n      toast.error('Failed to update settings');\r\n    } else {\r\n      if (key === 'enable_phone_login') setEnablePhoneLogin(value);\r\n      toast.success('Settings updated');\r\n      fetchData(); // Refresh to ensure sync\r\n    }\r\n  };\r\n\r\n  if (authLoading || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"animate-pulse text-muted-foreground\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-secondary/20 to-background\">\r\n      {/* Header */}\r\n      <header className=\"sticky top-0 z-50 bg-card/95 backdrop-blur-md border-b border-border shadow-sm\">\r\n        <div className=\"container mx-auto px-4 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <Link to=\"/\" className=\"flex items-center gap-2 text-foreground hover:text-primary transition-colors\">\r\n                <ArrowLeft className=\"w-5 h-5\" />\r\n              </Link>\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-primary/80 hidden md:flex items-center justify-center shadow-lg\">\r\n                  <Shield className=\"w-5 h-5 text-primary-foreground\" />\r\n                </div>\r\n                <div>\r\n                  <h1 className=\"text-xl font-bold bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text\">\r\n                    Admin Dashboard\r\n                  </h1>\r\n                  <p className=\"text-xs text-muted-foreground\">Manage your platform</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Link to=\"/admin/support\">\r\n                <Button variant=\"outline\" size=\"sm\" className=\"hidden md:flex gap-2\">\r\n                  <MessageSquare className=\"w-4 h-4\" />\r\n                  Support\r\n                </Button>\r\n              </Link>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={handleRefresh}\r\n                disabled={refreshing}\r\n                className=\"h-9 w-9\"\r\n              >\r\n                <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"container mx-auto px-4 py-6 space-y-6\">\r\n        {/* Stats Grid */}\r\n        <div className=\"grid grid-cols-2 lg:grid-cols-7 gap-3\">\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-primary/5 to-primary/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-primary/20 flex items-center justify-center\">\r\n                  <Store className=\"w-5 h-5 text-primary\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Shops</p>\r\n                  <p className=\"text-2xl font-bold text-primary\">{stats.totalRestaurants}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-accent/5 to-accent/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-accent/20 flex items-center justify-center\">\r\n                  <Check className=\"w-5 h-5 text-accent\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Verified</p>\r\n                  <p className=\"text-2xl font-bold text-accent\">{stats.verifiedRestaurants}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-status-confirmed/5 to-status-confirmed/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-status-confirmed/20 flex items-center justify-center\">\r\n                  <Package className=\"w-5 h-5 text-status-confirmed\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Orders</p>\r\n                  <p className=\"text-2xl font-bold\">{stats.totalOrders}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-status-pending/5 to-status-pending/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-status-pending/20 flex items-center justify-center\">\r\n                  <Clock className=\"w-5 h-5 text-status-pending\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Active</p>\r\n                  <p className=\"text-2xl font-bold text-status-pending\">{stats.activeOrders}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-status-delivered/5 to-status-delivered/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-status-delivered/20 flex items-center justify-center\">\r\n                  <TrendingUp className=\"w-5 h-5 text-status-delivered\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Revenue</p>\r\n                  <p className=\"text-2xl font-bold text-status-delivered\">{stats.totalRevenue.toFixed(0)}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-primary/10 to-accent/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-primary/20 flex items-center justify-center\">\r\n                  <Bike className=\"w-5 h-5 text-primary\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Delivery Fee</p>\r\n                  <p className=\"text-2xl font-bold text-primary\">{stats.deliveryFeeEarnings.toFixed(0)}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-accent/10 to-status-confirmed/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-accent/20 flex items-center justify-center\">\r\n                  <IndianRupee className=\"w-5 h-5 text-accent\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Platform Fee</p>\r\n                  <p className=\"text-2xl font-bold text-accent\">{stats.platformFeeEarnings.toFixed(0)}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"border-0 shadow-md bg-gradient-to-br from-status-preparing/5 to-status-preparing/10\">\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-10 h-10 rounded-xl bg-status-preparing/20 flex items-center justify-center\">\r\n                  <Users className=\"w-5 h-5 text-status-preparing\" />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs text-muted-foreground font-medium\">Partners</p>\r\n                  <p className=\"text-2xl font-bold text-status-preparing\">{stats.totalPartners}</p>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <Tabs defaultValue=\"shops\" className=\"space-y-6\">\r\n          <TabsList className=\"flex flex-wrap h-auto gap-2 p-2 bg-muted/50\">\r\n            <TabsTrigger value=\"shops\" className=\"gap-1 text-xs\">\r\n              <Store className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Shops</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"orders\" className=\"gap-1 text-xs\">\r\n              <Package className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Orders</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"partners\" className=\"gap-1 text-xs\">\r\n              <Bike className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Partners</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"users\" className=\"gap-1 text-xs\">\r\n              <Users className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Users</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"promotions\" className=\"gap-1 text-xs\">\r\n              <Sparkles className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Promos</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"coupons\" className=\"gap-1 text-xs\">\r\n              <Tag className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Coupons</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"settlements\" className=\"gap-2 text-xs\">\r\n              <IndianRupee className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Settlements</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"reports\" className=\"gap-2 text-xs\">\r\n              <FileText className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Reports</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"financials\" className=\"gap-2 text-xs\">\r\n              <TrendingUp className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Financials</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"delivery-areas\" className=\"gap-1 text-xs\">\r\n              <MapPin className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Areas</span>\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"settings\" className=\"gap-2 text-xs\">\r\n              <Settings className=\"w-4 h-4\" />\r\n              <span className=\"hidden sm:inline\">Settings</span>\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"shops\">\r\n            <Card className=\"border-0 shadow-lg\">\r\n              <CardHeader className=\"pb-3\">\r\n                <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3\">\r\n                  <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                    <Store className=\"w-5 h-5 text-primary\" />\r\n                    Shop Management ({filteredRestaurants.length})\r\n                  </CardTitle>\r\n                  <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                    <Input\r\n                      placeholder=\"Search shops...\"\r\n                      value={searchShops}\r\n                      onChange={(e) => setSearchShops(e.target.value)}\r\n                      className=\"pl-9 h-9 w-full sm:w-64\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"p-0\">\r\n                <ScrollArea className=\"h-[500px]\">\r\n                  <div className=\"p-4 space-y-3\">\r\n                    {filteredRestaurants.map((restaurant) => (\r\n                      <div\r\n                        key={restaurant.id}\r\n                        className=\"p-3 rounded-xl border border-border bg-card hover:bg-secondary/30 transition-all\"\r\n                      >\r\n                        <div className=\"flex items-start justify-between gap-3\">\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <h4 className=\"font-semibold truncate\">{restaurant.name}</h4>\r\n                              <span className={`text-xs px-2 py-0.5 rounded-full ${restaurant.is_open\r\n                                ? 'bg-accent/20 text-accent'\r\n                                : 'bg-muted text-muted-foreground'\r\n                                }`}>\r\n                                {restaurant.is_open ? 'Open' : 'Closed'}\r\n                              </span>\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground mt-0.5\">{restaurant.cuisine_type}</p>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Switch\r\n                              checked={restaurant.is_verified}\r\n                              onCheckedChange={(checked) => toggleVerification(restaurant.id, checked)}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-4 pt-3 border-t border-border/50\">\r\n                          <div className=\"flex items-center justify-between mb-2\">\r\n                            <span className=\"text-xs font-medium text-muted-foreground\">Commission Rate</span>\r\n                            <span className=\"text-xs font-bold bg-secondary px-2 py-0.5 rounded text-secondary-foreground\">\r\n                              {restaurant.commission_rate}%\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"relative flex-1\">\r\n                              <Input\r\n                                type=\"number\"\r\n                                placeholder=\"New rate\"\r\n                                value={commissionUpdates[restaurant.id] || ''}\r\n                                onChange={(e) => setCommissionUpdates((prev) => ({\r\n                                  ...prev,\r\n                                  [restaurant.id]: e.target.value,\r\n                                }))}\r\n                                className=\"h-8 text-sm pr-6\"\r\n                                min=\"0\"\r\n                                max=\"100\"\r\n                              />\r\n                              <span className=\"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-muted-foreground\">%</span>\r\n                            </div>\r\n                            <Button\r\n                              size=\"sm\"\r\n                              onClick={() => updateCommission(restaurant.id)}\r\n                              disabled={!commissionUpdates[restaurant.id]}\r\n                              className=\"h-8\"\r\n                            >\r\n                              Set\r\n                            </Button>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </ScrollArea>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"delivery-areas\">\r\n            <DeliveryPincodesManager />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"reports\">\r\n            <ReportsAnalytics />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"financials\">\r\n            <FinancialAnalytics />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"orders\">\r\n            <Card className=\"border-0 shadow-lg\">\r\n              <CardHeader className=\"pb-3\">\r\n                <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3\">\r\n                  <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                    <Package className=\"w-5 h-5 text-status-confirmed\" />\r\n                    Orders ({filteredOrders.length})\r\n                  </CardTitle>\r\n                  <div className=\"flex flex-col sm:flex-row gap-2\">\r\n                    <div className=\"relative\">\r\n                      <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                      <Input\r\n                        placeholder=\"Search orders...\"\r\n                        value={searchOrders}\r\n                        onChange={(e) => setSearchOrders(e.target.value)}\r\n                        className=\"pl-9 h-9 w-full sm:w-48\"\r\n                      />\r\n                    </div>\r\n                    <Select value={orderStatusFilter} onValueChange={setOrderStatusFilter}>\r\n                      <SelectTrigger className=\"h-9 w-full sm:w-36\">\r\n                        <Filter className=\"w-3.5 h-3.5 mr-1\" />\r\n                        <SelectValue placeholder=\"Status\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"all\">All Status</SelectItem>\r\n                        <SelectItem value=\"pending\">Pending</SelectItem>\r\n                        <SelectItem value=\"confirmed\">Confirmed</SelectItem>\r\n                        <SelectItem value=\"preparing\">Preparing</SelectItem>\r\n                        <SelectItem value=\"ready_for_pickup\">Ready</SelectItem>\r\n                        <SelectItem value=\"picked_up\">Picked Up</SelectItem>\r\n                        <SelectItem value=\"on_the_way\">On The Way</SelectItem>\r\n                        <SelectItem value=\"delivered\">Delivered</SelectItem>\r\n                        <SelectItem value=\"cancelled\">Cancelled</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"p-0\">\r\n                <ScrollArea className=\"h-[500px]\">\r\n                  <div className=\"p-4 space-y-3\">\r\n                    {filteredOrders.map((order) => (\r\n                      <AdminOrderCard\r\n                        key={order.id}\r\n                        order={order}\r\n                        deliveryPartners={deliveryPartners}\r\n                        onCancel={cancelOrder}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                </ScrollArea>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"partners\">\r\n            <Card className=\"border-0 shadow-lg\">\r\n              <CardHeader className=\"pb-3\">\r\n                <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                  <Bike className=\"w-5 h-5 text-status-preparing\" />\r\n                  Delivery Partners ({deliveryPartners.length})\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                  {deliveryPartners.map((partner) => (\r\n                    <div\r\n                      key={partner.id}\r\n                      className=\"p-4 rounded-xl border border-border bg-card hover:bg-secondary/30 transition-all\"\r\n                    >\r\n                      <div className=\"flex items-start gap-3\">\r\n                        <div className={`w-12 h-12 rounded-full flex items-center justify-center ${partner.is_available ? 'bg-accent/20' : 'bg-muted'\r\n                          }`}>\r\n                          <Bike className={`w-6 h-6 ${partner.is_available ? 'text-accent' : 'text-muted-foreground'}`} />\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-center justify-between\">\r\n                            <p className=\"text-sm font-semibold\">\r\n                              {partner.profiles?.full_name || partner.profiles?.email || `Partner #${partner.id.slice(0, 6)}`}\r\n                            </p>\r\n                            <span className={`text-xs px-2 py-0.5 rounded-full ${partner.is_available\r\n                              ? 'bg-accent/20 text-accent'\r\n                              : 'bg-muted text-muted-foreground'\r\n                              }`}>\r\n                              {partner.is_available ? 'Online' : 'Offline'}\r\n                            </span>\r\n                          </div>\r\n                          {partner.phone && (\r\n                            <a\r\n                              href={`tel:${partner.phone}`}\r\n                              className=\"flex items-center gap-1 text-xs text-primary hover:underline mt-1\"\r\n                            >\r\n                              <Phone className=\"w-3 h-3\" />\r\n                              {partner.phone}\r\n                            </a>\r\n                          )}\r\n                          {partner.vehicle_type && (\r\n                            <p className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\r\n                              <Bike className=\"w-3 h-3\" />\r\n                              {partner.vehicle_type}\r\n                            </p>\r\n                          )}\r\n                          {!partner.phone_verified && partner.verification_otp && (\r\n                            <p className=\"text-xs font-bold text-orange-500 mt-1 flex items-center gap-1\">\r\n                              <Shield className=\"w-3 h-3\" />\r\n                              OTP: {partner.verification_otp}\r\n                            </p>\r\n                          )}\r\n                          <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            Joined: {format(new Date(partner.created_at), 'MMM d, yyyy')}\r\n                          </p>\r\n                          <div className=\"grid grid-cols-2 gap-2 mt-3 pt-3 border-t border-border/50\">\r\n                            <div className=\"text-center p-1.5 bg-secondary/30 rounded\">\r\n                              <p className=\"text-[10px] text-muted-foreground uppercase\">Deliveries</p>\r\n                              <p className=\"font-bold text-sm\">{partner.stats?.total_deliveries || 0}</p>\r\n                            </div>\r\n                            <div className=\"text-center p-1.5 bg-secondary/30 rounded\">\r\n                              <p className=\"text-[10px] text-muted-foreground uppercase\">Success</p>\r\n                              <p className=\"font-bold text-sm text-accent\">{partner.stats?.success_rate || 0}%</p>\r\n                            </div>\r\n                            <div className=\"text-center p-1.5 bg-secondary/30 rounded\">\r\n                              <p className=\"text-[10px] text-muted-foreground uppercase\">Cancelled</p>\r\n                              <p className=\"font-bold text-sm text-destructive\">{partner.stats?.cancelled || 0}</p>\r\n                            </div>\r\n                            <div className=\"text-center p-1.5 bg-secondary/30 rounded\">\r\n                              <p className=\"text-[10px] text-muted-foreground uppercase\">Rating</p>\r\n                              <div className=\"flex items-center justify-center gap-0.5 font-bold text-sm\">\r\n                                <span>{partner.stats?.avg_rating?.toFixed(1) || ''}</span>\r\n                                <Star className=\"w-3 h-3 text-yellow-500 fill-yellow-500\" />\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                  {deliveryPartners.length === 0 && (\r\n                    <div className=\"col-span-full text-center py-8 text-muted-foreground\">\r\n                      <Bike className=\"w-10 h-10 mx-auto mb-2 opacity-50\" />\r\n                      <p>No delivery partners registered yet</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"users\">\r\n            <Card className=\"border-0 shadow-lg\">\r\n              <CardHeader className=\"pb-3\">\r\n                <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3\">\r\n                  <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                    <Users className=\"w-5 h-5 text-primary\" />\r\n                    User Role Management ({filteredUsers.length})\r\n                  </CardTitle>\r\n                  <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                    <Input\r\n                      placeholder=\"Search users...\"\r\n                      value={searchUsers}\r\n                      onChange={(e) => setSearchUsers(e.target.value)}\r\n                      className=\"pl-9 h-9 w-full sm:w-64\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"p-0\">\r\n                <ScrollArea className=\"h-[500px]\">\r\n                  <div className=\"p-4 space-y-3\">\r\n                    {filteredUsers.map((u) => (\r\n                      <div\r\n                        key={u.id}\r\n                        className=\"p-4 rounded-xl border border-border bg-card hover:bg-secondary/30 transition-all\"\r\n                      >\r\n                        <div className=\"flex items-start justify-between gap-3\">\r\n                          <div className=\"flex-1 min-w-0\">\r\n                            <h4 className=\"font-semibold\">{u.full_name || 'No Name'}</h4>\r\n                            <p className=\"text-sm text-muted-foreground\">{u.email}</p>\r\n                            <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                              {u.roles.map((role) => (\r\n                                <span\r\n                                  key={role}\r\n                                  className=\"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-primary/10 text-primary\"\r\n                                >\r\n                                  {role}\r\n                                  <button\r\n                                    onClick={() => removeRoleFromUser(u.id, role)}\r\n                                    className=\"hover:text-destructive\"\r\n                                  >\r\n                                    <X className=\"w-3 h-3\" />\r\n                                  </button>\r\n                                </span>\r\n                              ))}\r\n                              {u.roles.length === 0 && (\r\n                                <span className=\"text-xs text-muted-foreground\">No roles assigned</span>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-2 mt-3 pt-3 border-t border-border/50\">\r\n                          <Select\r\n                            value={selectedRole[u.id] || ''}\r\n                            onValueChange={(value) => setSelectedRole(prev => ({ ...prev, [u.id]: value as AppRole }))}\r\n                          >\r\n                            <SelectTrigger className=\"w-40 h-8\">\r\n                              <SelectValue placeholder=\"Select role\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              <SelectItem value=\"super_admin\">Super Admin</SelectItem>\r\n                              <SelectItem value=\"restaurant_owner\">Restaurant Owner</SelectItem>\r\n                              <SelectItem value=\"delivery_partner\">Delivery Partner</SelectItem>\r\n                              <SelectItem value=\"support_agent\">Support Agent</SelectItem>\r\n                              <SelectItem value=\"customer\">Customer</SelectItem>\r\n                            </SelectContent>\r\n                          </Select>\r\n                          <Button\r\n                            size=\"sm\"\r\n                            onClick={() => addRoleToUser(u.id)}\r\n                            disabled={!selectedRole[u.id]}\r\n                            className=\"h-8\"\r\n                          >\r\n                            <UserPlus className=\"w-3 h-3 mr-1\" />\r\n                            Add Role\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </ScrollArea>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"promotions\">\r\n            <PromotionsManager />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"coupons\">\r\n            <CouponsManager />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"settlements\">\r\n            <Tabs defaultValue=\"partners\" className=\"w-full\">\r\n              <div className=\"flex items-center gap-4 mb-4\">\r\n                <TabsList>\r\n                  <TabsTrigger value=\"partners\" className=\"flex items-center gap-2\">\r\n                    <Bike className=\"h-4 w-4\" />\r\n                    Delivery Partners\r\n                  </TabsTrigger>\r\n                  <TabsTrigger value=\"shops\" className=\"flex items-center gap-2\">\r\n                    <Store className=\"h-4 w-4\" />\r\n                    Restaurants\r\n                  </TabsTrigger>\r\n                </TabsList>\r\n              </div>\r\n              <TabsContent value=\"partners\" className=\"m-0\">\r\n                <SettlementsManager />\r\n              </TabsContent>\r\n              <TabsContent value=\"shops\" className=\"m-0\">\r\n                <ShopSettlementsManager />\r\n              </TabsContent>\r\n            </Tabs>\r\n          </TabsContent>\r\n          <TabsContent value=\"settings\">\r\n            <ScheduleSettings />\r\n\r\n            {/* Keeping existing settings in a separate card below if needed, or we can merge them into ScheduleSettings later.\r\n                For now, let's keep the existing \"System Settings\" card below the Schedule Settings so we don't lose that functionality (Phone Login, Delivery Fee etc)\r\n                Actually, the user asked for \"Schedule... time fix to admin\", so I should prioritize the schedule settings.\r\n                I'll render the new component first.\r\n            */}\r\n\r\n            <div className=\"mt-6\">\r\n              <Card className=\"border-0 shadow-lg\">\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                    <Settings className=\"w-5 h-5 text-primary\" />\r\n                    General Settings\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-6\">\r\n                  <div className=\"flex items-center justify-between p-4 border rounded-xl bg-card\">\r\n                    <div className=\"space-y-0.5\">\r\n                      <h4 className=\"font-semibold text-base\">Phone Login</h4>\r\n                      <p className=\"text-sm text-muted-foreground\">\r\n                        Enable or disable phone number authentication.\r\n                      </p>\r\n                    </div>\r\n                    <Switch\r\n                      checked={enablePhoneLogin}\r\n                      onCheckedChange={(checked) => updateSetting('enable_phone_login', checked)}\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"p-4 border rounded-xl bg-card space-y-4\">\r\n                    <h4 className=\"font-semibold text-base\">Settlement Configuration</h4>\r\n\r\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium\">Delivery Fee per Order ()</label>\r\n                        <div className=\"flex gap-2\">\r\n                          <Input\r\n                            type=\"number\"\r\n                            value={deliveryFee}\r\n                            onChange={(e) => setDeliveryFee(e.target.value)}\r\n                            placeholder=\"30\"\r\n                          />\r\n                          <Button\r\n                            variant=\"secondary\"\r\n                            onClick={() => updateSetting('delivery_fee_per_order', Number(deliveryFee))}\r\n                          >\r\n                            Save\r\n                          </Button>\r\n                        </div>\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                          Amount paid to partner per delivery.\r\n                        </p>\r\n                      </div>\r\n\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium\">Pending Settlement (%)</label>\r\n                        <div className=\"flex gap-2\">\r\n                          <Input\r\n                            type=\"number\"\r\n                            value={settlementPercent}\r\n                            onChange={(e) => setSettlementPercent(e.target.value)}\r\n                            placeholder=\"20\"\r\n                          />\r\n                          <Button\r\n                            variant=\"secondary\"\r\n                            onClick={() => updateSetting('pending_settlement_percentage', Number(settlementPercent))}\r\n                          >\r\n                            Save\r\n                          </Button>\r\n                        </div>\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                          Percentage of earnings held for later settlement.\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\admin\\SupportDashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTickets'. Either include it or remove the dependency array.","line":53,"column":8,"nodeType":"ArrayExpression","endLine":53,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [session, filterStatus, fetchTickets]","fix":{"range":[1469,1492],"text":"[session, filterStatus, fetchTickets]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2010,2013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2010,2013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2235,2238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2235,2238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3115,3118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3115,3118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3296,3299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3296,3299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4141,4144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4141,4144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10883,10886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10883,10886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\r\nimport { useAuth } from \"@/hooks/useAuth\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/components/ui/table\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { toast } from \"sonner\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\n\r\ninterface Ticket {\r\n    id: string;\r\n    user_id: string;\r\n    subject: string;\r\n    status: \"open\" | \"in_progress\" | \"resolved\" | \"closed\";\r\n    priority: \"low\" | \"medium\" | \"high\" | \"urgent\";\r\n    created_at: string;\r\n    assigned_to: string | null;\r\n    profile?: {\r\n        full_name: string;\r\n        email: string;\r\n        phone: string;\r\n    };\r\n    assignee?: {\r\n        full_name: string;\r\n        email: string;\r\n    };\r\n}\r\n\r\nconst SupportDashboard = () => {\r\n    const { session, user } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [tickets, setTickets] = useState<Ticket[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [filterStatus, setFilterStatus] = useState<string>(\"all\");\r\n\r\n    useEffect(() => {\r\n        fetchTickets();\r\n    }, [session, filterStatus]);\r\n\r\n    const fetchTickets = async () => {\r\n        try {\r\n            let query = supabase\r\n                .from(\"support_tickets\")\r\n                .select(`\r\n          *,\r\n          profile:profiles!support_tickets_user_id_fkey(full_name, email, phone),\r\n          assignee:profiles!support_tickets_assigned_to_fkey(full_name, email)\r\n        `)\r\n                .order(\"created_at\", { ascending: false });\r\n\r\n            if (filterStatus !== \"all\") {\r\n                query = query.eq(\"status\", filterStatus as any);\r\n            }\r\n\r\n            const { data, error } = await query;\r\n\r\n            if (error) throw error;\r\n\r\n            // Transform data to match interface\r\n            const transformedTickets = (data || []).map((t: any) => ({\r\n                ...t,\r\n                profile: t.profile // profile is now an object, not an array because of the FK relationship? Wait, profiles is 1:1 with users but users:tickets is 1:N. The query returns profile for the user_id.\r\n                // Supabase join normally returns an object if 1:1 or 1:N. Profiles is 1:1 on user_id.\r\n            }));\r\n\r\n            setTickets(transformedTickets);\r\n        } catch (error) {\r\n            console.error(\"Error fetching tickets:\", error);\r\n            toast.error(`Failed to load tickets: ${error.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const updateTicketStatus = async (ticketId: string, newStatus: string) => {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('support_tickets')\r\n                .update({ status: newStatus as any })\r\n                .eq('id', ticketId);\r\n\r\n            if (error) throw error;\r\n\r\n            setTickets(prev => prev.map(t => t.id === ticketId ? { ...t, status: newStatus as any } : t));\r\n            toast.success(`Ticket status updated to ${newStatus}`);\r\n        } catch (error) {\r\n            console.error(\"Error updating status:\", error);\r\n            toast.error(\"Failed to update status\");\r\n        }\r\n    }\r\n\r\n    const getStatusBadgeVariant = (status: string) => {\r\n        switch (status) {\r\n            case 'open': return 'default'; // primary\r\n            case 'in_progress': return 'secondary';\r\n            case 'resolved': return 'outline'; // green-ish?\r\n            case 'closed': return 'destructive';\r\n            default: return 'outline';\r\n        }\r\n    }\r\n\r\n    const handleAssign = async (ticketId: string) => {\r\n        if (!user) return;\r\n\r\n        const { error } = await supabase\r\n            .from(\"support_tickets\")\r\n            .update({ assigned_to: user.id, status: 'in_progress' } as any)\r\n            .eq(\"id\", ticketId);\r\n\r\n        if (error) {\r\n            toast.error(\"Failed to claim ticket\");\r\n        } else {\r\n            toast.success(\"Ticket claimed successfully\");\r\n            fetchTickets();\r\n        }\r\n    };\r\n\r\n    const getPriorityColor = (priority: string) => {\r\n        switch (priority) {\r\n            case \"high\":\r\n            case \"urgent\":\r\n                return \"text-red-600 font-bold\";\r\n            case \"medium\":\r\n                return \"text-amber-600\";\r\n            default:\r\n                return \"text-gray-600\";\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-8 space-y-6\">\r\n            <div className=\"flex justify-between items-center\">\r\n                <h1 className=\"text-3xl font-bold\">Support Panel</h1>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-sm font-medium\">Filter Status:</span>\r\n                    <Select value={filterStatus} onValueChange={setFilterStatus}>\r\n                        <SelectTrigger className=\"w-[180px]\">\r\n                            <SelectValue placeholder=\"Filter by status\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">All Tickets</SelectItem>\r\n                            <SelectItem value=\"open\">Open</SelectItem>\r\n                            <SelectItem value=\"in_progress\">In Progress</SelectItem>\r\n                            <SelectItem value=\"resolved\">Resolved</SelectItem>\r\n                            <SelectItem value=\"closed\">Closed</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>All Tickets</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    {loading ? (\r\n                        <div>Loading tickets...</div>\r\n                    ) : (\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow>\r\n                                    <TableHead>Date</TableHead>\r\n                                    <TableHead>User</TableHead>\r\n                                    <TableHead>Assigned To</TableHead>\r\n                                    <TableHead>Subject</TableHead>\r\n                                    <TableHead>Priority</TableHead>\r\n                                    <TableHead>Status</TableHead>\r\n                                    <TableHead>Actions</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {tickets.length === 0 ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={7} className=\"text-center py-8\">No tickets found</TableCell>\r\n                                    </TableRow>\r\n                                ) : (\r\n                                    tickets.map((ticket) => (\r\n                                        <TableRow key={ticket.id} className=\"cursor-pointer hover:bg-gray-50\" onClick={() => {\r\n                                            // Check path to keep user in same context (admin or staff)\r\n                                            const isStaff = window.location.pathname.includes('/staff');\r\n                                            navigate(isStaff ? `/staff/support/${ticket.id}` : `/admin/support/${ticket.id}`);\r\n                                        }}>\r\n                                            <TableCell>\r\n                                                {new Date(ticket.created_at).toLocaleDateString()}\r\n                                                <div className=\"text-xs text-gray-500\">\r\n                                                    {new Date(ticket.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <div className=\"font-medium\">{ticket.profile?.full_name || 'Unknown'}</div>\r\n                                                <div className=\"text-xs text-muted-foreground\">{ticket.profile?.email}</div>\r\n                                                <div className=\"text-xs text-muted-foreground\">{ticket.profile?.phone}</div>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                {ticket.assignee ? (\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <Badge variant=\"outline\" className=\"text-xs\">\r\n                                                            {ticket.assignee.full_name || 'Staff'}\r\n                                                        </Badge>\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <Button\r\n                                                        size=\"sm\"\r\n                                                        variant=\"outline\"\r\n                                                        className=\"h-6 text-xs\"\r\n                                                        onClick={(e) => {\r\n                                                            e.stopPropagation();\r\n                                                            handleAssign(ticket.id);\r\n                                                        }}\r\n                                                    >\r\n                                                        Claim\r\n                                                    </Button>\r\n                                                )}\r\n                                            </TableCell>\r\n                                            <TableCell className=\"font-medium\">{ticket.subject}</TableCell>\r\n                                            <TableCell>\r\n                                                <span className={getPriorityColor(ticket.priority)}>\r\n                                                    {ticket.priority.toUpperCase()}\r\n                                                </span>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Badge variant={getStatusBadgeVariant(ticket.status) as any}>\r\n                                                    {ticket.status.replace('_', ' ').toUpperCase()}\r\n                                                </Badge>\r\n                                            </TableCell>\r\n                                            <TableCell onClick={(e) => e.stopPropagation()}>\r\n                                                <Select\r\n                                                    defaultValue={ticket.status}\r\n                                                    onValueChange={(val) => updateTicketStatus(ticket.id, val)}\r\n                                                >\r\n                                                    <SelectTrigger className=\"h-8 w-[130px]\">\r\n                                                        <SelectValue />\r\n                                                    </SelectTrigger>\r\n                                                    <SelectContent>\r\n                                                        <SelectItem value=\"open\">Open</SelectItem>\r\n                                                        <SelectItem value=\"in_progress\">In Progress</SelectItem>\r\n                                                        <SelectItem value=\"resolved\">Resolved</SelectItem>\r\n                                                        <SelectItem value=\"closed\">Closed</SelectItem>\r\n                                                    </SelectContent>\r\n                                                </Select>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    )}\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SupportDashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\delivery\\DeliveryDashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'passedOrderIds' and 'user'. Either include them or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setAvailableOrders' needs the current value of 'passedOrderIds'.","line":260,"column":6,"nodeType":"ArrayExpression","endLine":260,"endColumn":89,"suggestions":[{"desc":"Update the dependencies array to be: [user, passedOrderIds, settings.delivery_fee_per_order]","fix":{"range":[9844,9927],"text":"[user, passedOrderIds, settings.delivery_fee_per_order]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user'. Either include it or remove the dependency array.","line":270,"column":6,"nodeType":"ArrayExpression","endLine":270,"endColumn":50,"suggestions":[{"desc":"Update the dependencies array to be: [user.id, authLoading, navigate, fetchData, user]","fix":{"range":[10085,10129],"text":"[user.id, authLoading, navigate, fetchData, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useAuth } from '@/hooks/useAuth';\r\nimport { useAppSettings } from '@/hooks/useAppSettings';\r\nimport { Order, OrderStatus, DeliveryPartner } from '@/types/database';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { StatusBadge } from '@/components/StatusBadge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from '@/components/ui/alert-dialog';\r\nimport {\r\n  Bike,\r\n  ArrowLeft,\r\n  MapPin,\r\n  Navigation,\r\n  Package,\r\n  Clock,\r\n  CheckCircle,\r\n  Phone,\r\n  Key,\r\n  Banknote,\r\n  Smartphone,\r\n  AlertCircle,\r\n  Shield,\r\n  History,\r\n  Wallet,\r\n  IndianRupee,\r\n  TrendingUp,\r\n  User,\r\n  RefreshCw,\r\n  ExternalLink,\r\n  X,\r\n  BarChart3,\r\n  FileText,\r\n  Headphones,\r\n  Star,\r\n  Calendar,\r\n  Percent,\r\n  Award,\r\n  MessageSquare\r\n} from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { format } from 'date-fns';\r\nimport { useDeliveryPartnerNotifications } from '@/hooks/useOrderNotifications';\r\n\r\ninterface OrderWithDetails extends Order {\r\n  restaurants: { name: string; address: string; phone: string | null } | null;\r\n  customer_profile?: { full_name: string | null; phone: string | null } | null;\r\n}\r\n\r\n// Helper to generate short order ID\r\nconst getShortOrderId = (id: string) => {\r\n  return `#${id.slice(0, 8).toUpperCase()}`;\r\n};\r\n\r\nexport default function DeliveryDashboard() {\r\n  const { user, loading: authLoading } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [deliveryPartner, setDeliveryPartner] = useState<DeliveryPartner | null>(null);\r\n  const [profile, setProfile] = useState<{ full_name: string | null; phone: string | null } | null>(null);\r\n  const [availableOrders, setAvailableOrders] = useState<OrderWithDetails[]>([]);\r\n  const [passedOrderIds, setPassedOrderIds] = useState<string[]>([]);\r\n  const [myOrders, setMyOrders] = useState<OrderWithDetails[]>([]);\r\n  const [orderHistory, setOrderHistory] = useState<OrderWithDetails[]>([]);\r\n  const { settings } = useAppSettings();\r\n\r\n  useEffect(() => {\r\n    // ... (existing code)\r\n  }, []);\r\n\r\n  // State declarations moved from invalid position\r\n  const [earnings, setEarnings] = useState({ today: 0, week: 0, total: 0, pending: 0 });\r\n  const [avgRating, setAvgRating] = useState<number | null>(null);\r\n  const [totalRatings, setTotalRatings] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [showRegister, setShowRegister] = useState(false);\r\n  const [deliveryOtpInputs, setDeliveryOtpInputs] = useState<Record<string, string>>({});\r\n  const [deliveryOtpErrors, setDeliveryOtpErrors] = useState<Record<string, boolean>>({});\r\n  const [pickupOtpInputs, setPickupOtpInputs] = useState<Record<string, string>>({});\r\n  const [pickupOtpErrors, setPickupOtpErrors] = useState<Record<string, boolean>>({});\r\n\r\n  // Phone verification states\r\n  const [phoneNumber, setPhoneNumber] = useState('');\r\n  const [verificationOtp, setVerificationOtp] = useState('');\r\n  const [profileOtp, setProfileOtp] = useState('');\r\n  const [generatedOtp, setGeneratedOtp] = useState('');\r\n  const [showVerificationInput, setShowVerificationInput] = useState(false);\r\n\r\n\r\n  const fetchData = useCallback(async () => {\r\n    try {\r\n      // Check if user is a delivery partner\r\n      const { data: partnerData } = await supabase\r\n        .from('delivery_partners')\r\n        .select('*')\r\n        .eq('user_id', user!.id)\r\n        .maybeSingle();\r\n\r\n      // Fetch user profile\r\n      const { data: profileData } = await supabase\r\n        .from('profiles')\r\n        .select('full_name, phone')\r\n        .eq('id', user!.id)\r\n        .maybeSingle();\r\n\r\n      if (profileData) setProfile(profileData);\r\n\r\n      if (partnerData) {\r\n        setDeliveryPartner(partnerData);\r\n\r\n        // Fetch available orders (ready_for_pickup with no delivery partner)\r\n        // Include pickup_otp for OTP verification\r\n        const { data: availableData } = await supabase\r\n          .from('orders')\r\n          .select('*, restaurants(name, address, phone)')\r\n          .eq('status', 'ready_for_pickup')\r\n          .is('delivery_partner_id', null)\r\n          .order('created_at', { ascending: false });\r\n\r\n        if (availableData) {\r\n          // Fetch customer profiles for available orders\r\n          const customerIds = availableData.map(o => o.customer_id);\r\n          let customerProfiles: { id: string; full_name: string | null; phone: string | null }[] = [];\r\n\r\n          if (customerIds.length > 0) {\r\n            const { data: profilesData } = await supabase\r\n              .from('profiles')\r\n              .select('id, full_name, phone')\r\n              .in('id', customerIds);\r\n            customerProfiles = profilesData || [];\r\n          }\r\n\r\n          const ordersWithProfiles = availableData.map(order => ({\r\n            ...order,\r\n            customer_profile: customerProfiles.find(p => p.id === order.customer_id) || null\r\n          }));\r\n          // Filter out locally passed orders\r\n          setAvailableOrders(ordersWithProfiles.filter(o => !passedOrderIds.includes(o.id)));\r\n        }\r\n\r\n        // Fetch my orders with customer info\r\n        // Now includes 'ready_for_pickup' orders assigned to me\r\n        const { data: myOrdersData } = await supabase\r\n          .from('orders')\r\n          .select('*, restaurants(name, address, phone)')\r\n          .eq('delivery_partner_id', partnerData.id)\r\n          .in('status', ['ready_for_pickup', 'picked_up', 'on_the_way'])\r\n          .order('created_at', { ascending: false });\r\n\r\n        if (myOrdersData) {\r\n          // Fetch customer profiles for my orders\r\n          const customerIds = myOrdersData.map(o => o.customer_id);\r\n          let customerProfiles: { id: string; full_name: string | null; phone: string | null }[] = [];\r\n\r\n          if (customerIds.length > 0) {\r\n            const { data: profilesData } = await supabase\r\n              .from('profiles')\r\n              .select('id, full_name, phone')\r\n              .in('id', customerIds);\r\n            customerProfiles = profilesData || [];\r\n          }\r\n\r\n          const ordersWithProfiles = myOrdersData.map(order => ({\r\n            ...order,\r\n            customer_profile: customerProfiles.find(p => p.id === order.customer_id) || null\r\n          }));\r\n          setMyOrders(ordersWithProfiles);\r\n        }\r\n\r\n        // Fetch order history (completed/cancelled)\r\n        const { data: historyData } = await supabase\r\n          .from('orders')\r\n          .select('*, restaurants(name, address, phone)')\r\n          .eq('delivery_partner_id', partnerData.id)\r\n          .in('status', ['delivered', 'cancelled'])\r\n          .order('created_at', { ascending: false })\r\n          .limit(50);\r\n\r\n        if (historyData) setOrderHistory(historyData);\r\n\r\n        // Calculate earnings\r\n        const deliveredOrders = historyData?.filter(o => o.status === 'delivered') || [];\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const weekAgo = new Date(today);\r\n        weekAgo.setDate(weekAgo.getDate() - 7);\r\n\r\n\r\n        const todayEarnings = deliveredOrders\r\n          .filter(o => new Date(o.created_at) >= today)\r\n          .reduce((sum, o) => sum + (Number(o.total_amount) - (o.delivery_fee || settings.delivery_fee_per_order || 25) - 8), 0);\r\n\r\n        const weekEarnings = deliveredOrders\r\n          .filter(o => new Date(o.created_at) >= weekAgo)\r\n          .reduce((sum, o) => sum + (Number(o.total_amount) - (o.delivery_fee || settings.delivery_fee_per_order || 25) - 8), 0);\r\n\r\n        const totalEarnings = deliveredOrders.reduce((sum, o) =>\r\n          sum + (Number(o.total_amount) - (o.delivery_fee || settings.delivery_fee_per_order || 25) - 8), 0);\r\n\r\n        // Fetch settlements\r\n        const { data: settlementsData } = await supabase\r\n          .from('settlements')\r\n          .select('amount')\r\n          .eq('delivery_partner_id', partnerData.id);\r\n\r\n        const totalSettled = settlementsData?.reduce((sum, s) => sum + Number(s.amount), 0) || 0;\r\n\r\n\r\n\r\n        // Revised Pending Calculation: Total Earnings - Total Settled + Incentives (if any)\r\n        // For now, let's keep incentives separate or just use Total Earnings - Settled\r\n        const pendingSettlement = totalEarnings - totalSettled;\r\n\r\n        setEarnings({\r\n          today: todayEarnings,\r\n          week: weekEarnings,\r\n          total: totalEarnings,\r\n          pending: pendingSettlement\r\n        });\r\n\r\n        // Fetch ratings for this delivery partner\r\n        const { data: ratingsData } = await supabase\r\n          .from('order_ratings')\r\n          .select('rating')\r\n          .eq('delivery_partner_id', partnerData.id);\r\n\r\n        if (ratingsData && ratingsData.length > 0) {\r\n          const total = ratingsData.reduce((sum, r) => sum + r.rating, 0);\r\n          setAvgRating(total / ratingsData.length);\r\n          setTotalRatings(ratingsData.length);\r\n        } else {\r\n          setAvgRating(null);\r\n          setTotalRatings(0);\r\n        }\r\n      } else {\r\n        setShowRegister(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching data:', error);\r\n      toast.error('Failed to load data');\r\n    }\r\n\r\n    setLoading(false);\r\n    setRefreshing(false);\r\n  }, [user?.id, settings.delivery_fee_per_order, settings.pending_settlement_percentage]);\r\n\r\n  useEffect(() => {\r\n    if (!authLoading) {\r\n      if (!user) {\r\n        navigate('/auth');\r\n        return;\r\n      }\r\n      fetchData();\r\n    }\r\n  }, [user?.id, authLoading, navigate, fetchData]);\r\n\r\n  // Real-time order updates\r\n  useEffect(() => {\r\n    if (!deliveryPartner) return;\r\n\r\n    const channel = supabase\r\n      .channel('delivery-orders')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: '*',\r\n          schema: 'public',\r\n          table: 'orders'\r\n        },\r\n        () => {\r\n          fetchData();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [deliveryPartner, fetchData]);\r\n\r\n  // Sound notifications for available orders\r\n  useDeliveryPartnerNotifications(deliveryPartner?.id, deliveryPartner?.is_available || false);\r\n\r\n  const handleRefresh = () => {\r\n    setRefreshing(true);\r\n    fetchData();\r\n  };\r\n\r\n  const sendVerificationOtp = () => {\r\n    if (!phoneNumber || phoneNumber.length < 10) {\r\n      toast.error('Please enter a valid phone number');\r\n      return;\r\n    }\r\n\r\n    // Generate OTP (demo mode - show in app)\r\n    const otp = Math.floor(1000 + Math.random() * 9000).toString();\r\n    setGeneratedOtp(otp);\r\n    setShowVerificationInput(true);\r\n\r\n    // Save OTP to database for Admin verification\r\n    const saveOtp = async () => {\r\n      const { error } = await supabase\r\n        .from('delivery_partners')\r\n        .upsert({\r\n          user_id: user!.id,\r\n          phone: phoneNumber,\r\n          verification_otp: otp,\r\n          phone_verified: false,\r\n          is_available: false\r\n        }, { onConflict: 'user_id' });\r\n\r\n      if (error) {\r\n        console.error('Error saving OTP:', error);\r\n        toast.error('Failed to send OTP to system');\r\n      } else {\r\n        toast.success(`OTP sent to Admin! Please contact support to verify.`);\r\n      }\r\n    };\r\n    saveOtp();\r\n  };\r\n\r\n  const verifyPhoneOtp = () => {\r\n    if (verificationOtp === generatedOtp) {\r\n      registerAsPartner();\r\n    } else {\r\n      toast.error('Invalid OTP. Please try again.');\r\n    }\r\n  };\r\n\r\n  const registerAsPartner = async () => {\r\n    const { data, error } = await supabase\r\n      .from('delivery_partners')\r\n      .update({\r\n        is_available: false,\r\n        vehicle_type: 'Bike',\r\n        phone: phoneNumber,\r\n        phone_verified: true,\r\n      })\r\n      .eq('user_id', user!.id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      toast.error(error.message);\r\n    } else {\r\n      // Use secure RPC to assign delivery_partner role\r\n      await supabase.rpc('request_delivery_partner_role');\r\n\r\n      setDeliveryPartner(data);\r\n      setShowRegister(false);\r\n      toast.success('Registered as delivery partner!');\r\n    }\r\n  };\r\n\r\n  const handleProfileVerification = async () => {\r\n    if (!deliveryPartner?.verification_otp) {\r\n      toast.error('No OTP found. Please contact Admin.');\r\n      return;\r\n    }\r\n\r\n    if (profileOtp === deliveryPartner.verification_otp) {\r\n      const { error } = await supabase\r\n        .from('delivery_partners')\r\n        .update({\r\n          phone_verified: true,\r\n          verification_otp: null // Clear OTP after verification\r\n        })\r\n        .eq('id', deliveryPartner.id); // verified against own ID\r\n\r\n      if (error) {\r\n        toast.error('Verification failed: ' + error.message);\r\n      } else {\r\n        toast.success('Phone verified successfully!');\r\n        fetchData();\r\n        setProfileOtp('');\r\n      }\r\n    } else {\r\n      toast.error('Invalid OTP. Please check with Admin.');\r\n    }\r\n  };\r\n\r\n  const toggleAvailability = async () => {\r\n    if (!deliveryPartner) return;\r\n\r\n    const { error } = await supabase\r\n      .from('delivery_partners')\r\n      .update({ is_available: !deliveryPartner.is_available })\r\n      .eq('id', deliveryPartner.id);\r\n\r\n    if (error) {\r\n      toast.error('Failed to update availability');\r\n    } else {\r\n      setDeliveryPartner({ ...deliveryPartner, is_available: !deliveryPartner.is_available });\r\n      toast.success(deliveryPartner.is_available ? 'You are now offline' : 'You are now online');\r\n      if (!deliveryPartner.is_available) fetchData(); // Refresh available orders\r\n    }\r\n  };\r\n\r\n  // Step 1: Accept Order (Assign to partner)\r\n  const acceptOrder = async (orderId: string) => {\r\n    if (!deliveryPartner) return;\r\n\r\n    // Check if partner already has an active order\r\n    const { data: hasActive } = await supabase.rpc('partner_has_active_order');\r\n    if (hasActive) {\r\n      toast.error('Complete your current delivery first. One order at a time.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Verify order is still available\r\n      const { data: orderData } = await supabase\r\n        .from('orders')\r\n        .select('delivery_partner_id')\r\n        .eq('id', orderId)\r\n        .single();\r\n\r\n      if (orderData?.delivery_partner_id) {\r\n        toast.error('Order already taken by another partner');\r\n        fetchData();\r\n        return;\r\n      }\r\n\r\n      // Assign to me\r\n      const { error } = await supabase\r\n        .from('orders')\r\n        .update({ delivery_partner_id: deliveryPartner.id })\r\n        .eq('id', orderId)\r\n        .is('delivery_partner_id', null); // Concurrency check\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success('Order accepted! Please proceed to pickup.');\r\n      fetchData();\r\n    } catch (error) {\r\n      console.error('Accept order error:', error);\r\n      toast.error('Failed to accept order');\r\n    }\r\n  };\r\n\r\n  // Step 2: Verify Pickup OTP (At shop)\r\n  const verifyPickupAndAccept = async (order: OrderWithDetails) => {\r\n    const otpValue = pickupOtpInputs[order.id] || '';\r\n\r\n    // Use secure server-side RPC for OTP verification\r\n    const { data, error } = await supabase.rpc('verify_pickup_and_accept_order', {\r\n      _order_id: order.id,\r\n      _pickup_otp: otpValue\r\n    });\r\n\r\n    if (error) {\r\n      toast.error('Failed to verify pickup');\r\n      return;\r\n    }\r\n\r\n    if (data) {\r\n      toast.success('Pickup verified! Start delivery.');\r\n      setPickupOtpInputs(prev => ({ ...prev, [order.id]: '' }));\r\n      setPickupOtpErrors(prev => ({ ...prev, [order.id]: false }));\r\n      fetchData();\r\n    } else {\r\n      setPickupOtpErrors(prev => ({ ...prev, [order.id]: true }));\r\n      toast.error('Invalid pickup OTP. Please check with the restaurant.');\r\n    }\r\n  };\r\n\r\n  const updateOrderStatus = async (orderId: string, status: OrderStatus) => {\r\n    const { error } = await supabase\r\n      .from('orders')\r\n      .update({ status })\r\n      .eq('id', orderId);\r\n\r\n    if (error) {\r\n      toast.error('Failed to update status');\r\n    } else {\r\n      toast.success('Status updated');\r\n      setDeliveryOtpInputs(prev => ({ ...prev, [orderId]: '' }));\r\n      setDeliveryOtpErrors(prev => ({ ...prev, [orderId]: false }));\r\n      fetchData();\r\n    }\r\n  };\r\n\r\n  const verifyAndDeliver = async (order: OrderWithDetails) => {\r\n    const otpValue = deliveryOtpInputs[order.id] || '';\r\n\r\n    // Use secure server-side RPC for OTP verification\r\n    const { data, error } = await supabase.rpc('verify_delivery_and_complete', {\r\n      _order_id: order.id,\r\n      _delivery_otp: otpValue\r\n    });\r\n\r\n    if (error) {\r\n      toast.error('Failed to update status');\r\n      return;\r\n    }\r\n\r\n    if (data) {\r\n      toast.success('Order delivered!');\r\n      setDeliveryOtpInputs(prev => ({ ...prev, [order.id]: '' }));\r\n      setDeliveryOtpErrors(prev => ({ ...prev, [order.id]: false }));\r\n      fetchData();\r\n    } else {\r\n      setDeliveryOtpErrors(prev => ({ ...prev, [order.id]: true }));\r\n      toast.error('Invalid OTP. Please check with the customer.');\r\n    }\r\n  };\r\n\r\n\r\n  if (authLoading || loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"animate-pulse text-muted-foreground\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (showRegister) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background\">\r\n        <header className=\"sticky top-0 z-50 bg-card/95 backdrop-blur-md border-b border-border\">\r\n          <div className=\"container mx-auto px-4 py-4\">\r\n            <Link to=\"/\" className=\"flex items-center gap-2 text-foreground hover:text-primary transition-colors\">\r\n              <ArrowLeft className=\"w-5 h-5\" />\r\n              <span>Back</span>\r\n            </Link>\r\n          </div>\r\n        </header>\r\n        <div className=\"container mx-auto px-4 py-8 max-w-md\">\r\n          <Card className=\"border-0 shadow-lg\">\r\n            <CardContent className=\"py-8\">\r\n              <div className=\"text-center mb-6\">\r\n                <div className=\"w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                  <Bike className=\"w-10 h-10 text-primary\" />\r\n                </div>\r\n                <h2 className=\"text-2xl font-bold mb-2\">Become a Delivery Partner</h2>\r\n                <p className=\"text-muted-foreground\">\r\n                  Earn money delivering food to customers in your area\r\n                </p>\r\n              </div>\r\n\r\n              {!showVerificationInput ? (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"phone\">Phone Number</Label>\r\n                    <div className=\"relative\">\r\n                      <Phone className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\r\n                      <Input\r\n                        id=\"phone\"\r\n                        type=\"tel\"\r\n                        placeholder=\"+1 234 567 8900\"\r\n                        value={phoneNumber}\r\n                        onChange={(e) => setPhoneNumber(e.target.value)}\r\n                        className=\"pl-10\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <Button onClick={sendVerificationOtp} className=\"w-full\" size=\"lg\">\r\n                    <Shield className=\"w-4 h-4 mr-2\" />\r\n                    Send Verification OTP\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"otp\">Enter OTP</Label>\r\n                    <Input\r\n                      id=\"otp\"\r\n                      type=\"text\"\r\n                      placeholder=\"Enter 4-digit OTP\"\r\n                      value={verificationOtp}\r\n                      onChange={(e) => setVerificationOtp(e.target.value.replace(/\\D/g, '').slice(0, 4))}\r\n                      className=\"font-mono text-center text-lg tracking-widest\"\r\n                      maxLength={4}\r\n                    />\r\n                  </div>\r\n                  <Button onClick={verifyPhoneOtp} className=\"w-full\" size=\"lg\" disabled={verificationOtp.length !== 4}>\r\n                    <CheckCircle className=\"w-4 h-4 mr-2\" />\r\n                    Verify & Register\r\n                  </Button>\r\n                  <Button variant=\"outline\" onClick={() => setShowVerificationInput(false)} className=\"w-full\">\r\n                    Change Phone Number\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const currentOrder = myOrders[0];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      <header className=\"sticky top-0 z-50 bg-card/95 backdrop-blur-md border-b border-border\">\r\n        <div className=\"container mx-auto px-4 py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <Link to=\"/\" className=\"text-foreground hover:text-primary transition-colors\">\r\n                <ArrowLeft className=\"w-5 h-5\" />\r\n              </Link>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Bike className=\"w-5 h-5 text-primary hidden md:block\" />\r\n                <div>\r\n                  <h1 className=\"text-lg font-bold leading-tight\">Delivery Dashboard</h1>\r\n                  {profile?.full_name && (\r\n                    <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\r\n                      <User className=\"w-3 h-3\" /> {profile.full_name}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n              <Link to=\"/support\">\r\n                <Button variant=\"outline\" size=\"sm\" className=\"hidden md:flex gap-2\">\r\n                  <MessageSquare className=\"w-4 h-4\" />\r\n                  Support\r\n                </Button>\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"md:hidden\">\r\n                  <MessageSquare className=\"w-5 h-5\" />\r\n                </Button>\r\n              </Link>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={handleRefresh}\r\n                disabled={refreshing}\r\n                className=\"h-8 w-8\"\r\n              >\r\n                <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />\r\n              </Button>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className={`text-sm ${deliveryPartner?.is_available ? 'text-accent' : 'text-muted-foreground'}`}>\r\n                  {deliveryPartner?.is_available ? 'Online' : 'Offline'}\r\n                </span>\r\n                <Switch\r\n                  checked={deliveryPartner?.is_available || false}\r\n                  onCheckedChange={toggleAvailability}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"container mx-auto px-4 py-6\">\r\n        <Tabs defaultValue=\"active\" className=\"space-y-6\">\r\n          <TabsList className=\"grid w-full grid-cols-4\">\r\n            <TabsTrigger value=\"active\" className=\"gap-2\">\r\n              <Package className=\"w-4 h-4\" />\r\n              Active\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"history\" className=\"gap-2\">\r\n              <History className=\"w-4 h-4\" />\r\n              History\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"earnings\" className=\"gap-2\">\r\n              <Wallet className=\"w-4 h-4\" />\r\n              Earnings\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"profile\" className=\"gap-2\">\r\n              <User className=\"w-4 h-4\" />\r\n              Profile\r\n            </TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"active\" className=\"space-y-6\">\r\n            {/* Quick Stats */}\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"p-3 text-center\">\r\n                  <div className={`w-3 h-3 rounded-full mx-auto mb-1 ${deliveryPartner?.is_available ? 'bg-accent animate-pulse' : 'bg-muted-foreground'}`} />\r\n                  <p className=\"text-xs text-muted-foreground\">Status</p>\r\n                  <p className={`font-semibold text-sm ${deliveryPartner?.is_available ? 'text-accent' : 'text-muted-foreground'}`}>\r\n                    {deliveryPartner?.is_available ? 'Online' : 'Offline'}\r\n                  </p>\r\n                </CardContent>\r\n              </Card>\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"p-3 text-center\">\r\n                  <Package className=\"w-4 h-4 mx-auto mb-1 text-primary\" />\r\n                  <p className=\"text-xs text-muted-foreground\">Available</p>\r\n                  <p className=\"font-semibold text-sm\">{availableOrders.length} orders</p>\r\n                </CardContent>\r\n              </Card>\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"p-3 text-center\">\r\n                  <CheckCircle className=\"w-4 h-4 mx-auto mb-1 text-status-delivered\" />\r\n                  <p className=\"text-xs text-muted-foreground\">Today</p>\r\n                  <p className=\"font-semibold text-sm\">{earnings.today}</p>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n\r\n            {/* Current Delivery */}\r\n            {currentOrder && (\r\n              <Card className=\"border-0 shadow-lg bg-gradient-to-r from-primary/5 to-accent/5\">\r\n                <CardHeader>\r\n                  <CardTitle className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Package className=\"w-5 h-5 text-primary\" />\r\n                      Current Delivery\r\n                    </div>\r\n                    <span className=\"text-sm font-mono bg-secondary px-2 py-1 rounded\">\r\n                      {getShortOrderId(currentOrder.id)}\r\n                    </span>\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-start justify-between\">\r\n                      <div>\r\n                        <p className=\"font-semibold text-lg\">{currentOrder.restaurants?.name}</p>\r\n                        <StatusBadge status={currentOrder.status as OrderStatus} />\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <p className=\"font-bold text-primary\">{Number(currentOrder.total_amount).toFixed(2)}</p>\r\n                        <span className=\"flex items-center gap-1 text-xs mt-1\">\r\n                          {currentOrder.payment_method === 'cod' ? (\r\n                            <span className=\"flex items-center gap-1 bg-accent/10 text-accent px-2 py-1 rounded-full\">\r\n                              <Banknote className=\"w-3 h-3\" /> COD\r\n                            </span>\r\n                          ) : (\r\n                            <span className=\"flex items-center gap-1 bg-primary/10 text-primary px-2 py-1 rounded-full\">\r\n                              <Smartphone className=\"w-3 h-3\" /> GPay\r\n                            </span>\r\n                          )}\r\n                        </span>\r\n                        <div className=\"mt-2 pt-2 border-t border-dashed border-border/50 text-xs space-y-1 min-w-[120px]\">\r\n                          <div className=\"flex justify-between text-muted-foreground\">\r\n                            <span>Delivery Fee</span>\r\n                            <span>{currentOrder.delivery_fee || 25}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between text-muted-foreground\">\r\n                            <span>Platform Fee</span>\r\n                            <span>8</span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Customer Info */}\r\n                    <div className=\"flex items-center justify-between p-3 bg-card rounded-lg border border-primary/20\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                          <User className=\"w-5 h-5 text-primary\" />\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"font-medium\">{currentOrder.customer_profile?.full_name || 'Customer'}</p>\r\n                          <p className=\"text-sm text-muted-foreground\">Customer</p>\r\n                        </div>\r\n                      </div>\r\n                      {currentOrder.customer_profile?.phone && (\r\n                        <a\r\n                          href={`tel:${currentOrder.customer_profile.phone}`}\r\n                          className=\"flex items-center gap-2 bg-accent text-accent-foreground px-4 py-2 rounded-lg font-medium hover:bg-accent/90 transition-colors\"\r\n                        >\r\n                          <Phone className=\"w-4 h-4\" />\r\n                          Call\r\n                        </a>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"grid gap-3\">\r\n                      <div className=\"flex items-start gap-3 p-3 bg-card rounded-lg\">\r\n                        <MapPin className=\"w-5 h-5 text-accent mt-0.5\" />\r\n                        <div className=\"flex-1\">\r\n                          <p className=\"text-sm text-muted-foreground\">Pickup from</p>\r\n                          <p className=\"font-medium\">{currentOrder.restaurants?.address}</p>\r\n                          <div className=\"flex items-center gap-3 mt-2\">\r\n                            {currentOrder.restaurants?.phone && (\r\n                              <a href={`tel:${currentOrder.restaurants.phone}`} className=\"flex items-center gap-1 text-primary text-sm hover:underline\">\r\n                                <Phone className=\"w-3 h-3\" />\r\n                                Call Shop ({currentOrder.restaurants.phone})\r\n                              </a>\r\n                            )}\r\n                            <a\r\n                              href={`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(currentOrder.restaurants?.address || '')}`}\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                              className=\"flex items-center gap-1 text-accent text-sm hover:underline\"\r\n                            >\r\n                              <ExternalLink className=\"w-3 h-3\" />\r\n                              Navigate\r\n                            </a>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-start gap-3 p-3 bg-card rounded-lg\">\r\n                        <Navigation className=\"w-5 h-5 text-primary mt-0.5\" />\r\n                        <div className=\"flex-1\">\r\n                          <p className=\"text-sm text-muted-foreground\">Deliver to</p>\r\n                          <p className=\"font-medium\">{currentOrder.delivery_address}</p>\r\n                          <div className=\"flex items-center gap-3 mt-2\">\r\n                            <a\r\n                              href={`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(currentOrder.delivery_address)}`}\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                              className=\"flex items-center gap-1 text-primary text-sm hover:underline\"\r\n                            >\r\n                              <ExternalLink className=\"w-3 h-3\" />\r\n                              Navigate\r\n                            </a>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                      {currentOrder.status === 'ready_for_pickup' && (\r\n                        <div className=\"space-y-3\">\r\n                          <div className=\"p-3 bg-card rounded-lg border-2 border-accent/20\">\r\n                            <div className=\"flex items-center gap-2 mb-2\">\r\n                              <Key className=\"w-4 h-4 text-accent\" />\r\n                              <span className=\"text-sm font-medium\">Enter Pickup OTP from Shop</span>\r\n                            </div>\r\n                            <Input\r\n                              type=\"text\"\r\n                              placeholder=\"Enter 4-digit OTP\"\r\n                              value={pickupOtpInputs[currentOrder.id] || ''}\r\n                              onChange={(e) => {\r\n                                setPickupOtpInputs(prev => ({ ...prev, [currentOrder.id]: e.target.value.replace(/\\D/g, '').slice(0, 4) }));\r\n                                setPickupOtpErrors(prev => ({ ...prev, [currentOrder.id]: false }));\r\n                              }}\r\n                              className={`font-mono text-center text-lg tracking-widest ${pickupOtpErrors[currentOrder.id] ? 'border-destructive' : ''}`}\r\n                              maxLength={4}\r\n                            />\r\n                            {pickupOtpErrors[currentOrder.id] && (\r\n                              <div className=\"flex items-center gap-1 text-destructive text-sm mt-2\">\r\n                                <AlertCircle className=\"w-3 h-3\" />\r\n                                <span>Invalid OTP</span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"flex gap-2\">\r\n                            <Button\r\n                              className=\"flex-1\"\r\n                              onClick={() => verifyPickupAndAccept(currentOrder)}\r\n                              disabled={(pickupOtpInputs[currentOrder.id] || '').length !== 4}\r\n                            >\r\n                              <CheckCircle className=\"w-4 h-4 mr-2\" />\r\n                              Verify & Pickup\r\n                            </Button>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {currentOrder.status === 'on_the_way' && (\r\n                        <div className=\"space-y-3\">\r\n                          <div className=\"p-3 bg-card rounded-lg border-2 border-primary/20\">\r\n                            <div className=\"flex items-center gap-2 mb-2\">\r\n                              <Key className=\"w-4 h-4 text-primary\" />\r\n                              <span className=\"text-sm font-medium\">Enter Customer OTP</span>\r\n                            </div>\r\n                            <Input\r\n                              type=\"text\"\r\n                              placeholder=\"Enter 4-digit OTP\"\r\n                              value={deliveryOtpInputs[currentOrder.id] || ''}\r\n                              onChange={(e) => {\r\n                                setDeliveryOtpInputs(prev => ({ ...prev, [currentOrder.id]: e.target.value.replace(/\\D/g, '').slice(0, 4) }));\r\n                                setDeliveryOtpErrors(prev => ({ ...prev, [currentOrder.id]: false }));\r\n                              }}\r\n                              className={`font-mono text-center text-lg tracking-widest ${deliveryOtpErrors[currentOrder.id] ? 'border-destructive' : ''}`}\r\n                              maxLength={4}\r\n                            />\r\n                            {deliveryOtpErrors[currentOrder.id] && (\r\n                              <div className=\"flex items-center gap-1 text-destructive text-sm mt-2\">\r\n                                <AlertCircle className=\"w-3 h-3\" />\r\n                                <span>Invalid OTP</span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          <div className=\"flex gap-2\">\r\n                            <Button\r\n                              className=\"flex-1\"\r\n                              variant=\"success\"\r\n                              onClick={() => verifyAndDeliver(currentOrder)}\r\n                              disabled={(deliveryOtpInputs[currentOrder.id] || '').length !== 4}\r\n                            >\r\n                              <CheckCircle className=\"w-4 h-4 mr-2\" />\r\n                              Verify & Deliver\r\n                            </Button>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                      {currentOrder.status === 'picked_up' && (\r\n                        <div className=\"flex gap-2\">\r\n                          <Button className=\"flex-1\" onClick={() => updateOrderStatus(currentOrder.id, 'on_the_way')}>\r\n                            <Navigation className=\"w-4 h-4 mr-2\" />\r\n                            Start Delivery\r\n                          </Button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n\r\n            {/* Available Orders */}\r\n            {deliveryPartner?.is_available && !currentOrder && (\r\n              <div className=\"space-y-4\">\r\n                <h2 className=\"text-lg font-semibold flex items-center gap-2\">\r\n                  <Package className=\"w-5 h-5\" />\r\n                  Available Orders\r\n                  {availableOrders.length > 0 && (\r\n                    <span className=\"w-6 h-6 bg-primary text-primary-foreground text-sm rounded-full flex items-center justify-center\">\r\n                      {availableOrders.length}\r\n                    </span>\r\n                  )}\r\n                </h2>\r\n\r\n                {availableOrders.length === 0 ? (\r\n                  <Card className=\"border-0 shadow-sm\">\r\n                    <CardContent className=\"py-12 text-center\">\r\n                      <Package className=\"w-12 h-12 text-muted-foreground/30 mx-auto mb-4\" />\r\n                      <p className=\"text-muted-foreground\">No orders available right now</p>\r\n                      <p className=\"text-sm text-muted-foreground mt-1\">New orders will appear here automatically</p>\r\n                    </CardContent>\r\n                  </Card>\r\n                ) : (\r\n                  <div className=\"grid gap-4\">\r\n                    {availableOrders.map((order) => (\r\n                      <Card key={order.id} className=\"border-0 shadow-sm hover:shadow-md transition-shadow\">\r\n                        <CardContent className=\"p-4\">\r\n                          <div className=\"flex items-start justify-between mb-3\">\r\n                            <div>\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <p className=\"font-semibold\">{order.restaurants?.name}</p>\r\n                                <span className=\"text-xs font-mono bg-secondary px-1.5 py-0.5 rounded\">\r\n                                  {getShortOrderId(order.id)}\r\n                                </span>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2 text-sm text-muted-foreground mt-1\">\r\n                                <Clock className=\"w-4 h-4\" />\r\n                                {format(new Date(order.created_at), 'h:mm a')}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                              <p className=\"font-bold text-primary\">{Number(order.total_amount).toFixed(2)}</p>\r\n                              <span className=\"flex items-center gap-1 text-xs mt-1 justify-end\">\r\n                                {order.payment_method === 'cod' ? (\r\n                                  <span className=\"flex items-center gap-1 bg-accent/10 text-accent px-2 py-0.5 rounded-full\">\r\n                                    <Banknote className=\"w-3 h-3\" /> COD\r\n                                  </span>\r\n                                ) : (\r\n                                  <span className=\"flex items-center gap-1 bg-primary/10 text-primary px-2 py-0.5 rounded-full\">\r\n                                    <Smartphone className=\"w-3 h-3\" /> GPay\r\n                                  </span>\r\n                                )}\r\n                              </span>\r\n                              <div className=\"mt-2 pt-2 border-t border-dashed border-border/50 text-xs space-y-1\">\r\n                                <div className=\"flex justify-between text-muted-foreground\">\r\n                                  <span>Delivery Fee</span>\r\n                                  <span>{order.delivery_fee || 25}</span>\r\n                                </div>\r\n                                <div className=\"flex justify-between text-muted-foreground\">\r\n                                  <span>Platform Fee</span>\r\n                                  <span>8</span>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n\r\n                          {/* Customer Info */}\r\n                          <div className=\"flex items-center justify-between p-2 bg-secondary/50 rounded-lg mb-3\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <User className=\"w-4 h-4 text-muted-foreground\" />\r\n                              <span className=\"text-sm\">{order.customer_profile?.full_name || 'Customer'}</span>\r\n                            </div>\r\n                            {order.customer_profile?.phone && (\r\n                              <a\r\n                                href={`tel:${order.customer_profile.phone}`}\r\n                                className=\"flex items-center gap-1 text-primary text-xs hover:underline\"\r\n                              >\r\n                                <Phone className=\"w-3 h-3\" />\r\n                                Call\r\n                              </a>\r\n                            )}\r\n                          </div>\r\n\r\n                          <div className=\"space-y-2 text-sm mb-4\">\r\n                            <div className=\"flex items-start gap-2\">\r\n                              <MapPin className=\"w-4 h-4 text-accent mt-0.5\" />\r\n                              <div className=\"flex-1\">\r\n                                <span className=\"text-muted-foreground\">{order.restaurants?.address}</span>\r\n                                <div className=\"flex items-center gap-3 mt-1\">\r\n                                  {order.restaurants?.phone && (\r\n                                    <a href={`tel:${order.restaurants.phone}`} className=\"flex items-center gap-1 text-primary text-xs hover:underline\">\r\n                                      <Phone className=\"w-3 h-3\" />\r\n                                      Call Shop ({order.restaurants.phone})\r\n                                    </a>\r\n                                  )}\r\n                                  <a\r\n                                    href={`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(order.restaurants?.address || '')}`}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"flex items-center gap-1 text-accent text-xs hover:underline\"\r\n                                  >\r\n                                    <ExternalLink className=\"w-3 h-3\" />\r\n                                    Map\r\n                                  </a>\r\n                                  {order.restaurants?.phone && (\r\n                                    <a href={`tel:${order.restaurants.phone}`} className=\"flex items-center gap-1 text-primary text-xs hover:underline\">\r\n                                      <Phone className=\"w-3 h-3\" />\r\n                                      Call Shop\r\n                                    </a>\r\n                                  )}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"flex items-start gap-2\">\r\n                              <Navigation className=\"w-4 h-4 text-primary mt-0.5\" />\r\n                              <span className=\"text-muted-foreground\">{order.delivery_address}</span>\r\n                            </div>\r\n                          </div>\r\n\r\n                          {/* Accept/Reject Actions */}\r\n                          <div className=\"grid grid-cols-2 gap-3\">\r\n                            <Button\r\n                              variant=\"outline\"\r\n                              onClick={() => {\r\n                                setPassedOrderIds(prev => [...prev, order.id]);\r\n                                setAvailableOrders(prev => prev.filter(o => o.id !== order.id));\r\n                                toast.info('Order passed');\r\n                              }}\r\n                            >\r\n                              <X className=\"w-4 h-4 mr-2\" />\r\n                              Pass\r\n                            </Button>\r\n                            <Button\r\n                              onClick={() => acceptOrder(order.id)}\r\n                            >\r\n                              <CheckCircle className=\"w-4 h-4 mr-2\" />\r\n                              Accept Order\r\n                            </Button>\r\n                          </div>\r\n                        </CardContent>\r\n                      </Card>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Offline State */}\r\n            {!deliveryPartner?.is_available && !currentOrder && (\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"py-16 text-center\">\r\n                  <Bike className=\"w-16 h-16 text-muted-foreground/30 mx-auto mb-4\" />\r\n                  <h3 className=\"text-xl font-semibold mb-2\">You're Offline</h3>\r\n                  <p className=\"text-muted-foreground mb-4\">Go online to start receiving delivery requests</p>\r\n                  <Button onClick={toggleAvailability}>Go Online</Button>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"history\" className=\"space-y-4\">\r\n            <h2 className=\"text-lg font-semibold flex items-center gap-2\">\r\n              <History className=\"w-5 h-5\" />\r\n              Order History\r\n            </h2>\r\n\r\n            {orderHistory.length === 0 ? (\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"py-12 text-center\">\r\n                  <History className=\"w-12 h-12 text-muted-foreground/30 mx-auto mb-4\" />\r\n                  <p className=\"text-muted-foreground\">No completed deliveries yet</p>\r\n                  <p className=\"text-sm text-muted-foreground mt-1\">Your delivery history will appear here</p>\r\n                </CardContent>\r\n              </Card>\r\n            ) : (\r\n              <div className=\"grid gap-4\">\r\n                {orderHistory.map((order) => (\r\n                  <Card key={order.id} className=\"border-0 shadow-sm\">\r\n                    <CardContent className=\"p-4\">\r\n                      <div className=\"flex items-start justify-between mb-2\">\r\n                        <div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <p className=\"font-semibold\">{order.restaurants?.name}</p>\r\n                            <span className=\"text-xs font-mono bg-secondary px-1.5 py-0.5 rounded\">\r\n                              {getShortOrderId(order.id)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2 text-sm text-muted-foreground mt-1\">\r\n                            <Clock className=\"w-4 h-4\" />\r\n                            {format(new Date(order.created_at), 'MMM d, h:mm a')}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          <StatusBadge status={order.status as OrderStatus} />\r\n                          <p className=\"font-bold text-primary mt-1\">{Number(order.total_amount).toFixed(2)}</p>\r\n                          <div className=\"mt-2 pt-2 border-t border-dashed border-border/50 text-xs space-y-1 min-w-[100px]\">\r\n                            <div className=\"flex justify-between text-muted-foreground\">\r\n                              <span>Delivery Fee</span>\r\n                              <span>{order.delivery_fee || 25}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-muted-foreground\">\r\n                              <span>Platform Fee</span>\r\n                              <span>8</span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                        <Navigation className=\"w-4 h-4\" />\r\n                        <span className=\"truncate\">{order.delivery_address}</span>\r\n                      </div>\r\n                      {order.status === 'delivered' && (\r\n                        <div className=\"mt-2 flex items-center gap-1 text-accent text-sm\">\r\n                          <IndianRupee className=\"w-3 h-3\" />\r\n                          <span>Earned: 30</span>\r\n                        </div>\r\n                      )}\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"earnings\" className=\"space-y-6\">\r\n            {/* Earnings Stats */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"p-4\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-lg bg-accent/10 flex items-center justify-center\">\r\n                      <IndianRupee className=\"w-5 h-5 text-accent\" />\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">Today</p>\r\n                      <p className=\"text-xl font-bold\">{earnings.today}</p>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"p-4\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center\">\r\n                      <TrendingUp className=\"w-5 h-5 text-primary\" />\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">This Week</p>\r\n                      <p className=\"text-xl font-bold\">{earnings.week}</p>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"p-4\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-lg bg-status-delivered/10 flex items-center justify-center\">\r\n                      <Wallet className=\"w-5 h-5 text-status-delivered\" />\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">Total Earned</p>\r\n                      <p className=\"text-xl font-bold\">{earnings.total}</p>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n              <Card className=\"border-0 shadow-sm\">\r\n                <CardContent className=\"p-4\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-lg bg-status-pending/10 flex items-center justify-center\">\r\n                      <Clock className=\"w-5 h-5 text-status-pending\" />\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground\">Pending</p>\r\n                      <p className=\"text-xl font-bold\">{earnings.pending}</p>\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            </div>\r\n\r\n            {/* Settlement Info */}\r\n            <Card className=\"border-0 shadow-md bg-gradient-to-r from-primary/5 to-accent/5\">\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <Wallet className=\"w-5 h-5 text-primary\" />\r\n                  Settlement Info\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex justify-between items-center p-3 bg-card rounded-lg\">\r\n                    <span className=\"text-muted-foreground\">Delivery fee per order</span>\r\n                    <span className=\"font-bold\">{settings.delivery_fee_per_order ?? 30}</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center p-3 bg-card rounded-lg\">\r\n                    <span className=\"text-muted-foreground\">Total deliveries</span>\r\n                    <span className=\"font-bold\">{orderHistory.filter(o => o.status === 'delivered').length}</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center p-3 bg-card rounded-lg\">\r\n                    <span className=\"text-muted-foreground\">Settlement cycle</span>\r\n                    <span className=\"font-bold\">Weekly (Every Monday)</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center p-3 bg-card rounded-lg\">\r\n                    <span className=\"text-muted-foreground\">Settlement status</span>\r\n                    <span className=\"font-bold text-accent\">Processed</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center p-3 bg-card rounded-lg\">\r\n                    <span className=\"text-muted-foreground\">Next payout</span>\r\n                    <span className=\"font-bold\">{earnings.pending}</span>\r\n                  </div>\r\n\r\n                  {/* Payment breakdown */}\r\n\r\n\r\n                  <p className=\"text-sm text-muted-foreground text-center mt-4\">\r\n                    Settlements are processed every Monday to your registered bank account\r\n                  </p>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"profile\" className=\"space-y-6\">\r\n            {/* Profile Info */}\r\n            <Card className=\"border-0 shadow-md\">\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <User className=\"w-5 h-5 text-primary\" />\r\n                  Partner Profile\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\r\n                  <span className=\"text-muted-foreground\">Name</span>\r\n                  <span className=\"font-medium\">{profile?.full_name || 'Not set'}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\r\n                  <span className=\"text-muted-foreground\">Partner ID</span>\r\n                  <span className=\"font-medium font-mono text-xs\">{user?.id}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\r\n                  <span className=\"text-muted-foreground\">Phone</span>\r\n                  <span className=\"font-medium\">{deliveryPartner?.phone || 'Not set'}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\r\n                  <span className=\"text-muted-foreground\">Vehicle Type</span>\r\n                  <span className=\"font-medium flex items-center gap-2\">\r\n                    <Bike className=\"w-4 h-4\" />\r\n                    {deliveryPartner?.vehicle_type || 'Bike'}\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex justify-between items-start p-3 bg-secondary/50 rounded-lg\">\r\n                  <div className=\"mt-1\">\r\n                    <span className=\"text-muted-foreground block mb-1\">Phone Verified</span>\r\n                    <span className={`font-medium flex items-center gap-1 ${deliveryPartner?.phone_verified ? 'text-accent' : 'text-destructive'}`}>\r\n                      {deliveryPartner?.phone_verified ? (\r\n                        <>\r\n                          <CheckCircle className=\"w-4 h-4\" />\r\n                          Verified\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <AlertCircle className=\"w-4 h-4\" />\r\n                          Not Verified\r\n                        </>\r\n                      )}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {!deliveryPartner?.phone_verified && (\r\n                    <div className=\"flex flex-col gap-2 w-32\">\r\n                      <Input\r\n                        placeholder=\"Enter OTP\"\r\n                        className=\"h-8 text-xs text-center\"\r\n                        value={profileOtp}\r\n                        onChange={(e) => setProfileOtp(e.target.value)}\r\n                      />\r\n                      <Button size=\"sm\" className=\"h-7 text-xs\" onClick={handleProfileVerification}>\r\n                        Verify\r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\r\n                  <span className=\"text-muted-foreground\">Status</span>\r\n                  <span className={`font-medium ${deliveryPartner?.is_available ? 'text-accent' : 'text-muted-foreground'}`}>\r\n                    {deliveryPartner?.is_available ? 'Online' : 'Offline'}\r\n                  </span>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Performance Report */}\r\n            <Card className=\"border-0 shadow-md\">\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <BarChart3 className=\"w-5 h-5 text-primary\" />\r\n                  Performance Report\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div className=\"p-3 bg-secondary/50 rounded-lg text-center\">\r\n                    <div className=\"flex items-center justify-center gap-1 mb-1\">\r\n                      <Package className=\"w-4 h-4 text-primary\" />\r\n                      <span className=\"text-2xl font-bold\">{orderHistory.filter(o => o.status === 'delivered').length}</span>\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">Total Deliveries</p>\r\n                  </div>\r\n                  <div className=\"p-3 bg-secondary/50 rounded-lg text-center\">\r\n                    <div className=\"flex items-center justify-center gap-1 mb-1\">\r\n                      <Percent className=\"w-4 h-4 text-accent\" />\r\n                      <span className=\"text-2xl font-bold text-accent\">\r\n                        {orderHistory.length > 0\r\n                          ? Math.round((orderHistory.filter(o => o.status === 'delivered').length / orderHistory.length) * 100)\r\n                          : 0}%\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">Success Rate</p>\r\n                  </div>\r\n                  <div className=\"p-3 bg-secondary/50 rounded-lg text-center\">\r\n                    <div className=\"flex items-center justify-center gap-1 mb-1\">\r\n                      <X className=\"w-4 h-4 text-destructive\" />\r\n                      <span className=\"text-2xl font-bold text-destructive\">{orderHistory.filter(o => o.status === 'cancelled').length}</span>\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">Cancelled</p>\r\n                  </div>\r\n                  <div className=\"p-3 bg-secondary/50 rounded-lg text-center\">\r\n                    <div className=\"flex items-center justify-center gap-1 mb-1\">\r\n                      <Star className=\"w-4 h-4 text-yellow-500 fill-yellow-500\" />\r\n                      <span className=\"text-2xl font-bold\">\r\n                        {avgRating !== null ? avgRating.toFixed(1) : ''}\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      Avg Rating {totalRatings > 0 ? `(${totalRatings})` : ''}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Rating Progress */}\r\n                <div className=\"p-3 bg-gradient-to-r from-primary/10 to-accent/10 rounded-lg\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <span className=\"text-sm font-medium flex items-center gap-1\">\r\n                      <Award className=\"w-4 h-4 text-primary\" />\r\n                      Partner Level\r\n                    </span>\r\n                    <span className=\"text-sm text-primary font-bold\">\r\n                      {orderHistory.filter(o => o.status === 'delivered').length >= 100 ? 'Gold' :\r\n                        orderHistory.filter(o => o.status === 'delivered').length >= 50 ? 'Silver' : 'Bronze'}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"w-full bg-secondary rounded-full h-2\">\r\n                    <div\r\n                      className=\"bg-gradient-to-r from-primary to-accent h-2 rounded-full transition-all\"\r\n                      style={{ width: `${Math.min(100, (orderHistory.filter(o => o.status === 'delivered').length / 100) * 100)}%` }}\r\n                    />\r\n                  </div>\r\n                  <p className=\"text-xs text-muted-foreground mt-1\">\r\n                    {100 - orderHistory.filter(o => o.status === 'delivered').length} more deliveries to reach Gold\r\n                  </p>\r\n                </div>\r\n\r\n                <div className=\"flex justify-between items-center p-3 bg-secondary/50 rounded-lg\">\r\n                  <span className=\"text-muted-foreground flex items-center gap-2\">\r\n                    <Calendar className=\"w-4 h-4\" />\r\n                    Member Since\r\n                  </span>\r\n                  <span className=\"font-medium\">\r\n                    {deliveryPartner?.created_at\r\n                      ? format(new Date(deliveryPartner.created_at), 'MMM d, yyyy')\r\n                      : 'N/A'}\r\n                  </span>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Help & Support */}\r\n            <Card className=\"border-0 shadow-md\">\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <Headphones className=\"w-5 h-5 text-primary\" />\r\n                  Help & Support\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-3\">\r\n                <Link to=\"/contact\" className=\"flex items-center justify-between p-3 bg-secondary/50 rounded-lg hover:bg-secondary transition-colors\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Phone className=\"w-5 h-5 text-primary\" />\r\n                    <div>\r\n                      <p className=\"font-medium\">Contact Support</p>\r\n                      <p className=\"text-xs text-muted-foreground\">Get help with orders & account</p>\r\n                    </div>\r\n                  </div>\r\n                  <ExternalLink className=\"w-4 h-4 text-muted-foreground\" />\r\n                </Link>\r\n                <Link to=\"/terms\" className=\"flex items-center justify-between p-3 bg-secondary/50 rounded-lg hover:bg-secondary transition-colors\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <FileText className=\"w-5 h-5 text-primary\" />\r\n                    <div>\r\n                      <p className=\"font-medium\">Partner Guidelines</p>\r\n                      <p className=\"text-xs text-muted-foreground\">Read delivery partner terms</p>\r\n                    </div>\r\n                  </div>\r\n                  <ExternalLink className=\"w-4 h-4 text-muted-foreground\" />\r\n                </Link>\r\n                <a href=\"tel:+911800123456\" className=\"flex items-center justify-between p-3 bg-primary/10 rounded-lg hover:bg-primary/20 transition-colors\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Headphones className=\"w-5 h-5 text-primary\" />\r\n                    <div>\r\n                      <p className=\"font-medium text-primary\">Emergency Helpline</p>\r\n                      <p className=\"text-xs text-muted-foreground\">+91 1800-123-4567</p>\r\n                    </div>\r\n                  </div>\r\n                  <Phone className=\"w-4 h-4 text-primary\" />\r\n                </a>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div >\r\n    </div >\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\pages\\restaurant\\RestaurantDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\stores\\cartStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\types\\database.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2959,2962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2959,2962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type AppRole = 'super_admin' | 'restaurant_owner' | 'delivery_partner' | 'customer' | 'support_agent';\r\n\r\nexport type ShopCategory = 'food' | 'grocery' | 'fruits' | 'vegetables' | 'meat' | 'medicine' | 'bakery' | 'beverages';\r\n\r\nexport type OrderStatus =\r\n  | 'pending'\r\n  | 'confirmed'\r\n  | 'preparing'\r\n  | 'ready_for_pickup'\r\n  | 'picked_up'\r\n  | 'on_the_way'\r\n  | 'delivered'\r\n  | 'cancelled';\r\n\r\nexport interface Profile {\r\n  id: string;\r\n  email: string;\r\n  full_name: string | null;\r\n  phone: string | null;\r\n  avatar_url: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Restaurant {\r\n  id: string;\r\n  owner_id: string;\r\n  name: string;\r\n  description: string | null;\r\n  address: string;\r\n  phone: string | null;\r\n  pincode: string | null;\r\n  image_url: string | null;\r\n  cuisine_type: string | null;\r\n  category: string;\r\n  lat: number | null;\r\n  lng: number | null;\r\n  is_verified: boolean;\r\n  is_open: boolean;\r\n  commission_rate: number;\r\n  rating: number | null;\r\n  estimated_delivery_time: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface MenuItem {\r\n  id: string;\r\n  restaurant_id: string;\r\n  name: string;\r\n  description: string | null;\r\n  price: number;\r\n  image_url: string | null;\r\n  category: string | null;\r\n  is_available: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface DeliveryPartner {\r\n  id: string;\r\n  user_id: string;\r\n  is_available: boolean;\r\n  current_lat: number | null;\r\n  current_lng: number | null;\r\n  vehicle_type: string | null;\r\n  phone: string | null;\r\n  phone_verified: boolean;\r\n  verification_otp: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport type PaymentMethod = 'cod' | 'gpay';\r\n\r\nexport interface Order {\r\n  id: string;\r\n  customer_id: string;\r\n  restaurant_id: string;\r\n  delivery_partner_id: string | null;\r\n  status: OrderStatus;\r\n  total_amount: number;\r\n  delivery_address: string;\r\n  delivery_lat: number | null;\r\n  delivery_lng: number | null;\r\n  notes: string | null;\r\n  payment_method: string;\r\n  delivery_otp: string | null;\r\n  pickup_otp: string | null;\r\n  scheduled_at: string | null;\r\n  is_scheduled: boolean;\r\n  delivery_fee: number | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface OrderItem {\r\n  id: string;\r\n  order_id: string;\r\n  menu_item_id: string;\r\n  quantity: number;\r\n  unit_price: number;\r\n  created_at: string;\r\n}\r\n\r\nexport interface CartItem {\r\n  menuItem: MenuItem;\r\n  quantity: number;\r\n}\r\n\r\nexport interface CustomerAddress {\r\n  id: string;\r\n  user_id: string;\r\n  label: string;\r\n  address: string;\r\n  pincode: string;\r\n  lat: number | null;\r\n  lng: number | null;\r\n  is_default: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface FavouriteShop {\r\n  id: string;\r\n  user_id: string;\r\n  restaurant_id: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface AppSettings {\r\n  key: string;\r\n  value: any;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface Settlement {\r\n  id: string;\r\n  delivery_partner_id: string | null;\r\n  restaurant_id: string | null;\r\n  amount: number;\r\n  status: 'pending' | 'processed' | 'failed';\r\n  reference_no: string | null;\r\n  processed_at: string | null;\r\n  created_at: string;\r\n  profiles?: Profile;\r\n  restaurants?: Restaurant;\r\n}\r\n\r\n\r\nexport interface DeliveryPincode {\r\n  id: string;\r\n  pincode: string;\r\n  description: string | null;\r\n  is_active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface RestaurantDeliveryPincode {\r\n  id: string;\r\n  restaurant_id: string;\r\n  pincode: string;\r\n  description: string | null;\r\n  is_active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\utils\\format.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\foodiempt-main\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]